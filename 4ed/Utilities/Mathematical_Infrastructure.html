
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="icon" href="/favicon.ico?v=2" /> <!-- force refresh -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">

<script async src="https://cse.google.com/cse.js?cx=22a43cef261a245ea"></script>  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/bootstrap.min.css">

  <title>Mathematical Infrastructure</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Utilities.html">Utilities</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Mathematical Infrastructure</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Utilities/System_Startup,_Cleanup,_and_Options.html">(Previous: System Startup, Cleanup, and Options)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<h2>B.2 Mathematical Infrastructure</h2><p>


</p>
<p><tt>pbrt</tt> uses a wide range of mathematical routines.  Much of this
functionality is implemented in the files <a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/util/math.h"><tt>util/math.h</tt></a> and
<a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/util/math.cpp"><tt>util/math.cpp</tt></a>; everything in this section is found there, with
a few exceptions that will be noted when they are encountered.

</p>
<p>A table of the first 1,000 prime numbers is provided via a global
variable.  Its main use in <tt>pbrt</tt> is for determining bases to use for the
radical inverse based low-discrepancy points in
Chapter&nbsp;<a href="../Sampling_and_Reconstruction.html#chap:sampling-reconstruction">8</a>.

</p>
<p></p>
<span class="anchor" id="fragment-PrimeTableDeclarations-0"></span><div class="fragmentname">&lt;&lt;Prime Table Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">static constexpr int <span class="anchor" id="PrimeTableSize"></span>PrimeTableSize = 1000;
extern PBRT_CONST int <span class="anchor" id="Primes"></span>Primes[PrimeTableSize];</div><p>


</p>
<p><tt>NextPrime()</tt> returns the next prime number after the provided one.

</p>
<p></p>
<span class="anchor" id="fragment-MathFunctionDeclarations-0"></span><div class="fragmentname">&lt;&lt;Math Function Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int <span class="anchor" id="NextPrime"></span>NextPrime(int x);</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#BasicAlgebraicFunctions"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="BasicAlgebraicFunctions"></span><h3>B.2.1  Basic Algebraic Functions</h3><p>


</p>
<p><a href="#Clamp"><tt>Clamp()</tt></a> clamps the given value to lie between the values <tt>low</tt>
and <tt>high</tt>.  For convenience, it allows the types of the values giving
the extent to be different than the type being clamped (but its
implementation requires that implicit conversion among the types involved is
legal). By being implemented this way rather than requiring all to have
the same type, the implementation allows calls like <tt>Clamp(floatValue,
0, 1)</tt> that would otherwise be disallowed by C++&rsquo;s template type
resolution rules.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-4"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#fragment-MathInlineFunctions-3"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-5"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T, typename U, typename V&gt;
constexpr T <span class="anchor" id="Clamp"></span><a href="#Clamp" class="code">Clamp</a>(T val, U low, V high) {
    if (val &lt; low)       return T(low);
    else if (val &gt; high) return T(high);
    else                 return val;
}
</div><p>


</p>
<p><a href="#Mod"><tt>Mod()</tt></a> computes the remainder of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.39ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1459.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a slash b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="529" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1030" y="0"></use>
</g>
</svg>.  <tt>pbrt</tt> has its own version of
this (rather than using&nbsp;<tt>%</tt>) in order to provide the behavior that
the modulus of a negative number is always positive or zero.  Starting with C++11,
the behavior of <tt>%</tt> has been specified to return a negative value or
zero in this case, so that the identity <tt>(a/b)*b + a%b == a</tt> holds.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-5"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-4"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-6"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <span class="anchor" id="Mod"></span>Mod(T a, T b) {
    T result = a - (a / b) * b;
    return (T)((result &lt; 0) ? result + b : result);
}</div><p>


</p>
<p>A specialization for <tt>Float</tt>s calls the corresponding standard library
function.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-6"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-5"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-7"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
Float Mod(Float a, Float b) { return std::fmod(a, b); }</div><p>


</p>
<p>It can be useful to be able to invert the bilinear interpolation function,
Equation&nbsp;(<a href="../Monte_Carlo_Integration/Transforming_between_Distributions.html#eq:bilinear-interp">2.25</a>).  Because there are two unknowns in the
result, values with at least two dimensions must be bilinearly interpolated in order to
invert it.  In that case, two equations with two unknowns can be formed,
which in turn leads to a quadratic equation.

</p>
<p></p>
<span class="anchor" id="fragment-Point2InlineFunctions-0"></span><div class="fragmentname">&lt;&lt;Point2 Inline Functions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> <span class="anchor" id="InvertBilinear"></span>InvertBilinear(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> p, pstd::span&lt;const <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a>&gt; v);</div><p>


</p>
<p>

</p>
<p>A number of constants, most of them related to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.325ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 570.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">pi</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="0" y="0"></use>
</g>
</svg>, are used enough that
it is worth having them easily available.

</p>
<p></p>
<span class="anchor" id="fragment-MathematicalConstants-1"></span><div class="fragmentname">&lt;&lt;Mathematical Constants&gt;&gt;+=&nbsp;<a href="../Shapes/Managing_Rounding_Error.html#fragment-MathematicalConstants-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">constexpr Float <span class="anchor" id="Pi"></span>Pi = 3.14159265358979323846;
constexpr Float <span class="anchor" id="InvPi"></span>InvPi = 0.31830988618379067154;
constexpr Float <span class="anchor" id="Inv2Pi"></span>Inv2Pi = 0.15915494309189533577;
constexpr Float <span class="anchor" id="Inv4Pi"></span>Inv4Pi = 0.07957747154594766788;
constexpr Float <span class="anchor" id="PiOver2"></span>PiOver2 = 1.57079632679489661923;
constexpr Float <span class="anchor" id="PiOver4"></span>PiOver4 = 0.78539816339744830961;
constexpr Float <span class="anchor" id="Sqrt2"></span>Sqrt2 = 1.41421356237309504880;</div><p>


</p>
<p>Two simple functions convert from angles expressed in degrees to radians,
and vice versa:

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-7"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-6"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-8"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="Radians"></span>Radians(Float deg) { return (Pi / 180) * deg; }
Float <span class="anchor" id="Degrees"></span>Degrees(Float rad) { return (180 / Pi) * rad; }</div><p>


</p>
<p>It is often useful to blend between two values using a smooth curve that
does not have the first derivative discontinuities that a linear
interpolant would.  <tt>SmoothStep()</tt> takes a range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.555ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1961.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
</g>
</svg> and a value
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg>, returning&nbsp;0 if <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.658ex" height="2.176ex" style="vertical-align: -0.505ex;" viewBox="0 -719.6 2436.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x less-than-or-equal-to a</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2264" d="M691 75c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259zM702 -99c0 -11 -9 -20 -20 -20h-586c-11 0 -20 9 -20 20s9 20 20 20h586c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2264" x="850" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="1906" y="0"></use>
</g>
</svg>, 1 if <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.426ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2336.1 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x greater-than-or-equal-to b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2265" d="M686 314l-581 -275c-25 -11 -42 25 -18 36l548 259l-548 259c-24 11 -7 47 18 36l581 -275c17 -8 17 -32 0 -40zM702 -99c0 -11 -9 -20 -20 -20h-586c-11 0 -20 9 -20 20s9 20 20 20h586c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2265" x="850" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1906" y="0"></use>
</g>
</svg>, and smoothly blends
between&nbsp;0 and&nbsp;1 for intermediate values of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> using a cubic polynomial.
Among other uses in the system, the <a href="../Light_Sources/Point_Lights.html#SpotLight"><tt>SpotLight</tt></a> uses <tt>SmoothStep()</tt> to model the
falloff to its edge.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-8"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-7"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-9"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="SmoothStep"></span>SmoothStep(Float x, Float a, Float b) {
    if (a == b) return (x &lt; a) ? 0 : 1;
    Float t = <a href="#Clamp" class="code">Clamp</a>((x - a) / (b - a), 0, 1);
    return t * t * (3 - 2 * t);
}</div><p>


</p>
<p>Finally, <tt>SafeSqrt()</tt> returns the square root of the given value,
clamping it to zero in case of rounding errors being the cause of a
slightly negative value.  A second variant for <tt>double</tt>s is
effectively the same and is therefore not included here.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-9"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-8"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-10"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">float <span class="anchor" id="SafeSqrt"></span>SafeSqrt(float x) { return std::sqrt(std::max(0.f, x)); }</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#IntegerPowersandPolynomials"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="IntegerPowersandPolynomials"></span><h3>B.2.2  Integer Powers and Polynomials</h3><p>


</p>
<p><tt>Sqr()</tt> squares the provided value.  Though it is not much work to
write this operation out directly, we have often found this function to be
helpful in making the implementations of formulae more succinct.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-10"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-9"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-11"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
constexpr T <span class="anchor" id="Sqr"></span>Sqr(T v) { return v * v; }</div><p>


</p>
<p><tt>Pow()</tt> efficiently raises a value to a power if the power is a
compile-time constant.  Note that the total number of multiply operations
works out to be logarithmic in the power <tt>n</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-11"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-10"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-12"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;int n&gt;
constexpr float <span class="anchor" id="Pow"></span><a href="#Pow" class="code">Pow</a>(float v) {
    if constexpr (n &lt; 0) return 1 / <a href="#Pow" class="code">Pow</a>&lt;-n&gt;(v);
    float n2 = <a href="#Pow" class="code">Pow</a>&lt;n / 2&gt;(v);
    return n2 * n2 * <a href="#Pow" class="code">Pow</a>&lt;n &amp; 1&gt;(v);
}</div><p>


</p>
<p>Specializations for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.656ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2435.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n equals 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="878" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1934" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.656ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2435.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="878" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1934" y="0"></use>
</g>
</svg> terminate the template function
recursion.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-12"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-11"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-13"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
constexpr float Pow&lt;1&gt;(float v) { return v; }
template &lt;&gt;
constexpr float Pow&lt;0&gt;(float v) { return 1; }</div><p>


</p>
<p>

</p>
<p><tt>EvaluatePolynomial()</tt> evaluates a provided polynomial using Horner&rsquo;s
method, which is based on the equivalence
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="45.331ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 19517.2 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c 0 plus c 1 x plus c 2 x squared plus midline-horizontal-ellipsis equals c 0 plus x left-parenthesis c 1 plus x left-parenthesis c 2 plus midline-horizontal-ellipsis period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-22EF" d="M162 250c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM441 250c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM720 250c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="613" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1109" y="0"></use>
<g transform="translate(2110,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="613" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2997" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="3792" y="0"></use>
<g transform="translate(4793,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="613" y="-213"></use>
</g>
<g transform="translate(5680,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6929" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-22EF" x="7929" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="8984" y="0"></use>
<g transform="translate(10040,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="613" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="11150" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="12150" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="12723" y="0"></use>
<g transform="translate(13112,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="613" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="14222" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="15223" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="15795" y="0"></use>
<g transform="translate(16185,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="613" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="17294" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-22EF" x="18295" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="19238" y="0"></use>
</g>
</svg>
</div>
<p>

This formulation both gives good numerical accuracy and is amenable to use
of fused multiply add operations.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-13"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-12"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-14"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename Float, typename C&gt;
constexpr Float EvaluatePolynomial(Float t, C c) { return c; }</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-14"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-13"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-15"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename Float, typename C, typename... Args&gt;
constexpr Float <span class="anchor" id="EvaluatePolynomial"></span><a href="#EvaluatePolynomial" class="code">EvaluatePolynomial</a>(Float t, C c, Args... cRemaining) {
    return <a href="../Shapes/Managing_Rounding_Error.html#FMA" class="code">FMA</a>(t, <a href="#EvaluatePolynomial" class="code">EvaluatePolynomial</a>(t, cRemaining...), c);
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#TrigonometricFunctions"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="TrigonometricFunctions"></span><h3>B.2.3  Trigonometric Functions</h3><p>


</p>
<p>The function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.487ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3654 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">sine left-parenthesis x right-parenthesis slash x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-73"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-69" x="394" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="673" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1229" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="1619" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2191" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2581" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="3081" y="0"></use>
</g>
</svg> is used in multiple places in <tt>pbrt</tt>, including in
the implementation of the <a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#LanczosSincFilter"><tt>LanczosSincFilter</tt></a>.  It is undefined at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.591ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2407.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="850" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1906" y="0"></use>
</g>
</svg> and
suffers from poor numerical accuracy if directly evaluated at nearby
values.  A robust computation of its value is possible by considering the
power series expansion
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.61ex" height="5.843ex" style="vertical-align: -2.005ex;" viewBox="0 -1652.5 11887.5 2515.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction sine x Over x EndFraction equals 1 minus StartFraction x squared Over 3 factorial EndFraction plus StartFraction x Superscript 4 Baseline Over 5 factorial EndFraction minus ellipsis period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-21" d="M192 665l-39 -456c-1 -17 -4 -22 -14 -22c-12 0 -13 8 -14 23l-39 455c0 33 27 51 53 51s53 -18 53 -51zM192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2026" d="M193 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM472 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53zM751 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="2088" height="60" x="0" y="220"></rect>
<g transform="translate(60,676)">
 <use xlink:href="#E1-LATINMODERNMAIN-73"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-69" x="394" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="673" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="1396" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="758" y="-686"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2606" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="3662" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4385" y="0"></use>
<g transform="translate(5163,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="1146" height="60" x="0" y="220"></rect>
<g transform="translate(60,676)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="513"></use>
</g>
<g transform="translate(183,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-21" x="500" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6994" y="0"></use>
<g transform="translate(7773,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="1146" height="60" x="0" y="220"></rect>
<g transform="translate(60,676)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-34" x="809" y="513"></use>
</g>
<g transform="translate(183,-737)">
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-21" x="500" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="9604" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2026" x="10604" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11609" y="0"></use>
</g>
</svg>
</div>
<p>

If <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> is small and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.359ex" height="3.009ex" style="vertical-align: -0.838ex;" viewBox="0 -934.9 4029.4 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1 minus x squared slash 3 factorial</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-21" d="M192 665l-39 -456c-1 -17 -4 -22 -14 -22c-12 0 -13 8 -14 23l-39 455c0 33 27 51 53 51s53 -18 53 -51zM192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="722" y="0"></use>
<g transform="translate(1723,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2749" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="3250" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-21" x="3750" y="0"></use>
</g>
</svg> rounds to&nbsp;1, then <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.487ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3654 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">sine left-parenthesis x right-parenthesis slash x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-73"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-69" x="394" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="673" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1229" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="1619" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2191" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2581" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="3081" y="0"></use>
</g>
</svg> 
also rounds to&nbsp;1. The following function uses a slightly more conservative
variant of that test, which is close enough for our purposes.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-15"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-14"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-16"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="SinXOverX"></span>SinXOverX(Float x) {
    if (1 - x * x == 1)
        return 1;
    return std::sin(x) / x;
}</div><p>


</p>
<p>
Similar to <a href="#SafeSqrt"><tt>SafeSqrt()</tt></a>, <tt>pbrt</tt> also provides &ldquo;safe&rdquo; versions of the
inverse sine and cosine functions so that if the provided value is slightly
outside of the legal range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.461ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2781.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket negative 1 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1057" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1557" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2002" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2503" y="0"></use>
</g>
</svg>, a reasonable result is returned rather
than a not-a-number value.  In debug builds, an additional check is
performed to make sure that the provided value is not too far outside the
valid range.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-16"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-15"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-17"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">float <span class="anchor" id="SafeASin"></span>SafeASin(float x) { return std::asin(<a href="#Clamp" class="code">Clamp</a>(x, -1, 1)); }
float <span class="anchor" id="SafeACos"></span>SafeACos(float x) { return std::acos(<a href="#Clamp" class="code">Clamp</a>(x, -1, 1)); }</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#LogarithmsandExponentiation"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="LogarithmsandExponentiation"></span><h3>B.2.4  Logarithms and Exponentiation</h3><p>


</p>
<p>Because the math library does not provide a base-2 logarithm function, we
provide one here, using the identity <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.636ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 8884.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">log Subscript 2 Baseline left-parenthesis x right-parenthesis equals log x slash log 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-67" d="M485 404c0 -23 -19 -30 -29 -30c-16 0 -29 12 -29 29c0 12 5 23 16 27c-3 1 -10 1 -10 1c-18 0 -54 -5 -90 -39c25 -23 41 -60 41 -97c0 -77 -69 -146 -162 -146c-19 0 -60 3 -99 31c-17 -20 -17 -43 -17 -47c0 -32 21 -63 53 -67c7 -1 50 -1 75 -1c61 0 119 0 172 -28 c51 -28 65 -79 65 -114c0 -78 -104 -129 -222 -129c-122 0 -221 55 -221 127c0 40 32 83 92 100c-31 20 -44 58 -44 89c0 35 18 68 31 83c-25 21 -47 59 -47 103c0 77 69 146 162 146c22 0 64 -3 106 -36c42 41 86 47 106 47c39 0 51 -32 51 -49zM309 296 c0 23 0 123 -87 123c-40 0 -63 -28 -71 -40c-15 -25 -16 -57 -16 -84c0 -23 0 -123 87 -123c40 0 63 28 71 40c15 25 16 57 16 84zM419 -79c0 86 -112 86 -198 86h-59c-44 -3 -82 -40 -82 -86c0 -53 69 -104 170 -104c98 0 169 50 169 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-6C"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-67" x="779" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1809" y="-343"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1733" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2122" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2695" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3362" y="0"></use>
<g transform="translate(4418,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-6C"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-67" x="779" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="5865" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="6437" y="0"></use>
<g transform="translate(6938,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-6C"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-67" x="779" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="8384" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-17"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-16"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-18"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="Log2"></span>Log2(Float x) {
    const Float invLog2 = 1.442695040888963387004650940071;
    return std::log(x) * invLog2;
}</div><p>


</p>
<p>If only the integer component of the base-2 logarithm of a <tt>float</tt> is
needed, then the result is available (nearly) in the exponent of the
floating-point representation.  In the implementation below, we augment
that approach by testing the significand of the provided value to the
midpoint of significand values between the current exponent and the next
one up, using the result to determine whether rounding the exponent up or
rounding it down gives a more accurate result.  A corresponding function for
<tt>double</tt>s is not included here.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-18"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-17"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-19"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">int <span class="anchor" id="Log2Int"></span><a href="#Log2Int" class="code">Log2Int</a>(float v) {
    if (v &lt; 1) return -<a href="#Log2Int" class="code">Log2Int</a>(1 / v);
    // midsignif = <a href="../Shapes/Managing_Rounding_Error.html#Significand" class="code">Significand</a>(std::pow(2., 1.5))
    const uint32_t midsignif = 0b00000000001101010000010011110011;
    return <a href="../Shapes/Managing_Rounding_Error.html#Exponent" class="code">Exponent</a>(v) + ((<a href="../Shapes/Managing_Rounding_Error.html#Significand" class="code">Significand</a>(v) &gt;= midsignif) ? 1 : 0);
}</div><p>


</p>
<p>

</p>
<p>It is also often useful to be able to compute the base-2 logarithm of an integer.
Rather than computing an expensive floating-point logarithm and converting
to an integer, it is much more efficient to count the number of leading
zeros up to the first one in the 32-bit binary representation of the value
and then subtract this value from 31, which gives the index of the first
bit set, which is in turn the integer base-2 logarithm.  (This efficiency
comes in part from the fact that most processors have an instruction to
count these zeros.)

</p>
<p>Though we generally eschew including target-specific code in the book text,
we will make an exception here just as an illustration of the messiness
that often results when it is necessary to leave the capabilities of the
standard libraries to access features that have different interfaces on
different targets. 

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-19"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-18"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-20"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">int Log2Int(uint32_t v) {
#ifdef PBRT_IS_GPU_CODE
    return 31 - __clz(v);
#elif defined(PBRT_HAS_INTRIN_H)
    unsigned long lz = 0;
    if (_BitScanReverse(&amp;lz, v))
        return lz;
    return 0;
#else
    return 31 - __builtin_clz(v);
#endif
}</div><p>


</p>
<p>

</p>
<p>It is occasionally useful to compute the base-4 logarithm of an integer
value.  This is easily done using the identity <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.718ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 8059.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">log Subscript 4 Baseline x equals left-parenthesis log Subscript 2 Baseline x right-parenthesis slash 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-67" d="M485 404c0 -23 -19 -30 -29 -30c-16 0 -29 12 -29 29c0 12 5 23 16 27c-3 1 -10 1 -10 1c-18 0 -54 -5 -90 -39c25 -23 41 -60 41 -97c0 -77 -69 -146 -162 -146c-19 0 -60 3 -99 31c-17 -20 -17 -43 -17 -47c0 -32 21 -63 53 -67c7 -1 50 -1 75 -1c61 0 119 0 172 -28 c51 -28 65 -79 65 -114c0 -78 -104 -129 -222 -129c-122 0 -221 55 -221 127c0 40 32 83 92 100c-31 20 -44 58 -44 89c0 35 18 68 31 83c-25 21 -47 59 -47 103c0 77 69 146 162 146c22 0 64 -3 106 -36c42 41 86 47 106 47c39 0 51 -32 51 -49zM309 296 c0 23 0 123 -87 123c-40 0 -63 -28 -71 -40c-15 -25 -16 -57 -16 -84c0 -23 0 -123 87 -123c40 0 63 28 71 40c15 25 16 57 16 84zM419 -79c0 86 -112 86 -198 86h-59c-44 -3 -82 -40 -82 -86c0 -53 69 -104 170 -104c98 0 169 50 169 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-6C"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-67" x="779" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-34" x="1809" y="-343"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="1900" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2750" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3806" y="0"></use>
<g transform="translate(4196,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-6C"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-67" x="779" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1809" y="-343"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="6096" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="6668" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="7058" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="7558" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-20"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-19"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-21"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
int <span class="anchor" id="Log4Int"></span>Log4Int(T v) { return <a href="#Log2Int" class="code">Log2Int</a>(v) / 2; }</div><p>


</p>
<p>




</p>
<p>An efficient approximation to the exponential function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.205ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 949.3 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="628" y="513"></use>
</g>
</svg> comes
in handy, especially for volumetric light transport algorithms where such
values need to be computed frequently.  Like <a href="#Log2Int"><tt>Log2Int()</tt></a>, this value
can be computed efficiently by taking advantage of the floating-point
representation.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-21"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-20"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-22"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">float <span class="anchor" id="FastExp"></span>FastExp(float x) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computexsuchthatromanex2x-0">Compute <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.231ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 960.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
</svg> such that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.346ex" height="2.843ex" style="vertical-align: -0.338ex;" viewBox="0 -1078.4 3593.3 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript x Baseline equals 2 Superscript x prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="628" y="513"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1227" y="0"></use>
<g transform="translate(2283,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="705" y="446"></use>
</g>
</g>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2718" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2718"><i></i></a><div id="fragbit-2718" class="collapse show"><div class="fragmentcode">       float xp = x * 1.442695041f;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Findintegerandfractionalcomponentsofx-0">Find integer and fractional components of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.231ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 960.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2719" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2719"><i></i></a><div id="fragbit-2719" class="collapse show"><div class="fragmentcode">       float fxp = pstd::floor(xp), f = xp - fxp;
       int i = (int)fxp;</div></div> 
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Evaluatepolynomialapproximationof2f-0">Evaluate polynomial approximation of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.302ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 991.2 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="707" y="557"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2720" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2720"><i></i></a><div id="fragbit-2720" class="collapse show"><div class="fragmentcode">       float twoToF = <a href="#EvaluatePolynomial" class="code">EvaluatePolynomial</a>(f, 1.f, 0.695556856f,
                                         0.226173572f, 0.0781455737f);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Scale2fby2iandreturnfinalresult-0">Scale <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.302ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 991.2 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="707" y="557"></use>
</g>
</svg> by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.962ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 844.8 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="707" y="557"></use>
</g>
</svg> and return final result</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2721" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2721"><i></i></a><div id="fragbit-2721" class="collapse show"><div class="fragmentcode">       int exponent = <a href="../Shapes/Managing_Rounding_Error.html#Exponent" class="code">Exponent</a>(twoToF) + i;
       if (exponent &lt; -126) return 0;
       if (exponent &gt; 127) return <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>;
       uint32_t bits = <a href="../Shapes/Managing_Rounding_Error.html#FloatToBits" class="code">FloatToBits</a>(twoToF);
       bits &amp;= 0b10000000011111111111111111111111u;
       bits |= (exponent + 127) &lt;&lt; 23;
       return <a href="../Shapes/Managing_Rounding_Error.html#BitsToFloat" class="code">BitsToFloat</a>(bits);</div></div>
}</div><p>


</p>
<p>The first step is to convert the problem into one to compute a base-2
exponential; a factor of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.233ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3114.3 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1 slash log 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-67" d="M485 404c0 -23 -19 -30 -29 -30c-16 0 -29 12 -29 29c0 12 5 23 16 27c-3 1 -10 1 -10 1c-18 0 -54 -5 -90 -39c25 -23 41 -60 41 -97c0 -77 -69 -146 -162 -146c-19 0 -60 3 -99 31c-17 -20 -17 -43 -17 -47c0 -32 21 -63 53 -67c7 -1 50 -1 75 -1c61 0 119 0 172 -28 c51 -28 65 -79 65 -114c0 -78 -104 -129 -222 -129c-122 0 -221 55 -221 127c0 40 32 83 92 100c-31 20 -44 58 -44 89c0 35 18 68 31 83c-25 21 -47 59 -47 103c0 77 69 146 162 146c22 0 64 -3 106 -36c42 41 86 47 106 47c39 0 51 -32 51 -49zM309 296 c0 23 0 123 -87 123c-40 0 -63 -28 -71 -40c-15 -25 -16 -57 -16 -84c0 -23 0 -123 87 -123c40 0 63 28 71 40c15 25 16 57 16 84zM419 -79c0 86 -112 86 -198 86h-59c-44 -3 -82 -40 -82 -86c0 -53 69 -104 170 -104c98 0 169 50 169 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="500" y="0"></use>
<g transform="translate(1167,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-6C"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-67" x="779" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="2613" y="0"></use>
</g>
</svg> does so.  This step makes it possible
to take advantage of computers&rsquo; native floating-point representation.

</p>
<p></p>
<span class="anchor" id="fragment-Computexsuchthatromanex2x-0"></span><div class="fragmentname">&lt;&lt;Compute <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.231ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 960.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
</svg> such that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.346ex" height="2.843ex" style="vertical-align: -0.338ex;" viewBox="0 -1078.4 3593.3 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript x Baseline equals 2 Superscript x prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="628" y="513"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1227" y="0"></use>
<g transform="translate(2283,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="705" y="446"></use>
</g>
</g>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">float xp = x * 1.442695041f;</div><p>


</p>
<p>Next, the function splits the exponent into an integer <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.197ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3529.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i equals left floor x prime right floor</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-230A" d="M416 -230c0 -11 -9 -20 -20 -20h-222v980c0 11 9 20 20 20s20 -9 20 -20v-940h182c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-230B" d="M270 -250h-222c-11 0 -20 9 -20 20s9 20 20 20h182v940c0 11 9 20 20 20s20 -9 20 -20v-980Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="623" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-230A" x="1679" y="0"></use>
<g transform="translate(2124,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-230B" x="3084" y="0"></use>
</g>
</svg> and a fractional part <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.256ex" height="2.676ex" style="vertical-align: -0.671ex;" viewBox="0 -863.1 4415.6 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f equals x prime minus i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="830" y="0"></use>
<g transform="translate(1886,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3069" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="4070" y="0"></use>
</g>
</svg>, giving <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.652ex" height="2.843ex" style="vertical-align: -0.338ex;" viewBox="0 -1078.4 7600 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript x prime Baseline equals 2 Superscript i plus f Baseline equals 2 Superscript i Baseline 2 Superscript f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="705" y="446"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1587" y="0"></use>
<g transform="translate(2644,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2B" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1124" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="4707" y="0"></use>
<g transform="translate(5764,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="707" y="557"></use>
</g>
<g transform="translate(6608,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="707" y="557"></use>
</g>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-Findintegerandfractionalcomponentsofx-0"></span><div class="fragmentname">&lt;&lt;Find integer and fractional components of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.231ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 960.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x prime</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="809" y="513"></use>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">float fxp = pstd::floor(xp), f = xp - fxp;
int i = (int)fxp;</div><p>


</p>
<p>Because <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg> is between&nbsp;0 and&nbsp;1, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.302ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 991.2 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="707" y="557"></use>
</g>
</svg> can be accurately approximated with a
polynomial.  We have fit a cubic polynomial to this function using a
constant term of&nbsp;1 so that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.217ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 954.4 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="707" y="557"></use>
</g>
</svg> is exact.  The following coefficients give
a maximum absolute error of less than <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.459ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2781 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.0002</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1279" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1780" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="2280" y="0"></use>
</g>
</svg> over the range of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-Evaluatepolynomialapproximationof2f-0"></span><div class="fragmentname">&lt;&lt;Evaluate polynomial approximation of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.302ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 991.2 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="707" y="557"></use>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">float twoToF = <a href="#EvaluatePolynomial" class="code">EvaluatePolynomial</a>(f, 1.f, 0.695556856f,
                                  0.226173572f, 0.0781455737f);</div><p>


</p>
<p>The last task is to apply the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.962ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 844.8 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="707" y="557"></use>
</g>
</svg> scale.  This can be done by directly
operating on the exponent in the <tt>twoToF</tt> value.  It is necessary to
make sure that the resulting exponent fits in the valid exponent range of
32-bit <tt>float</tt>s; if it does not, then the computation has either
underflowed to&nbsp;0 or overflowed to infinity.  If the exponent is
valid, then the existing exponent bits are cleared so that final exponent
can be stored.  (For the source of the value of 127 that is added to the
exponent, see Equation&nbsp;(<a href="../Shapes/Managing_Rounding_Error.html#eq:float-exponent-bias">6.17</a>).)

</p>
<p></p>
<span class="anchor" id="fragment-Scale2fby2iandreturnfinalresult-0"></span><div class="fragmentname">&lt;&lt;Scale <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.302ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 991.2 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="707" y="557"></use>
</g>
</svg> by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.962ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 844.8 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="707" y="557"></use>
</g>
</svg> and return final result&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int exponent = <a href="../Shapes/Managing_Rounding_Error.html#Exponent" class="code">Exponent</a>(twoToF) + i;
if (exponent &lt; -126) return 0;
if (exponent &gt; 127) return <a href="../Shapes/Managing_Rounding_Error.html#Infinity" class="code">Infinity</a>;
uint32_t bits = <a href="../Shapes/Managing_Rounding_Error.html#FloatToBits" class="code">FloatToBits</a>(twoToF);
bits &amp;= 0b10000000011111111111111111111111u;
bits |= (exponent + 127) &lt;&lt; 23;
return <a href="../Shapes/Managing_Rounding_Error.html#BitsToFloat" class="code">BitsToFloat</a>(bits);</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#TranscendentalandSpecialFunctions"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:math-special-funcs"></span><span id="TranscendentalandSpecialFunctions"></span><h3>B.2.5  Transcendental and Special Functions</h3><p>



</p>
<p><tt>Gaussian()</tt> evaluates the Gaussian function
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.256ex" height="7.176ex" style="vertical-align: -2.838ex;" viewBox="0 -1867.7 12165.7 3089.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">g left-parenthesis x comma mu comma sigma right-parenthesis equals StartFraction 1 Over StartRoot 2 pi sigma squared EndRoot EndFraction normal e Superscript minus StartFraction left-parenthesis x minus mu right-parenthesis squared Over 2 sigma squared EndFraction Baseline period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D454" d="M474 395c0 -7 -2 -12 -3 -18l-111 -444c-15 -60 -87 -138 -212 -138c-96 0 -133 20 -133 61c0 40 32 58 54 58c27 0 38 -19 38 -35c0 -17 -11 -43 -41 -52c28 -9 61 -10 80 -10c106 0 140 99 144 108l33 132l-1 1c-10 -11 -57 -58 -116 -58c-72 0 -133 59 -133 158 c0 144 124 284 238 284c40 0 75 -26 93 -63c4 36 31 43 41 43c17 0 29 -10 29 -27zM392 334c0 5 -14 86 -80 86c-42 0 -85 -40 -112 -89c-27 -51 -56 -169 -56 -217c0 -40 15 -92 65 -92c29 0 60 18 81 36c22 19 45 44 51 70l48 191c1 4 3 10 3 15Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D707" d="M572 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-44 0 -81 28 -90 73c-24 -28 -63 -73 -133 -73c-20 0 -65 4 -97 31c-38 -154 -51 -206 -55 -215c-2 -3 -14 -21 -35 -21c-17 0 -28 12 -28 27c0 0 0 4 3 16l144 579c9 35 37 36 40 36c17 0 29 -10 29 -27 c0 -5 -10 -43 -15 -64l-42 -168c-7 -28 -14 -56 -14 -85c0 -54 24 -87 74 -87c81 0 129 91 130 96l26 102l47 187c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104c0 -20 3 -46 30 -46 c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-221A" d="M853 20c0 -5 -1 -6 -6 -17l-456 -944c-7 -15 -9 -19 -25 -19c-11 0 -13 1 -19 15l-198 435l-52 -39c-9 -8 -11 -8 -14 -8c-6 0 -10 4 -10 11c0 4 1 5 12 14l99 75c9 8 11 8 14 8c7 0 9 -6 13 -14l178 -392l423 876c6 12 9 19 21 19s20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D454" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="477" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="867" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1439" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D707" x="1884" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2488" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="2933" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3504" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="4172" y="0"></use>
<g transform="translate(4950,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="3049" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1274" y="676"></use>
<g transform="translate(60,-961)">
 <use xlink:href="#E1-LATINMODERNMAIN-221A" x="0" y="840"></use>
<rect stroke="none" width="2096" height="60" x="833" y="821"></rect>
<g transform="translate(833,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="500" y="0"></use>
<g transform="translate(1071,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="808" y="408"></use>
</g>
</g>
</g>
</g>
</g>
<g transform="translate(8518,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,681)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
<g transform="translate(550,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="2033" height="60" x="0" y="146"></rect>
<g transform="translate(60,514)">
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="389" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-2212" x="962" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNNORMAL-1D707" x="1740" y="0"></use>
<g transform="translate(1345,0)">
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="389" y="362"></use>
</g>
</g>
<g transform="translate(536,-567)">
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(287,0)">
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="571" y="288"></use>
</g>
</g>
</g>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11887" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-22"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-21"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-23"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="Gaussian"></span>Gaussian(Float x, Float mu = 0, Float sigma = 1) {
    return 1 / std::sqrt(2 * <a href="#Pi" class="code">Pi</a> * sigma * sigma) *
           <a href="#FastExp" class="code">FastExp</a>(-<a href="#Sqr" class="code">Sqr</a>(x - mu) / (2 * sigma * sigma));
}</div><p>


</p>
<p>The integral of the Gaussian over a range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.095ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3055 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket x 0 comma x 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
<g transform="translate(278,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1304" y="0"></use>
<g transform="translate(1750,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2776" y="0"></use>
</g>
</svg> can be expressed in
terms of the error function, which is available from the standard library.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-23"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-22"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-24"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="GaussianIntegral"></span>GaussianIntegral(Float x0, Float x1, Float mu = 0, Float sigma = 1) {
    Float sigmaRoot2 = sigma * Float(1.414213562373095);
    return 0.5f * (std::erf((mu - x0) / sigmaRoot2) -
                   std::erf((mu - x1) / sigmaRoot2));
}</div><p>


</p>
<p>The logistic distribution takes a scale factor <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg>, which controls its
width:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="23.571ex" height="6.676ex" style="vertical-align: -2.838ex;" viewBox="0 -1652.5 10148.8 2874.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">l left-parenthesis x comma s right-parenthesis equals StartFraction normal e Superscript negative x slash s Baseline Over s left-parenthesis 1 plus normal e Superscript negative x slash s Baseline right-parenthesis squared EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D459" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="298" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="688" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1260" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="1705" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2175" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2842" y="0"></use>
<g transform="translate(3620,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="5731" height="60" x="0" y="220"></rect>
<g transform="translate(1772,676)">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,362)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="778" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2F" x="1351" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D460" x="1851" y="0"></use>
</g>
</g>
<g transform="translate(60,-840)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="469" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1581" y="0"></use>
<g transform="translate(2582,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,288)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D465" x="778" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2F" x="1351" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D460" x="1851" y="0"></use>
</g>
</g>
<g transform="translate(4768,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="550" y="408"></use>
</g>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="9870" y="0"></use>
</g>
</svg>
</div>
<p>

It has a generally similar shape to the Gaussian&mdash;it is symmetric and
smoothly falls off from its peak&mdash;but it can be integrated in closed form.
Evaluating the logistic is straightforward, though it is worth taking the
absolute value of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> to avoid numerical instability for when the ratio
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.583ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1542.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x slash s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="572" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="1073" y="0"></use>
</g>
</svg> is relatively large.  (The function is symmetric around the origin,
so this is mathematically equivalent.)

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-24"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-23"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-25"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="Logistic"></span>Logistic(Float x, Float s) {
    x = std::abs(x);
    return std::exp(-x / s) / (s * <a href="#Sqr" class="code">Sqr</a>(1 + std::exp(-x / s)));
}</div><p>


</p>
<p>The logistic function is normalized so it is its own probability density
function (PDF).  Its cumulative
distribution function (CDF) can be easily found via integration.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-25"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-24"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-26"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="LogisticCDF"></span>LogisticCDF(Float x, Float s) { return 1 / (1 + std::exp(-x / s)); }</div><p>


</p>
<p>The trimmed logistic function is the logistic limited to an interval
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.555ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1961.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
</g>
</svg> and then renormalized using the technique introduced in
Section&nbsp;<a href="../Sampling_Algorithms/Sampling_1D_Functions.html#sec:sampling-function-over-interval">A.4.5</a>.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-26"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-25"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-27"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="TrimmedLogistic"></span>TrimmedLogistic(Float x, Float s, Float a, Float b) {
    return <a href="#Logistic" class="code">Logistic</a>(x, s) / (<a href="#LogisticCDF" class="code">LogisticCDF</a>(b, s) - <a href="#LogisticCDF" class="code">LogisticCDF</a>(a, s));
}</div><p>


</p>
<p><tt>ErfInv()</tt> is the inverse to the error function <tt>std:erf()</tt>,
implemented via a polynomial approximation. <tt>I0()</tt> evaluates the
modified Bessel function of the first kind and <tt>LogI0()</tt> returns its
logarithm.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-27"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-26"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-28"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="ErfInv"></span>ErfInv(Float a);
Float <span class="anchor" id="I0"></span>I0(Float x);
Float <span class="anchor" id="LogI0"></span>LogI0(Float x);</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#IntervalSearch"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="IntervalSearch"></span><h3>B.2.6  Interval Search</h3><p>


</p>
<p><tt>FindInterval()</tt> is a helper function that emulates the behavior of
<tt>std::upper_bound()</tt> but uses a function object to get values at
various indices instead of requiring access to an actual array. This way,
it becomes possible to bisect arrays that are procedurally generated, such
as those interpolated from point samples.

</p>
<p>It generally returns the index <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg> such that <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.141ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3074.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p normal r normal e normal d left-parenthesis i right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="556" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="949" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="1393" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1950" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="2339" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2685" y="0"></use>
</g>
</svg> is true and
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.144ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4797.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p normal r normal e normal d left-parenthesis i plus 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="556" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="949" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="1393" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1950" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="2339" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="2907" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="3907" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4408" y="0"></use>
</g>
</svg> is false.  However, since this function is primarily used
to locate an interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.451ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3638.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis i comma i plus 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="735" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1180" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1747" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2748" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3249" y="0"></use>
</g>
</svg> for linear interpolation, it applies the
following boundary conditions to prevent out-of-bounds accesses and to deal
with predicates that evaluate to true or false over the entire domain:
</p>
<ul>
<li> The returned index <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg> is no larger than <tt>sz-2</tt>, so that it is
always legal to access both of the elements <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.805ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2068.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i plus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1568" y="0"></use>
</g>
</svg>.
<li> If there is no index such that the predicate is true, 0&nbsp;is returned.
<li> If there is no index such that the predicate is false, <tt>sz-2</tt> is
returned.
</ul><p>


</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-28"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-27"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-29"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename Predicate&gt;
size_t <span class="anchor" id="FindInterval"></span>FindInterval(size_t sz, const Predicate &amp;pred) {
    using ssize_t = std::make_signed_t&lt;size_t&gt;;
    ssize_t size = (ssize_t)sz - 2, first = 1;
    while (size &gt; 0) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Evaluatepredicateatmidpointandupdatemonofirstandmonosize-0">Evaluate predicate at midpoint and update <tt>first</tt> and <tt>size</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2722" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2722"><i></i></a><div id="fragbit-2722" class="collapse show"><div class="fragmentcode">           size_t half = (size_t)size &gt;&gt; 1, middle = first + half;
           bool predResult = pred(middle);
           first = predResult ? middle + 1 : first;
           size = predResult ? size - (half + 1) : half;</div></div>
    }
    return (size_t)<a href="#Clamp" class="code">Clamp</a>((ssize_t)first - 1, 0, sz - 2);
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-Evaluatepredicateatmidpointandupdatemonofirstandmonosize-0"></span><div class="fragmentname">&lt;&lt;Evaluate predicate at midpoint and update <tt>first</tt> and <tt>size</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">size_t half = (size_t)size &gt;&gt; 1, middle = first + half;
bool predResult = pred(middle);
first = predResult ? middle + 1 : first;
size = predResult ? size - (half + 1) : half;</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#BitOperations"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:bit-ops"></span><span id="BitOperations"></span><h3>B.2.7  Bit Operations</h3><p>



</p>
<p>There are clever tricks that can be used to efficiently determine if a
given integer is an exact power of&nbsp;2, or round an integer up to the next
higher (or equal) power of&nbsp;2.  (It is worthwhile to take a minute and work
through for yourself how these two functions work.)

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-29"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-28"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-30"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
bool <span class="anchor" id="IsPowerOf2"></span>IsPowerOf2(T v) { return v &amp;&amp; !(v &amp; (v - 1)); }</div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-30"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-29"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-31"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">int32_t <span class="anchor" id="RoundUpPow2"></span>RoundUpPow2(int32_t v) {
    v--;
    v |= v &gt;&gt; 1;
    v |= v &gt;&gt; 2;
    v |= v &gt;&gt; 4;
    v |= v &gt;&gt; 8;
    v |= v &gt;&gt; 16;
    return v + 1;
}</div><p>


</p>
<p>A variant of <tt>RoundUpPow2()</tt> for <tt>int64_t</tt> is also provided but
is not included in the text here.

</p>
<p>

</p>
<p>

</p>
<p>The bits of an integer quantity can be efficiently reversed with a series
of bitwise operations.  The first line of the <tt>ReverseBits32()</tt>
function, which reverses the bits of a 32-bit integer, swaps the lower 16
bits with the upper 16 bits of the value.  The next line simultaneously
swaps the first 8 bits of the result with the second 8 bits and the third 8
bits with the fourth.  This process continues until the last line, which
swaps adjacent bits.

To understand this code, it is helpful to write out
the binary values of the various hexadecimal constants.  For example,
<tt>0xff00ff00</tt> is 11111111000000001111111100000000 in binary; it is
then easy to see that a bitwise <span style="font-variant: small-caps;">or</span>
with this value masks off the first and third 8-bit quantities.

</p>
<p></p>
<span class="anchor" id="fragment-BitOperationInlineFunctions-0"></span><div class="fragmentname">&lt;&lt;Bit Operation Inline Functions&gt;&gt;=&nbsp;<a href="#fragment-BitOperationInlineFunctions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">inline uint32_t <span class="anchor" id="ReverseBits32"></span>ReverseBits32(uint32_t n) {
    n = (n &lt;&lt; 16) | (n &gt;&gt; 16);
    n = ((n &amp; 0x00ff00ff) &lt;&lt; 8) | ((n &amp; 0xff00ff00) &gt;&gt; 8);
    n = ((n &amp; 0x0f0f0f0f) &lt;&lt; 4) | ((n &amp; 0xf0f0f0f0) &gt;&gt; 4);
    n = ((n &amp; 0x33333333) &lt;&lt; 2) | ((n &amp; 0xcccccccc) &gt;&gt; 2);
    n = ((n &amp; 0x55555555) &lt;&lt; 1) | ((n &amp; 0xaaaaaaaa) &gt;&gt; 1);
    return n;
}</div><p>


</p>
<p>The bits of a 64-bit value can then be reversed by reversing the two 32-bit
components individually and then interchanging them.

</p>
<p></p>
<span class="anchor" id="fragment-BitOperationInlineFunctions-1"></span><div class="fragmentname">&lt;&lt;Bit Operation Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BitOperationInlineFunctions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-BitOperationInlineFunctions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">inline uint64_t <span class="anchor" id="ReverseBits64"></span>ReverseBits64(uint64_t n) {
    uint64_t n0 = ReverseBits32((uint32_t)n);
    uint64_t n1 = ReverseBits32((uint32_t)(n &gt;&gt; 32));
    return (n0 &lt;&lt; 32) | n1;
}</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#x7-MortonIndexing"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="x7-MortonIndexing"></span><h4>Morton Indexing</h4><p>


</p>
<p>
To be able to compute 3D Morton codes, which were introduced in
Section&nbsp;<a href="../Primitives_and_Intersection_Acceleration/Bounding_Volume_Hierarchies.html#sec:hlbvh">7.3.3</a>, we will first define a helper function:
<tt>LeftShift3()</tt> takes a 32-bit value and returns the result of shifting
the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg>th bit to be at the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.965ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 846 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">3 i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="500" y="0"></use>
</g>
</svg>th bit, leaving zeros in other bits.
Figure&nbsp;<a href="#fig:morton-bits-3x">B.1</a> illustrates this operation.

</p>
<p> </p>
<span class="anchor" id="fig:morton-bits-3x"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="phabbf01.svg" title=""><img src="phabbf01.svg" width=747 height=152 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure B.1: Bit Shifts to Compute 3D Morton Codes. <span class="legend">
  The <tt>LeftShift3()</tt> function takes a 32-bit integer value
  and for the bottom 10 bits, shifts the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg>th bit to be in position
  <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.965ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 846 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">3 i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="500" y="0"></use>
</g>
</svg>&mdash;in other words, shifts it <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.965ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 846 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="500" y="0"></use>
</g>
</svg> places to the left.  All other bits
  are set to zero.
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>
The most obvious approach to implement this operation, shifting each bit
value individually, is not the most efficient.  (It would require a total
of 9 shifts, along with bitwise <span style="font-variant: small-caps;">or</span> operations to compute the final value.)  Instead,
we can decompose each bit&rsquo;s shift into multiple shifts of power-of-two size
that together shift the bit&rsquo;s value to its final position.  Then, all 
the bits that need to be shifted a given power-of-two number of places can
be shifted together.  The <tt>LeftShift3()</tt> function implements this
computation, and Figure&nbsp;<a href="#fig:morton-pow2-shifts">B.2</a> shows how it works.

</p>
<p></p>
<span class="anchor" id="fig:morton-pow2-shifts"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="phabbf02.svg" title=""><img src="phabbf02.svg" width=747 height=232 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure B.2: Power-of-Two Decomposition of Morton Bit Shifts. <span class="legend">
The bit shifts to compute the Morton code for each 3D coordinate are
performed in a series of shifts of power-of-two size.  First, bits 8 and 9
are shifted 16 places to the left.  This places bit 8 in its final
position.  Next bits 4 through 7 are shifted 8 places.  After shifts of 4
and 2 places (with appropriate masking so that each bit is shifted the
right number of places in the end), all bits are in the proper
position. This computation is implemented by the <a href="#LeftShift3"><tt>LeftShift3()</tt></a>
function.
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-BitOperationInlineFunctions-2"></span><div class="fragmentname">&lt;&lt;Bit Operation Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BitOperationInlineFunctions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-BitOperationInlineFunctions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">inline uint32_t <span class="anchor" id="LeftShift3"></span>LeftShift3(uint32_t x) {
    if (x == (1 &lt;&lt; 10))
        --x;
    x = (x | (x &lt;&lt; 16)) &amp; 0b00000011000000000000000011111111;
    x = (x | (x &lt;&lt; 8)) &amp; 0b00000011000000001111000000001111;
    x = (x | (x &lt;&lt; 4)) &amp; 0b00000011000011000011000011000011;
    x = (x | (x &lt;&lt; 2)) &amp; 0b00001001001001001001001001001001;
    return x;
}</div><p>


</p>
<p><tt>EncodeMorton3()</tt> takes a 3D coordinate value where each component is
a floating-point value between 0 and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 1308.3 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript 10</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="500" y="0"></use>
</g>
</g>
</svg>.  It converts these values to
integers and then computes the Morton code by expanding the three 10-bit
quantized values so that their <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 345.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
</g>
</svg>th bits are at position <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.965ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 846 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">3 i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="500" y="0"></use>
</g>
</svg>, then
shifting the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> bits over one more, the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> bits over two more, and
computing the bitwise <span style="font-variant: small-caps;">or</span> of the result
(Figure&nbsp;<a href="#fig:morton-final-interleave">B.3</a>).

</p>
<p></p>
<span class="anchor" id="fig:morton-final-interleave"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="phabbf03.svg" title=""><img src="phabbf03.svg" width=747 height=183 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure B.3: Final Interleaving of Coordinate Values. <span class="legend">
  Given interleaved values for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg>, and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> computed by
  <tt>LeftShift3()</tt>, the final Morton-encoded value is computed by
  shifting <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.139ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 490.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">y</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.086ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 467.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">z</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D467" d="M467 432c0 -4 -22 -52 -117 -145c-36 -36 -98 -90 -98 -90c-36 -31 -65 -56 -119 -114c9 3 27 3 27 3c21 0 36 -4 70 -17c21 -7 39 -13 59 -13c33 0 97 19 120 84c3 7 5 13 14 13c8 0 12 -5 12 -10c0 -27 -58 -154 -157 -154c-29 0 -47 16 -64 37c-25 29 -35 38 -58 38 c-32 0 -62 -27 -85 -62c-6 -11 -8 -13 -16 -13c0 0 -12 0 -12 10c0 7 35 64 103 131l90 84c19 16 103 88 139 131c-26 0 -37 0 -77 15c-23 8 -42 15 -63 15c-8 0 -66 -1 -85 -47c-2 -6 -4 -11 -13 -11s-12 6 -12 11c0 21 46 114 121 114c33 0 50 -20 69 -43 c15 -17 27 -32 51 -32s45 16 75 64c5 9 8 11 15 11c0 0 11 0 11 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D467" x="0" y="0"></use>
</g>
</svg> one and two places, respectively, and then computing
  the bitwise OR of the results.
</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-BitOperationInlineFunctions-3"></span><div class="fragmentname">&lt;&lt;Bit Operation Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BitOperationInlineFunctions-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">uint32_t <span class="anchor" id="EncodeMorton3"></span>EncodeMorton3(float x, float y, float z) {
    return (LeftShift3(z) &lt;&lt; 2) | (LeftShift3(y) &lt;&lt; 1) | LeftShift3(x);
}</div><p>


</p>
<p>

</p>
<p>Support for 2D Morton encoding is provided by the
<tt>EncodeMorton2()</tt><span class="anchor" id="EncodeMorton2"></span> function, which takes a
pair of 32-bit integer values and follows an analogous approach.  It is
not included here.

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#HashingandRandomPermutations"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:hashing-and-permutations"></span><span id="HashingandRandomPermutations"></span><h3>B.2.8  Hashing and Random Permutations</h3><p>



</p>
<p>A handful of hashing functions are provided.  Their implementations are in
the file <a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/[EntityList: util/cmd: -:
hash.h]"><tt>[EntityList: util/cmd: -:
hash.h]</tt></a>.

</p>
<p>The first, <tt>MixBits()</tt>, takes an integer value and applies a so-called
<em>finalizer</em>, which is commonly found at the end of hash function
implementations.  A good hash function has the property that flipping a
single bit in the input causes each of the bits in the result to flip with
probability <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.487ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1501.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1 slash 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1001" y="0"></use>
</g>
</svg>; a finalizer takes values where this may not be the case
and shuffles them around in a way that increases this likelihood.

</p>
<p><tt>MixBits()</tt> is particularly handy for tasks like computing unique
seeds for a pseudo-random number generator at each pixel: depending on the
RNG implementation, the naive approach of converting the pixel coordinates
into an index and giving the RNG successive integer values as seeds may lead
to correlation between values it generates at nearby pixels.  Running such an
index through <tt>MixBits()</tt> first is good protection against this.

</p>
<p></p>
<span class="anchor" id="fragment-HashingInlineFunctions-0"></span><div class="fragmentname">&lt;&lt;Hashing Inline Functions&gt;&gt;=&nbsp;<a href="#fragment-HashingInlineFunctions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">uint64_t <span class="anchor" id="MixBits"></span>MixBits(uint64_t v);</div><p>


</p>
<p>

</p>
<p>There are also complete hash functions for arbitrary data.
<tt>HashBuffer()</tt> hashes a region of memory of given size using
<em>MurmurHash64A</em>, which is an efficient and high-quality hash function.

</p>
<p></p>
<span class="anchor" id="fragment-HashingInlineFunctions-1"></span><div class="fragmentname">&lt;&lt;Hashing Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-HashingInlineFunctions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-HashingInlineFunctions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
uint64_t <span class="anchor" id="HashBuffer"></span>HashBuffer(const T *ptr, size_t size, uint64_t seed = 0) {
    return MurmurHash64A((const unsigned char *)ptr, size, seed);
}</div><p>


</p>
<p>For convenience, <tt>pbrt</tt> also provides a <tt>Hash()</tt> function that can be
passed an arbitrary sequence of values, all of which are hashed together.

</p>
<p></p>
<span class="anchor" id="fragment-HashingInlineFunctions-2"></span><div class="fragmentname">&lt;&lt;Hashing Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-HashingInlineFunctions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-HashingInlineFunctions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename... Args&gt;
uint64_t <span class="anchor" id="Hash"></span>Hash(Args... args);</div><p>


</p>
<p>

</p>
<p>It is sometimes useful to convert a hash to a floating-point value
between&nbsp;0 and&nbsp;1; the <tt>HashFloat()</tt> function handles the details of
doing so. 

</p>
<p></p>
<span class="anchor" id="fragment-HashingInlineFunctions-3"></span><div class="fragmentname">&lt;&lt;Hashing Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-HashingInlineFunctions-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;typename... Args&gt;
Float <span class="anchor" id="HashFloat"></span>HashFloat(Args... args) { return uint32_t(<a href="#Hash" class="code">Hash</a>(args...)) * 0x1p-32f; }</div><p>


</p>
<p><tt>PermutationElement()</tt> returns the <tt>i</tt>th element of a random
permutation of <tt>n</tt> values based on the provided seed.  Remarkably, it is
able to do so without needing to explicitly represent the
permutation.  The key idea underlying its implementation is the insight
that any invertible hash function of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 600.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
</g>
</svg> bits represents a permutation of
the values from 0 to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.384ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2748.6 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript n Baseline minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="707" y="557"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1247" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2248" y="0"></use>
</g>
</svg>&mdash;otherwise, it would not be invertible.

</p>
<p>Such a hash function can be used to define a permutation over a
non-power-of-two number of elements <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 600.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
</g>
</svg> using the permutation for the next
power-of-two number of elements and then repermuting any values greater
than <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 600.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
</g>
</svg> until a valid one is reached.

</p>
<p></p>
<span class="anchor" id="fragment-PermutationInlineFunctionDeclarations-0"></span><div class="fragmentname">&lt;&lt;Permutation Inline Function Declarations&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int <span class="anchor" id="PermutationElement"></span>PermutationElement(uint32_t i, uint32_t n, uint32_t seed);</div><p>


</p>
<p>

</p>
<p>
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#Error-FreeTransformations"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:fp-error-free-xforms"></span><span id="Error-FreeTransformations"></span><h3>B.2.9  Error-Free Transformations<button data-toggle="tooltip" data-placement="right" class="btn difficult-button"
title="This section contains advanced content and may be skipped on a first reading.">
<i class="fas fa-exclamation-triangle midredtext"></i></button>
</h3><p>



</p>
<p>It is possible to increase the accuracy of some floating-point calculations
using an approach known as <em>error-free transformations</em> (EFT).  The
idea of them is to maintain the accumulated error that is in a computed
floating-point value and to then make use of that error to correct later
computations.  For example, we know that the rounded floating-point value
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.068ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2181.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a circled-times b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2297" d="M691 250c0 76 -28 146 -75 199l-199 -199l199 -199c47 53 75 123 75 199zM588 477c-53 47 -123 75 -199 75s-146 -28 -199 -75l199 -199zM361 250l-199 199c-47 -53 -75 -123 -75 -199s28 -146 75 -199zM588 23l-199 199l-199 -199c53 -47 123 -75 199 -75s146 28 199 75 zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2297" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
</g>
</svg> is in general not equal to the true product <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.068ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2181.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a times b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
</g>
</svg>.  Using
EFTs, we also compute an error term <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.083ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 466.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
</g>
</svg> such that 
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="19.614ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 8444.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a circled-times b equals left-parenthesis a times b right-parenthesis plus e period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2297" d="M691 250c0 76 -28 146 -75 199l-199 -199l199 -199c47 53 75 123 75 199zM588 477c-53 47 -123 75 -199 75s-146 -28 -199 -75l199 -199zM361 250l-199 199c-47 -53 -75 -123 -75 -199s28 -146 75 -199zM588 23l-199 199l-199 -199c53 -47 123 -75 199 -75s146 28 199 75 zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2297" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2459" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3516" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="3905" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="4657" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="5657" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="6087" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6699" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="7699" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="8166" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p>A clever use of fused multiply add (FMA) makes it
possible to compute <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.083ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 466.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
</g>
</svg> without resorting to
higher-precision floating-point numbers.  Consider the computation
<tt>FMA(-a, b, a * b)</tt>: on the face of it, it computes zero, adding the
negated product of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.23ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 529.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg> to itself.  In the context of the FMA
operation, however, it gives the rounding error, since the product of
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.038ex" height="2.176ex" style="vertical-align: -0.505ex;" viewBox="0 -719.6 1308 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">negative a</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="778" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg> is not rounded before <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.068ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2181.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a circled-times b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2297" d="M691 250c0 76 -28 146 -75 199l-199 -199l199 -199c47 53 75 123 75 199zM588 477c-53 47 -123 75 -199 75s-146 -28 -199 -75l199 -199zM361 250l-199 199c-47 -53 -75 -123 -75 -199s28 -146 75 -199zM588 23l-199 199l-199 -199c53 -47 123 -75 199 -75s146 28 199 75 zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2297" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
</g>
</svg>, which is rounded, is
added to it.

</p>
<p><tt>TwoProd()</tt> multiplies two numbers and determines the error, returning
both results using the <tt>CompensatedFloat</tt> structure.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-31"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-30"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-32"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">CompensatedFloat <span class="anchor" id="TwoProd"></span>TwoProd(Float a, Float b) {
    Float ab = a * b;
    return {ab, FMA(a, b, -ab)};
}</div><p>


</p>
<p><tt>CompensatedFloat</tt> is a small wrapper class that holds the results of
EFT-based computations.

</p>
<p></p>
<span class="anchor" id="fragment-CompensatedFloatDefinition-0"></span><div class="fragmentname">&lt;&lt;CompensatedFloat Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">struct <span class="anchor" id="CompensatedFloat"></span>CompensatedFloat {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-CompensatedFloatPublicMethods-0">CompensatedFloat Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2723" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2723"><i></i></a><div id="fragbit-2723" class="collapse show"><div class="fragmentcode">       CompensatedFloat(Float v, Float err = 0) : v(v), err(err) {}
       explicit operator float() const { return v + err; }
       explicit operator double() const { return double(v) + double(err); }
       </div></div>
    Float <span class="anchor" id="CompensatedFloat::v"></span>v, <span class="anchor" id="CompensatedFloat::err"></span>err;
};</div><p>


</p>
<p>It provides the expected constructor and conversion operators, which are
qualified with <tt>explicit</tt> to force callers to express their intent to
use them.

</p>
<p></p>
<span class="anchor" id="fragment-CompensatedFloatPublicMethods-0"></span><div class="fragmentname">&lt;&lt;CompensatedFloat Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">CompensatedFloat(Float v, Float err = 0) : v(v), err(err) {}
explicit operator float() const { return v + err; }
explicit operator double() const { return double(v) + double(err); }
</div><p>


</p>
<p>It is also possible to compute a compensation term <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.083ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 466.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
</g>
</svg> for floating-point
addition of two values: <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.967ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 8166.4 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a circled-plus b equals left-parenthesis a plus b right-parenthesis plus e</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2295" d="M690 270c-10 151 -130 271 -281 281v-281h281zM369 270v281c-151 -10 -271 -130 -281 -281h281zM369 -51v281h-281c10 -151 130 -271 281 -281zM690 230h-281v-281c151 10 271 130 281 281zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342 s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2295" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2459" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3516" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="3905" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="4657" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="5657" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="6087" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6699" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="7699" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-32"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-31"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-33"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">CompensatedFloat <span class="anchor" id="TwoSum"></span>TwoSum(Float a, Float b) {
    Float s = a + b, delta = s - a;
    return {s, (a - (s - delta)) + (b - delta)};
}</div><p>


</p>
<p>It is not in general possible to compute exact compensation terms for sums
or products of more than two values.  However, maintaining them anyway,
even if they carry some rounding error, makes it possible to implement
various algorithms with lower error than if they were not used.

</p>
<p>A similar trick based on FMA can be applied to the difference-of-products
calculation of the form <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.964ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 5581.8 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a times b minus c times d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2404" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3404" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="4060" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="5061" y="0"></use>
</g>
</svg>.  To understand the
challenge involved in this computation, consider computing this difference
as <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.609ex" height="3.676ex" style="vertical-align: -1.171ex;" viewBox="0 -1078.4 8012.2 1582.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">monospace upper F monospace upper M monospace upper A monospace left-parenthesis monospace a monospace comma monospace b monospace comma negative monospace c circled-times monospace d monospace right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D675" d="M490 497c0 -20 0 -41 -35 -41c-34 0 -34 22 -34 41v53h-250v-214h136c0 41 0 57 35 57c34 0 34 -22 34 -41v-93c0 -19 0 -41 -34 -41c-35 0 -35 16 -35 57h-136v-214h52c16 0 40 0 40 -31c0 -30 -25 -30 -40 -30h-154c-15 0 -41 0 -41 30c0 31 25 31 41 31h33v489h-33 c-15 0 -41 0 -41 30c0 31 25 31 41 31h381c34 0 40 -10 40 -41v-73Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D67C" d="M507 30c0 -30 -25 -30 -40 -30h-82c-15 0 -40 0 -40 30c0 31 21 31 53 31v477h-1c-12 -53 -97 -306 -100 -312c-8 -14 -22 -22 -35 -22c-12 0 -24 7 -30 15c-5 7 -18 45 -26 68c-4 13 -68 205 -79 251h-1v-477c32 0 53 0 53 -31c0 -30 -25 -30 -40 -30h-82 c-15 0 -40 0 -40 30c0 31 21 31 53 31v489c-32 0 -53 0 -53 31c0 30 25 30 40 30h56c14 0 39 0 49 -24c2 -6 90 -265 100 -312h1c6 29 15 58 27 94l67 202c9 26 13 40 54 40h56c15 0 40 0 40 -30c0 -31 -21 -31 -53 -31v-489c32 0 53 0 53 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D670" d="M497 30c0 -30 -26 -30 -43 -30h-102c-18 0 -42 0 -42 30c0 31 20 31 56 31l-23 104h-162l-23 -104c36 0 56 0 56 -31c0 -30 -24 -30 -42 -30h-102c-17 0 -43 0 -43 30c0 13 6 23 17 29c6 2 29 2 43 2l121 524c9 38 25 38 54 38c31 0 45 -1 54 -39l121 -523 c15 0 37 0 43 -3c12 -5 17 -15 17 -28zM328 226l-66 314l-66 -314h132Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68A" d="M519 31c0 -31 -22 -31 -50 -31c-38 0 -86 1 -108 32c-47 -31 -109 -38 -146 -38c-102 0 -165 65 -165 134c0 96 123 146 300 149c0 71 -52 102 -128 102c-9 0 -22 0 -36 -1c-20 -2 -21 -3 -21 -11c-1 -37 -29 -46 -44 -46c-24 0 -45 16 -45 46c0 73 102 73 145 73 c144 0 198 -84 198 -155v-216c8 -3 18 -8 60 -8c15 0 40 0 40 -30zM350 134v84c-145 -4 -231 -41 -231 -90c0 -39 41 -73 103 -73c8 0 53 0 89 17c39 18 39 39 39 62Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68B" d="M488 216c0 -127 -97 -222 -206 -222c-32 0 -75 9 -116 51c0 -25 0 -45 -34 -45c-35 0 -35 21 -35 41v509h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-182c34 31 79 49 127 49c106 0 195 -98 195 -221zM419 216c0 87 -58 160 -132 160 c-63 0 -121 -53 -121 -112v-73c0 -48 35 -136 113 -136c70 0 140 65 140 161Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68C" d="M466 109c0 -17 -34 -115 -173 -115c-126 0 -220 102 -220 222c0 88 60 224 232 224c45 0 149 0 149 -73c0 -29 -21 -46 -45 -46s-43 14 -44 49c0 9 -39 9 -60 9c-135 0 -163 -115 -163 -163c0 -91 72 -161 157 -161c74 0 93 47 99 60c7 20 17 22 33 22c6 0 35 0 35 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2297" d="M691 250c0 76 -28 146 -75 199l-199 -199l199 -199c47 53 75 123 75 199zM588 477c-53 47 -123 75 -199 75s-146 -28 -199 -75l199 -199zM361 250l-199 199c-47 -53 -75 -123 -75 -199s28 -146 75 -199zM588 23l-199 199l-199 -199c53 -47 123 -75 199 -75s146 28 199 75 zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68D" d="M512 31c0 -31 -25 -31 -41 -31h-73c-40 0 -40 14 -40 50c-28 -29 -70 -56 -126 -56c-106 0 -196 97 -196 221c0 127 96 222 205 222c43 0 84 -16 117 -45v158h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-509h45c14 0 40 0 40 -30zM358 194v71 c0 55 -49 111 -113 111c-70 0 -140 -65 -140 -161c0 -89 60 -160 131 -160c77 0 122 83 122 139Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D675" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D67C" x="525" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D670" x="1051" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1576" y="249"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68A" x="1966" y="0"></use>
<g transform="translate(2491,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">,</text>
</g>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68B" x="3268" y="0"></use>
<g transform="translate(3793,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">,</text>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4570" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68C" x="5348" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2297" x="6096" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68D" x="7097" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7622" y="249"></use>
</g>
</svg>.  There are two rounding operations, one
after computing <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.056ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2176.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c times d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="655" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1656" y="0"></use>
</g>
</svg> and then another after the FMA.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="The
following argument applies equivalently to computing the value as
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.609ex" height="3.676ex" style="vertical-align: -1.171ex;" viewBox="0 -1078.4 8012.2 1582.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">monospace upper F monospace upper M monospace upper A monospace left-parenthesis negative monospace c monospace comma monospace d monospace comma monospace a circled-times monospace b monospace right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D675" d="M490 497c0 -20 0 -41 -35 -41c-34 0 -34 22 -34 41v53h-250v-214h136c0 41 0 57 35 57c34 0 34 -22 34 -41v-93c0 -19 0 -41 -34 -41c-35 0 -35 16 -35 57h-136v-214h52c16 0 40 0 40 -31c0 -30 -25 -30 -40 -30h-154c-15 0 -41 0 -41 30c0 31 25 31 41 31h33v489h-33 c-15 0 -41 0 -41 30c0 31 25 31 41 31h381c34 0 40 -10 40 -41v-73Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D67C" d="M507 30c0 -30 -25 -30 -40 -30h-82c-15 0 -40 0 -40 30c0 31 21 31 53 31v477h-1c-12 -53 -97 -306 -100 -312c-8 -14 -22 -22 -35 -22c-12 0 -24 7 -30 15c-5 7 -18 45 -26 68c-4 13 -68 205 -79 251h-1v-477c32 0 53 0 53 -31c0 -30 -25 -30 -40 -30h-82 c-15 0 -40 0 -40 30c0 31 21 31 53 31v489c-32 0 -53 0 -53 31c0 30 25 30 40 30h56c14 0 39 0 49 -24c2 -6 90 -265 100 -312h1c6 29 15 58 27 94l67 202c9 26 13 40 54 40h56c15 0 40 0 40 -30c0 -31 -21 -31 -53 -31v-489c32 0 53 0 53 -31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D670" d="M497 30c0 -30 -26 -30 -43 -30h-102c-18 0 -42 0 -42 30c0 31 20 31 56 31l-23 104h-162l-23 -104c36 0 56 0 56 -31c0 -30 -24 -30 -42 -30h-102c-17 0 -43 0 -43 30c0 13 6 23 17 29c6 2 29 2 43 2l121 524c9 38 25 38 54 38c31 0 45 -1 54 -39l121 -523 c15 0 37 0 43 -3c12 -5 17 -15 17 -28zM328 226l-66 314l-66 -314h132Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68C" d="M466 109c0 -17 -34 -115 -173 -115c-126 0 -220 102 -220 222c0 88 60 224 232 224c45 0 149 0 149 -73c0 -29 -21 -46 -45 -46s-43 14 -44 49c0 9 -39 9 -60 9c-135 0 -163 -115 -163 -163c0 -91 72 -161 157 -161c74 0 93 47 99 60c7 20 17 22 33 22c6 0 35 0 35 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68D" d="M512 31c0 -31 -25 -31 -41 -31h-73c-40 0 -40 14 -40 50c-28 -29 -70 -56 -126 -56c-106 0 -196 97 -196 221c0 127 96 222 205 222c43 0 84 -16 117 -45v158h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-509h45c14 0 40 0 40 -30zM358 194v71 c0 55 -49 111 -113 111c-70 0 -140 -65 -140 -161c0 -89 60 -160 131 -160c77 0 122 83 122 139Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68A" d="M519 31c0 -31 -22 -31 -50 -31c-38 0 -86 1 -108 32c-47 -31 -109 -38 -146 -38c-102 0 -165 65 -165 134c0 96 123 146 300 149c0 71 -52 102 -128 102c-9 0 -22 0 -36 -1c-20 -2 -21 -3 -21 -11c-1 -37 -29 -46 -44 -46c-24 0 -45 16 -45 46c0 73 102 73 145 73 c144 0 198 -84 198 -155v-216c8 -3 18 -8 60 -8c15 0 40 0 40 -30zM350 134v84c-145 -4 -231 -41 -231 -90c0 -39 41 -73 103 -73c8 0 53 0 89 17c39 18 39 39 39 62Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2297" d="M691 250c0 76 -28 146 -75 199l-199 -199l199 -199c47 53 75 123 75 199zM588 477c-53 47 -123 75 -199 75s-146 -28 -199 -75l199 -199zM361 250l-199 199c-47 -53 -75 -123 -75 -199s28 -146 75 -199zM588 23l-199 199l-199 -199c53 -47 123 -75 199 -75s146 28 199 75 zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMONOSPACE-1D68B" d="M488 216c0 -127 -97 -222 -206 -222c-32 0 -75 9 -116 51c0 -25 0 -45 -34 -45c-35 0 -35 21 -35 41v509h-45c-14 0 -40 0 -40 30c0 31 25 31 41 31h73c34 0 40 -10 40 -41v-182c34 31 79 49 127 49c106 0 195 -98 195 -221zM419 216c0 87 -58 160 -132 160 c-63 0 -121 -53 -121 -112v-73c0 -48 35 -136 113 -136c70 0 140 65 140 161Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D675" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D67C" x="525" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D670" x="1051" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1576" y="249"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1966" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68C" x="2744" y="0"></use>
<g transform="translate(3270,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">,</text>
</g>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68D" x="4046" y="0"></use>
<g transform="translate(4572,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">,</text>
</g>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68A" x="5348" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2297" x="6096" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMONOSPACE-1D68B" x="7097" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7622" y="249"></use>
</g>
</svg>.">
      <sup>&dagger;</sup>
    </button>
		  If, for example, all of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.23ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 529.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.007ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 433.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
</g>
</svg>,
and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.209ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 520.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="0" y="0"></use>
</g>
</svg> are positive and the products <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.068ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2181.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a times b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.056ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2176.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c times d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="655" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1656" y="0"></use>
</g>
</svg> are of
similar magnitudes, then catastrophic cancellation may result: the rounding
error from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.056ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2176.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c circled-times d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2297" d="M691 250c0 76 -28 146 -75 199l-199 -199l199 -199c47 53 75 123 75 199zM588 477c-53 47 -123 75 -199 75s-146 -28 -199 -75l199 -199zM361 250l-199 199c-47 -53 -75 -123 -75 -199s28 -146 75 -199zM588 23l-199 199l-199 -199c53 -47 123 -75 199 -75s146 28 199 75 zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2297" x="655" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1656" y="0"></use>
</g>
</svg>, though small with respect to the product <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.056ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2176.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c times d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="655" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1656" y="0"></use>
</g>
</svg>, may be large with respect to the final result.

</p>
<p>The following <tt>DifferenceOfProducts()</tt> function uses
FMA in a similar manner to <a href="#TwoProd"><tt>TwoProd()</tt></a>, finding an initial value
for the difference of products as well as the rounding error from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.056ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2176.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c circled-times d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2297" d="M691 250c0 76 -28 146 -75 199l-199 -199l199 -199c47 53 75 123 75 199zM588 477c-53 47 -123 75 -199 75s-146 -28 -199 -75l199 -199zM361 250l-199 199c-47 -53 -75 -123 -75 -199s28 -146 75 -199zM588 23l-199 199l-199 -199c53 -47 123 -75 199 -75s146 28 199 75 zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2297" x="655" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1656" y="0"></use>
</g>
</svg>.  The rounding error is then added back to the value that is
returned, thus fixing up catastrophic cancellation after the fact.  It has
been shown that this gives a result within 1.5 ulps of the correct value;
see the &ldquo;Further Reading&rdquo; section for details.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-33"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-32"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-34"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename Ta, typename Tb, typename Tc, typename Td&gt;
inline auto <span class="anchor" id="DifferenceOfProducts"></span>DifferenceOfProducts(Ta a, Tb b, Tc c, Td d) {
    auto cd = c * d;
    auto differenceOfProducts = <a href="../Shapes/Managing_Rounding_Error.html#FMA" class="code">FMA</a>(a, b, -cd);
    auto error = <a href="../Shapes/Managing_Rounding_Error.html#FMA" class="code">FMA</a>(-c, d, cd);
    return differenceOfProducts + error;
}</div><p>


</p>
<p>

</p>
<p><tt>pbrt</tt> also provides a <a href="#SumOfProducts"><tt>SumOfProducts()</tt></a><span class="anchor" id="SumOfProducts"></span>
function that reliably computes <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.964ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 5581.8 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a times b plus c times d</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1752" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="2404" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3404" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="4060" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="5061" y="0"></use>
</g>
</svg> in a similar manner.

</p>
<p>

</p>
<p>Compensation can also be used to compute a sum of numbers more accurately
than adding them together directly.  An algorithm to do so is implemented
in the <tt>CompensatedSum</tt> class.

</p>
<p></p>
<span class="anchor" id="fragment-CompensatedSumDefinition-0"></span><div class="fragmentname">&lt;&lt;CompensatedSum Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;typename Float&gt;
class <span class="anchor" id="CompensatedSum"></span>CompensatedSum {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-CompensatedSumPublicMethods-0">CompensatedSum Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2724" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2724"><i></i></a><div id="fragbit-2724" class="collapse show"><div class="fragmentcode">       CompensatedSum() = default;
       PBRT_CPU_GPU
       explicit CompensatedSum(Float v) : sum(v) {}
       
       PBRT_CPU_GPU
       CompensatedSum &amp;operator=(Float v) {
           sum = v;
           c = 0;
           return *this;
       }
       CompensatedSum &amp;operator+=(Float v) {
           Float delta = v - c;
           Float newSum = sum + delta;
           c = (newSum - sum) - delta;
           sum = newSum;
           return *this;
       }
       explicit operator Float() const { return sum; }
       std::string ToString() const;</div></div>
  private:
    Float sum = 0, c = 0;
};</div><p>


</p>
<p>

</p>
<p>The value added to the sum, <tt>delta</tt>, is the difference between the
value provided and the accumulated error in <tt>c</tt>.  After the addition
is performed, the compensation term is updated appropriately.

</p>
<p></p>
<span class="anchor" id="fragment-CompensatedSumPublicMethods-0"></span><div class="fragmentname">&lt;&lt;CompensatedSum Public Methods&gt;&gt;=&nbsp;<a href="#fragment-CompensatedSumPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">CompensatedSum &amp;operator+=(Float v) {
    Float delta = v - c;
    Float newSum = sum + delta;
    c = (newSum - sum) - delta;
    sum = newSum;
    return *this;
}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-CompensatedSumPublicMethods-1"></span><div class="fragmentname">&lt;&lt;CompensatedSum Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-CompensatedSumPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">explicit operator Float() const { return sum; }</div><p>


</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#FindingZeros"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:math-finding-zeros"></span><span id="FindingZeros"></span><h3>B.2.10  Finding Zeros</h3><p>



</p>
<p>The <tt>Quadratic()</tt> function finds solutions of the quadratic equation
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.909ex" height="2.676ex" style="vertical-align: -0.505ex;" viewBox="0 -934.9 6849.9 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a t squared plus b t plus c equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
<g transform="translate(529,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="2567" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="2997" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="3581" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="4581" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5293" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="6349" y="0"></use>
</g>
</svg>; the Boolean return value indicates whether solutions were
found.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-34"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-33"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-35"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">bool <span class="anchor" id="Quadratic"></span>Quadratic(float a, float b, float c, float *t0, float *t1) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Handlecaseofa0forquadraticsolution-0">Handle case of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.491ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2364.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="807" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1863" y="0"></use>
</g>
</svg> for quadratic solution</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2725" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2725"><i></i></a><div id="fragbit-2725" class="collapse show"><div class="fragmentcode">       if (a == 0) {
           if (b == 0) return false;
           *t0 = *t1 = -c / b;
           return true;
       }</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Findquadraticdiscriminant-0">Find quadratic discriminant</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2726" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2726"><i></i></a><div id="fragbit-2726" class="collapse show"><div class="fragmentcode">       float discrim = <a href="#DifferenceOfProducts" class="code">DifferenceOfProducts</a>(b, b, 4 * a, c);
       if (discrim &lt; 0)
           return false;
       float rootDiscrim = std::sqrt(discrim);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computequadraticmonotvalues-0">Compute quadratic <tt>t</tt> values</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2727" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2727"><i></i></a><div id="fragbit-2727" class="collapse show"><div class="fragmentcode">       float q = -0.5f * (b + pstd::copysign(rootDiscrim, b));
       *t0 = q / a;
       *t1 = c / q;
       if (*t0 &gt; *t1)
           pstd::swap(*t0, *t1);</div></div>
    return true;
}</div><p>


</p>
<p>

</p>
<p>If <tt>a</tt> is zero, then the caller has actually specified a linear
function.  That case is handled first to avoid not-a-number values being
generated via the usual execution path. (Our implementation does not handle
the case of all coefficients being equal to zero, in which case there are
an infinite number of solutions.)

</p>
<p></p>
<span class="anchor" id="fragment-Handlecaseofa0forquadraticsolution-0"></span><div class="fragmentname">&lt;&lt;Handle case of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.491ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2364.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">a equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="807" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1863" y="0"></use>
</g>
</svg> for quadratic solution&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (a == 0) {
    if (b == 0) return false;
    *t0 = *t1 = -c / b;
    return true;
}</div><p>


</p>
<p>The discriminant <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.291ex" height="2.676ex" style="vertical-align: -0.505ex;" viewBox="0 -934.9 3569.9 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b squared minus 4 a c</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="607" y="513"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1105" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="2106" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="2606" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3136" y="0"></use>
</g>
</svg> is computed using <tt>DifferenceOfProducts()</tt>,
which improves the accuracy of the computed value compared to computing it
directly using floating-point multiplication and subtraction.  If the
discriminant is negative, then there are no real roots and the function
returns <tt>false</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-Findquadraticdiscriminant-0"></span><div class="fragmentname">&lt;&lt;Find quadratic discriminant&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">float discrim = <a href="#DifferenceOfProducts" class="code">DifferenceOfProducts</a>(b, b, 4 * a, c);
if (discrim &lt; 0)
    return false;
float rootDiscrim = std::sqrt(discrim);</div><p>


</p>
<p>The usual version of the quadratic equation can give poor numerical accuracy
when <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.508ex" height="3.509ex" style="vertical-align: -0.838ex;" viewBox="0 -1150.1 7107.4 1510.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b almost-equals plus-or-minus StartRoot b squared minus 4 a c EndRoot</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2248" d="M717 438v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76 c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12zM717 218v-2c-20 -93 -56 -149 -139 -169c-11 -3 -23 -4 -35 -4c-62 0 -120 37 -172 76c-43 32 -89 67 -138 67c-9 0 -17 -1 -26 -3c-67 -17 -111 -49 -127 -124 c-1 -5 -6 -9 -12 -9c-7 0 -12 5 -12 12v2c20 93 56 149 139 169c12 3 24 4 35 4c62 0 120 -37 172 -76c43 -32 89 -67 139 -67c8 0 16 1 25 3c67 17 111 49 127 124c2 5 6 9 12 9c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-B1" d="M722 -64c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h293v274h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20s-9 -20 -20 -20h-293v-274h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-221A" d="M1020 830c0 -3 0 -5 -7 -18l-547 -1142c-10 -19 -11 -20 -42 -20l-228 531l-71 -54l-15 16l139 107l213 -496l516 1076c5 11 9 20 22 20c12 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2248" x="707" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-B1" x="1758" y="0"></use>
<g transform="translate(2537,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-221A" x="0" y="94"></use>
<rect stroke="none" width="3569" height="60" x="1000" y="885"></rect>
<g transform="translate(1000,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="607" y="408"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1105" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="2106" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="2606" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3136" y="0"></use>
</g>
</g>
</g>
</svg> due to cancellation error.  It can be
rewritten algebraically into a more stable form:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.278ex" height="10.509ex" style="vertical-align: -4.671ex;" viewBox="0 -2513.6 3564 4524.8" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartLayout 1st Row 1st Column t 0 2nd Column equals StartFraction q Over a EndFraction 2nd Row 1st Column t 1 2nd Column equals StartFraction c Over q EndFraction comma EndLayout</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45E" d="M452 431l-138 -556c-2 -9 -4 -15 -4 -22c0 -9 0 -16 48 -16c16 0 26 0 26 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3c-33 0 -68 -3 -100 -3c-13 0 -13 11 -13 11c0 20 10 20 23 20c56 1 64 5 72 33l45 179c-36 -36 -75 -60 -118 -60c-73 0 -132 62 -132 160 c0 145 123 293 241 293c32 0 71 -16 93 -70c17 29 57 69 68 69c7 0 10 -6 10 -10zM360 332c0 7 -14 88 -79 88c-41 0 -93 -42 -124 -116c-17 -42 -46 -151 -46 -199c0 -17 4 -94 64 -94c56 0 112 64 127 92c3 4 58 223 58 229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(167,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,1270)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="511" y="-213"></use>
</g>
<g transform="translate(0,-1047)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="511" y="-213"></use>
</g>
</g>
<g transform="translate(1082,0)">
<g transform="translate(0,1270)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
<g transform="translate(778,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="649" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45E" x="98" y="714"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="60" y="-686"></use>
</g>
</g>
</g>
<g transform="translate(0,-1047)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
<g transform="translate(778,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="572" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="69" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45E" x="60" y="-686"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1868" y="0"></use>
</g>
</g>
</g>
</g>
</svg>
</div>
<p>

where
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="40.043ex" height="7.509ex" style="vertical-align: -3.171ex;" viewBox="0 -1867.7 17240.8 3233.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">q equals StartLayout Enlarged left-brace 1st Row 1st Column minus one-half left-parenthesis b minus StartRoot b squared minus 4 a c EndRoot right-parenthesis 2nd Column b less-than 0 comma 2nd Row 1st Column minus one-half left-parenthesis b plus StartRoot b squared minus 4 a c EndRoot right-parenthesis 2nd Column otherwise period EndLayout</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45E" d="M452 431l-138 -556c-2 -9 -4 -15 -4 -22c0 -9 0 -16 48 -16c16 0 26 0 26 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3c-33 0 -68 -3 -100 -3c-13 0 -13 11 -13 11c0 20 10 20 23 20c56 1 64 5 72 33l45 179c-36 -36 -75 -60 -118 -60c-73 0 -132 62 -132 160 c0 145 123 293 241 293c32 0 71 -16 93 -70c17 29 57 69 68 69c7 0 10 -6 10 -10zM360 332c0 7 -14 88 -79 88c-41 0 -93 -42 -124 -116c-17 -42 -46 -151 -46 -199c0 -17 4 -94 64 -94c56 0 112 64 127 92c3 4 58 223 58 229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-7B" d="M425 -238c0 -7 -5 -12 -12 -12c-105 0 -196 52 -196 125v250c0 58 -55 113 -130 113c-7 0 -12 5 -12 12s5 12 12 12c75 0 130 55 130 113v250c0 73 91 125 196 125c7 0 12 -5 12 -12s-5 -12 -12 -12c-75 0 -130 -49 -130 -101v-250c0 -58 -48 -104 -115 -125 c67 -21 115 -67 115 -125v-250c0 -52 55 -101 130 -101c7 0 12 -5 12 -12Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-221A" d="M1020 830c0 -3 0 -5 -7 -18l-547 -1142c-10 -19 -11 -20 -42 -20l-228 531l-71 -54l-15 16l139 107l213 -496l516 1076c5 11 9 20 22 20c12 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3C" d="M689 -9c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-74" d="M332 124c0 -64 -28 -135 -99 -135c-36 0 -129 12 -129 135v276h-85v22c98 4 128 111 129 193h25v-184h143v-31h-143v-278c0 -17 0 -108 67 -108c37 0 67 38 67 112v55h25v-57Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-68" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-348h1c16 36 60 96 144 96c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-72" d="M364 381c0 -32 -25 -44 -43 -44c-22 0 -43 15 -43 43c0 26 20 38 23 39c-2 1 -4 1 -11 1c-76 0 -118 -89 -118 -188v-154c0 -36 2 -47 76 -47h21v-31c-40 3 -87 3 -127 3l-114 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l139 11v-110c14 43 50 110 123 110 c43 0 74 -29 74 -61Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-77" d="M703 400c-35 -1 -66 -14 -84 -64l-117 -328c-4 -10 -7 -19 -20 -19s-16 8 -20 19l-102 284l-101 -283c-5 -14 -7 -20 -20 -20s-16 8 -21 22l-126 354c-12 32 -24 35 -74 35v31l93 -3l109 3v-31c-20 0 -59 0 -59 -27c0 -4 0 -6 5 -18l95 -267l86 242c-7 19 -18 49 -23 55 c-10 13 -26 15 -63 15v31c30 -2 59 -3 89 -3l104 3v-31c-20 0 -59 0 -59 -27c0 -5 1 -7 5 -19l99 -279l91 256c5 13 5 15 5 21c0 29 -22 47 -58 48v31l93 -3c22 0 51 1 73 3v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE7-7B" d="M755 -1224c0 -14 -12 -26 -26 -26c-3 0 -6 1 -9 2c-169 61 -320 222 -320 373v750c0 137 -97 300 -236 351c-10 3 -17 13 -17 24s7 21 17 24c139 51 236 214 236 351v750c0 151 151 312 320 373c3 1 6 2 9 2c14 0 26 -12 26 -26c0 -11 -7 -21 -17 -24 c-138 -51 -236 -202 -236 -325v-750c0 -147 -120 -300 -265 -375c145 -75 265 -228 265 -375v-750c0 -123 98 -274 236 -325c10 -3 17 -13 17 -24Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45E" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="730" y="0"></use>
<g transform="translate(1786,0)">
 <use xlink:href="#E1-LATINMODERNSIZE7-7B"></use>
<g transform="translate(1069,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,716)">
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
<g transform="translate(778,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="473" height="60" x="0" y="220"></rect>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="84" y="629"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="84" y="-589"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1492" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1881" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2533" y="0"></use>
<g transform="translate(3534,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-221A" x="0" y="94"></use>
<rect stroke="none" width="3569" height="60" x="1000" y="885"></rect>
<g transform="translate(1000,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="607" y="408"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1105" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="2106" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="2606" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3136" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8104" y="0"></use>
</g>
<g transform="translate(0,-806)">
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
<g transform="translate(778,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="473" height="60" x="0" y="220"></rect>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="84" y="629"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="84" y="-589"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1492" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1881" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="2533" y="0"></use>
<g transform="translate(3534,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-221A" x="0" y="94"></use>
<rect stroke="none" width="3569" height="60" x="1000" y="885"></rect>
<g transform="translate(1000,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="607" y="408"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1105" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="2106" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="2606" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3136" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8104" y="0"></use>
</g>
</g>
<g transform="translate(9483,0)">
<g transform="translate(0,716)">
<g transform="translate(332,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3C" x="707" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1763" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2596" y="0"></use>
</g>
<g transform="translate(0,-806)">
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="332" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-74" x="832" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-68" x="1222" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="1778" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-72" x="2223" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-77" x="2615" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-69" x="3338" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-73" x="3616" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="4011" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="4455" y="0"></use>
</g>
</g>
</g>
</g>
</g>
</svg>
</div>
<p>


</p>
<p>The implementation uses <tt>pstd::copysign()</tt> in place of an <tt>if</tt>
test for the condition on <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg>, setting the sign of the square root of the
discriminant to be the same as the sign of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg>, which is equivalent.  This
micro-optimization does not meaningfully affect <tt>pbrt</tt>&rsquo;s performance, but it
is a trick that is worth being aware of.

</p>
<p></p>
<span class="anchor" id="fragment-Computequadraticmonotvalues-0"></span><div class="fragmentname">&lt;&lt;Compute quadratic <tt>t</tt> values&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">float q = -0.5f * (b + pstd::copysign(rootDiscrim, b));
*t0 = q / a;
*t1 = c / q;
if (*t0 &gt; *t1)
    pstd::swap(*t0, *t1);</div><p>


</p>
<p><tt>NewtonBisection()</tt> finds a zero of an arbitrary function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.422ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1904 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1514" y="0"></use>
</g>
</svg> over
a specified range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.095ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3055 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket x 0 comma x 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
<g transform="translate(278,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1304" y="0"></use>
<g transform="translate(1750,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2776" y="0"></use>
</g>
</svg> using an iterative root-finding
technique that is guaranteed to converge to the solution so long as <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.095ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3055 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket x 0 comma x 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
<g transform="translate(278,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1304" y="0"></use>
<g transform="translate(1750,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2776" y="0"></use>
</g>
</svg> brackets a root and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.476ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2357.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
<g transform="translate(942,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1968" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.476ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2357.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
<g transform="translate(942,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1968" y="0"></use>
</g>
</svg> differ in sign.

</p>
<p>In each iteration, bisection search splits the interval into two parts and
discards the subinterval that does not bracket the solution&mdash;in this way,
it can be interpreted as a continuous extension of binary search. The
method&rsquo;s robustness is clearly desirable, but its relatively slow (linear)
convergence can still be improved. We therefore use
<em>Newton-bisection</em>, which is a combination of the quadratically
converging but potentially unsafe<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="Newton&rsquo;s method can exhibit
oscillatory or divergent behavior and is only guaranteed to converge when
started sufficiently close to the solution. In practice, it is usually hard
to provide such a guarantee; hence we prefer the unconditionally safe
combination with bisection search.">
      <sup>&dagger;</sup>
    </button>
		 Newton&rsquo;s method with the safety of
bisection search as a fallback.

</p>
<p>The provided function <tt>f</tt> should return a <tt>std::pair&lt;Float,
Float&gt;</tt> where the first value is the function&rsquo;s value and the second is its
derivative.  Two &ldquo;epsilon&rdquo; values control the accuracy of the result:
<tt>xEps</tt> gives a minimum distance between the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
</g>
</svg> values that bracket
the root, and <tt>fEps</tt> specifies how close to zero is sufficient for
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.422ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1904 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1514" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-35"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-34"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MathInlineFunctions-36"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename Func&gt;
Float <span class="anchor" id="NewtonBisection"></span>NewtonBisection(Float x0, Float x1, Func f, Float xEps = 1e-6f,
                      Float fEps = 1e-6f) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Checkfunctionendpointsforroots-0">Check function endpoints for roots</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2728" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2728"><i></i></a><div id="fragbit-2728" class="collapse show"><div class="fragmentcode">       Float fx0 = f(x0).first, fx1 = f(x1).first;
       if (std::abs(fx0) &lt; fEps) return x0;
       if (std::abs(fx1) &lt; fEps) return x1;
       bool startIsNegative = fx0 &lt; 0;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Setinitialmidpointusinglinearapproximationofmonof-0">Set initial midpoint using linear approximation of <tt>f</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2729" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2729"><i></i></a><div id="fragbit-2729" class="collapse show"><div class="fragmentcode">       Float xMid = x0 + (x1 - x0) * -fx0 / (fx1 - fx0);</div></div>
    while (true) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-FallbacktobisectionifmonoxMidisoutofbounds-0">Fall back to bisection if <tt>xMid</tt> is out of bounds</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2730" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2730"><i></i></a><div id="fragbit-2730" class="collapse show"><div class="fragmentcode">           if (!(x0 &lt; xMid &amp;&amp; xMid &lt; x1))
               xMid = (x0 + x1) / 2;</div></div>
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Evaluatefunctionandnarrowbracketrangemonox0x1-0">Evaluate function and narrow bracket range <tt>[x0, x1]</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2731" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2731"><i></i></a><div id="fragbit-2731" class="collapse show"><div class="fragmentcode">           std::pair&lt;Float, Float&gt; fxMid = f(xMid);
           if (startIsNegative == (fxMid.first &lt; 0))
               x0 = xMid;
           else
               x1 = xMid;</div></div>
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Stoptheiterationifconverged-0">Stop the iteration if converged</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2732" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2732"><i></i></a><div id="fragbit-2732" class="collapse show"><div class="fragmentcode">           if ((x1 - x0) &lt; xEps || std::abs(fxMid.first) &lt; fEps)
               return xMid;</div></div>
        &lt;&lt;<span class="fragmentname"><a href="#fragment-PerformaNewtonstep-0">Perform a Newton step</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2733" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2733"><i></i></a><div id="fragbit-2733" class="collapse show"><div class="fragmentcode">           xMid -= fxMid.first / fxMid.second;</div></div>
    }
}</div><p>


</p>
<p>Before the iteration begins, a check is performed to see if one of the
endpoints is a zero.  (For example, this case comes up if a zero-valued function is
specified.)  If so, there is no need to do any further work.

</p>
<p></p>
<span class="anchor" id="fragment-Checkfunctionendpointsforroots-0"></span><div class="fragmentname">&lt;&lt;Check function endpoints for roots&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float fx0 = f(x0).first, fx1 = f(x1).first;
if (std::abs(fx0) &lt; fEps) return x0;
if (std::abs(fx1) &lt; fEps) return x1;
bool startIsNegative = fx0 &lt; 0;</div><p>


</p>
<p>The number of required Newton-bisection iterations can be reduced by
starting the algorithm with a good initial guess. The function uses a
heuristic that assumes that the function is linear and finds the zero
crossing of the line between the two endpoints.

</p>
<p></p>
<span class="anchor" id="fragment-Setinitialmidpointusinglinearapproximationofmonof-0"></span><div class="fragmentname">&lt;&lt;Set initial midpoint using linear approximation of <tt>f</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float xMid = x0 + (x1 - x0) * -fx0 / (fx1 - fx0);</div><p>


</p>
<p>The first fragment in the inner loop checks if the current proposed
midpoint is inside the bracketing interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.095ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3055 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket x 0 comma x 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
<g transform="translate(278,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1304" y="0"></use>
<g transform="translate(1750,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2776" y="0"></use>
</g>
</svg>. Otherwise, it is
reset to the interval center, resulting in a standard bisection step
(Figure&nbsp;<a href="#fig:newton-bisection">B.4</a>).

</p>
<p></p>
<span class="anchor" id="fig:newton-bisection"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="phabbf04.svg" title=""><img src="phabbf04.svg" width=770 height=290 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure B.4: The Robustness of Newton-Bisection. <span class="legend"> 
(a)&nbsp;This function increases monotonically and contains a single root on the
shown interval, but a naive application of Newton&rsquo;s method diverges. (b)&nbsp;The
bisection feature of the robust root-finder enables recovery from the third
Newton step, which jumps far away from the root (the bisection interval is
highlighted).  The method converges a few iterations later.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FallbacktobisectionifmonoxMidisoutofbounds-0"></span><div class="fragmentname">&lt;&lt;Fall back to bisection if <tt>xMid</tt> is out of bounds&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (!(x0 &lt; xMid &amp;&amp; xMid &lt; x1))
    xMid = (x0 + x1) / 2;</div><p>


</p>
<p>The function can now be evaluated and the bracket range can be refined.
Either <tt>x0</tt> or <tt>x1</tt> is set to <tt>xMid</tt> in a way that maintains
the invariant that the function has different signs at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.476ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2357.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
<g transform="translate(942,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1968" y="0"></use>
</g>
</svg> and
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.476ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2357.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
<g transform="translate(942,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1968" y="0"></use>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-Evaluatefunctionandnarrowbracketrangemonox0x1-0"></span><div class="fragmentname">&lt;&lt;Evaluate function and narrow bracket range <tt>[x0, x1]</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">std::pair&lt;Float, Float&gt; fxMid = f(xMid);
if (startIsNegative == (fxMid.first &lt; 0))
    x0 = xMid;
else
    x1 = xMid;</div><p>


</p>
<p>The iteration stops either if the function value is close to&nbsp;0 or if
the bracketing interval has become sufficiently small.

</p>
<p></p>
<span class="anchor" id="fragment-Stoptheiterationifconverged-0"></span><div class="fragmentname">&lt;&lt;Stop the iteration if converged&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if ((x1 - x0) &lt; xEps || std::abs(fxMid.first) &lt; fEps)
    return xMid;</div><p>


</p>
<p>If the iteration is to continue, an updated midpoint is computed using a
Newton step.  The next loop iteration will detect the case of this point
being outside the bracket interval.

</p>
<p></p>
<span class="anchor" id="fragment-PerformaNewtonstep-0"></span><div class="fragmentname">&lt;&lt;Perform a Newton step&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">xMid -= fxMid.first / fxMid.second;</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#RobustVarianceEstimation"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:robust-variance-estimation"></span><span id="RobustVarianceEstimation"></span><h3>B.2.11  Robust Variance Estimation</h3><p>



</p>
<p>One problem with computing the sample variance using Equation
(<a href="../Monte_Carlo_Integration/Monte_Carlo_Basics.html#eq:sample-variance-basic">2.11</a>) is that doing so requires storing all 
the samples <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.724ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1172.8 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-213"></use>
</g>
</svg>.  The storage requirements for this may be
unacceptable&mdash;for example, for a <tt>Film</tt> implementation
that is estimating per-pixel variance
with thousands of samples per pixel.
Equation (<a href="../Monte_Carlo_Integration/Monte_Carlo_Basics.html#eq:variance">2.9</a>) suggests another possibility: if we accumulate
estimates of both <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.978ex" height="2.509ex" style="vertical-align: -0.338ex;" viewBox="0 -934.9 851.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X overbar</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.889ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 2535.5 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">sigma-summation upper X Subscript i Superscript 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNOPERATORS-2211" d="M999 -1l-86 -249h-829c-18 0 -27 0 -27 11c0 4 1 6 9 16l355 439l-365 502c0 31 1 32 28 32h829l86 -234h-25c-70 187 -300 194 -414 194h-396l325 -446c6 -9 7 -10 7 -14s-2 -7 -9 -16l-347 -429h425c147 0 216 24 232 29c85 29 152 90 177 165h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
<g transform="translate(1223,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1214" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-430"></use>
</g>
</g>
</svg>, then the sample
variance could be estimated as
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="23.997ex" height="7.509ex" style="vertical-align: -3.171ex;" viewBox="0 -1867.7 10332 3233.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction 1 Over n minus 1 EndFraction left-parenthesis sigma-summation Underscript i equals 1 Overscript n Endscripts upper X Subscript i Superscript 2 Baseline minus upper X overbar squared right-parenthesis comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-2211" d="M1387 -130l-121 -320h-1182c-18 0 -27 0 -27 11c0 0 0 6 10 18l518 607l-529 724c0 11 0 30 1 33c3 6 4 7 27 7h1182l121 -281h-25c-34 81 -102 126 -127 142c-79 50 -166 67 -220 75c-9 2 -100 16 -234 16h-548l466 -637c7 -10 7 -15 7 -15c0 -5 -2 -8 -9 -16l-509 -597 h603c192 0 290 26 311 31c115 30 221 98 260 202h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE7-28" d="M823 -1224c0 -11 -10 -21 -21 -21c-5 0 -9 2 -12 4c-268 202 -513 751 -513 1241v500c0 490 245 1039 513 1241c3 2 7 4 12 4c11 0 21 -10 21 -21c0 -7 -3 -13 -9 -17c-255 -192 -435 -739 -435 -1207v-500c0 -468 180 -1015 435 -1207c6 -4 9 -10 9 -17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE7-29" d="M598 0c0 -490 -245 -1039 -513 -1241c-3 -2 -7 -4 -12 -4c-11 0 -21 10 -21 21c0 7 3 13 9 17c255 192 435 739 435 1207v500c0 468 -180 1015 -435 1207c-6 4 -9 10 -9 17c0 11 10 21 21 21c5 0 9 -2 12 -4c268 -202 513 -751 513 -1241v-500Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="2443" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="971" y="676"></use>
<g transform="translate(60,-687)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="822" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1823" y="0"></use>
</g>
</g>
<g transform="translate(2683,0)">
 <use xlink:href="#E1-LATINMODERNSIZE7-28"></use>
<g transform="translate(875,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-2211" x="0" y="0"></use>
<g transform="translate(147,-1090)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3D" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="721" y="1627"></use>
</g>
<g transform="translate(2486,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1214" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-430"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4021" y="0"></use>
<g transform="translate(5021,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1204" y="780"></use>
</g>
 <use xlink:href="#E1-LATINMODERNSIZE7-29" x="6327" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="10053" y="0"></use>
</g>
</svg>
</div>
<p>

which only requires storing two values.
This approach is numerically unstable, however, due to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.889ex" height="3.176ex" style="vertical-align: -1.005ex;" viewBox="0 -934.9 2535.5 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">sigma-summation upper X Subscript i Superscript 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNOPERATORS-2211" d="M999 -1l-86 -249h-829c-18 0 -27 0 -27 11c0 4 1 6 9 16l355 439l-365 502c0 31 1 32 28 32h829l86 -234h-25c-70 187 -300 194 -414 194h-396l325 -446c6 -9 7 -10 7 -14s-2 -7 -9 -16l-347 -429h425c147 0 216 24 232 29c85 29 152 90 177 165h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
<g transform="translate(1223,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="1214" y="488"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-430"></use>
</g>
</g>
</svg> having
a much larger magnitude  than <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.978ex" height="2.509ex" style="vertical-align: -0.338ex;" viewBox="0 -934.9 851.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X overbar</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
</g>
</svg>.  Therefore, the
following <tt>VarianceEstimator</tt> class, which computes an online estimate
of variance without storing all the samples, uses <em>Welford&rsquo;s
algorithm</em>, which is numerically stable.  Its implementation in <tt>pbrt</tt> is
parameterized by a floating-point type so that, for example,
double precision can be used even when <tt>pbrt</tt> is built to use
single-precision <a href="../Introduction/pbrt_System_Overview.html#Float"><tt>Float</tt></a>s.

</p>
<p></p>
<span class="anchor" id="fragment-VarianceEstimatorDefinition-0"></span><div class="fragmentname">&lt;&lt;VarianceEstimator Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;typename Float = Float&gt;
class <span class="anchor" id="VarianceEstimator"></span>VarianceEstimator {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-VarianceEstimatorPublicMethods-0">VarianceEstimator Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2734" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2734"><i></i></a><div id="fragbit-2734" class="collapse show"><div class="fragmentcode">       void Add(Float x) {
           ++<a href="#VarianceEstimator::n" class="code">n</a>;
           Float delta = x - <a href="#VarianceEstimator::mean" class="code">mean</a>;
           <a href="#VarianceEstimator::mean" class="code">mean</a> += delta / <a href="#VarianceEstimator::n" class="code">n</a>;
           Float delta2 = x - <a href="#VarianceEstimator::mean" class="code">mean</a>;
           <a href="#VarianceEstimator::S" class="code">S</a> += delta * delta2;
       }
       Float <a href="#VarianceEstimator::Mean" class="code">Mean</a>() const { return <a href="#VarianceEstimator::mean" class="code">mean</a>; }
       Float <a href="#VarianceEstimator::Variance" class="code">Variance</a>() const { return (<a href="#VarianceEstimator::n" class="code">n</a> &gt; 1) ? <a href="#VarianceEstimator::S" class="code">S</a> / (<a href="#VarianceEstimator::n" class="code">n</a> - 1) : 0; }
       Float RelativeVariance() const {
           return (<a href="#VarianceEstimator::n" class="code">n</a> &lt; 1 || <a href="#VarianceEstimator::mean" class="code">mean</a> == 0) ? 0 : <a href="#VarianceEstimator::Variance" class="code">Variance</a>() / <a href="#VarianceEstimator::Mean" class="code">Mean</a>();
       }
       void Merge(const VarianceEstimator &amp;ve) {
           if (ve.<a href="#VarianceEstimator::n" class="code">n</a> == 0)
               return;
           <a href="#VarianceEstimator::S" class="code">S</a> = <a href="#VarianceEstimator::S" class="code">S</a> + ve.<a href="#VarianceEstimator::S" class="code">S</a> + Sqr(ve.<a href="#VarianceEstimator::mean" class="code">mean</a> - <a href="#VarianceEstimator::mean" class="code">mean</a>) * <a href="#VarianceEstimator::n" class="code">n</a> * ve.<a href="#VarianceEstimator::n" class="code">n</a> / (<a href="#VarianceEstimator::n" class="code">n</a> + ve.<a href="#VarianceEstimator::n" class="code">n</a>);
           <a href="#VarianceEstimator::mean" class="code">mean</a> = (<a href="#VarianceEstimator::n" class="code">n</a> * <a href="#VarianceEstimator::mean" class="code">mean</a> + ve.<a href="#VarianceEstimator::n" class="code">n</a> * ve.<a href="#VarianceEstimator::mean" class="code">mean</a>) / (<a href="#VarianceEstimator::n" class="code">n</a> + ve.<a href="#VarianceEstimator::n" class="code">n</a>);
           <a href="#VarianceEstimator::n" class="code">n</a> += ve.<a href="#VarianceEstimator::n" class="code">n</a>;
       }</div></div>
  private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-VarianceEstimatorPrivateMembers-0">VarianceEstimator Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2735" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2735"><i></i></a><div id="fragbit-2735" class="collapse show"><div class="fragmentcode">       Float mean = 0, S = 0;
       int64_t n = 0;</div></div>
};</div><p>


</p>
<p>Welford&rsquo;s algorithm computes two quantities: the sample mean <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.978ex" height="2.509ex" style="vertical-align: -0.338ex;" viewBox="0 -934.9 851.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X overbar</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
</g>
</svg> and
the sum of squares of differences between the samples and the sample mean,
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.457ex" height="3.009ex" style="vertical-align: -0.838ex;" viewBox="0 -934.9 7516.2 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper S equals sigma-summation left-parenthesis upper X Subscript i Baseline minus upper X overbar right-parenthesis squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNOPERATORS-2211" d="M999 -1l-86 -249h-829c-18 0 -27 0 -27 11c0 4 1 6 9 16l355 439l-365 502c0 31 1 32 28 32h829l86 -234h-25c-70 187 -300 194 -414 194h-396l325 -446c6 -9 7 -10 7 -14s-2 -7 -9 -16l-347 -429h425c147 0 216 24 232 29c85 29 152 90 177 165h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="923" y="0"></use>
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="1979" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3036" y="0"></use>
<g transform="translate(3425,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4820" y="0"></use>
<g transform="translate(5821,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
</g>
<g transform="translate(6672,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="550" y="513"></use>
</g>
</g>
</svg>.  In turn, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.869ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4248.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper S slash left-parenthesis n minus 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="645" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1146" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1535" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2358" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="3358" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3859" y="0"></use>
</g>
</svg> gives the sample
variance.

</p>
<p></p>
<span class="anchor" id="fragment-VarianceEstimatorPrivateMembers-0"></span><div class="fragmentname">&lt;&lt;VarianceEstimator Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float <span class="anchor" id="VarianceEstimator::mean"></span>mean = 0, <span class="anchor" id="VarianceEstimator::S"></span>S = 0;
int64_t <span class="anchor" id="VarianceEstimator::n"></span>n = 0;</div><p>


</p>
<p>Both of these quantities can be computed incrementally. First, if
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.297ex" height="2.843ex" style="vertical-align: -0.671ex;" viewBox="0 -934.9 2280.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X overbar Subscript n minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
<g transform="translate(851,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
</svg> is the sample mean of the first <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.398ex" height="2.343ex" style="vertical-align: -0.505ex;" viewBox="0 -791.3 2323.9 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="822" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1823" y="0"></use>
</g>
</svg> samples, then given
an additional sample <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.143ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1353.1 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X Subscript n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1171" y="-213"></use>
</g>
</svg>, the updated sample mean <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.196ex" height="2.843ex" style="vertical-align: -0.671ex;" viewBox="0 -934.9 1376.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X overbar Subscript n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1204" y="-213"></use>
</g>
</svg> is
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:welford-mean"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="49.616ex" height="5.843ex" style="vertical-align: -1.838ex;" viewBox="0 -1724.2 21362.3 2515.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper X overbar Subscript n Baseline equals StartFraction upper X overbar Subscript n minus 1 Baseline left-parenthesis n minus 1 right-parenthesis plus upper X Subscript n Baseline Over n EndFraction equals upper X overbar Subscript n minus 1 Baseline plus StartFraction upper X Subscript n Baseline minus upper X overbar Subscript n minus 1 Baseline Over n EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1204" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1653" y="0"></use>
<g transform="translate(2432,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="8079" height="60" x="0" y="220"></rect>
<g transform="translate(60,768)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
<g transform="translate(851,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="2670" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3492" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="4493" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4993" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="5605" y="0"></use>
<g transform="translate(6606,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1171" y="-213"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="3739" y="-686"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="11307" y="0"></use>
<g transform="translate(12363,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
<g transform="translate(851,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="14866" y="0"></use>
<g transform="translate(15644,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="4976" height="60" x="0" y="220"></rect>
<g transform="translate(60,728)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1171" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1575" y="0"></use>
<g transform="translate(2576,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
<g transform="translate(851,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="2188" y="-686"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="21083" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:welford-mean">B.18</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>


</p>
<p>Next, if <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.643ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1138.1 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper S Subscript n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="867" y="-213"></use>
</g>
</svg> is the sum of squares of differences from the current mean,
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.368ex" height="6.843ex" style="vertical-align: -3.005ex;" viewBox="0 -1652.5 9199.9 2946.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper S Subscript n Baseline equals sigma-summation Underscript i equals 1 Overscript n Endscripts left-parenthesis upper X Subscript i Baseline minus upper X overbar Subscript n Baseline right-parenthesis squared comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-2211" d="M1387 -130l-121 -320h-1182c-18 0 -27 0 -27 11c0 0 0 6 10 18l518 607l-529 724c0 11 0 30 1 33c3 6 4 7 27 7h1182l121 -281h-25c-34 81 -102 126 -127 142c-79 50 -166 67 -220 75c-9 2 -100 16 -234 16h-548l466 -637c7 -10 7 -15 7 -15c0 -5 -2 -8 -9 -16l-509 -597 h603c192 0 290 26 311 31c115 30 221 98 260 202h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="867" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1415" y="0"></use>
<g transform="translate(2472,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-2211" x="0" y="0"></use>
<g transform="translate(147,-1090)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3D" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="721" y="1627"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="3916" y="0"></use>
<g transform="translate(4306,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="5701" y="0"></use>
<g transform="translate(6701,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1204" y="-213"></use>
</g>
<g transform="translate(8078,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="550" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="8921" y="0"></use>
</g>
</svg>
</div>
<p>

then consider the
difference <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.799ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 7232.7 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper M Subscript n Baseline equals upper S Subscript n Baseline minus upper S Subscript n minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D440" d="M1044 672c0 -20 -9 -20 -32 -20c-75 0 -77 -10 -86 -46l-133 -533c-5 -18 -5 -20 -5 -24c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -13 -20 -19 -20c-41 0 -84 3 -125 3l-124 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47l143 573h-1l-404 -633 c-5 -7 -11 -18 -22 -18c-12 0 -13 11 -15 23l-86 620h-1l-136 -545c-3 -11 -4 -16 -4 -23c0 -23 11 -43 68 -44c7 0 18 0 18 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3c-33 0 -68 -3 -100 -3c-8 0 -14 3 -14 12c0 18 13 19 18 19c81 3 98 35 108 75l127 509 c3 12 4 15 4 19c0 11 -6 14 -22 16c-12 1 -30 2 -43 2c-20 0 -29 0 -29 12c0 19 11 19 30 19h137c26 0 28 0 31 -23l78 -566l365 570c12 19 13 19 39 19h132c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D440" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1372" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1772" y="0"></use>
<g transform="translate(2829,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="867" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4189" y="0"></use>
<g transform="translate(5190,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
<g transform="translate(613,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
</g>
</svg>, which is the quantity that when added to
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.744ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 2042.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper S Subscript n minus 1</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
<g transform="translate(613,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
</svg> gives <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.643ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 1138.1 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper S Subscript n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="867" y="-213"></use>
</g>
</svg>:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="55.443ex" height="7.343ex" style="vertical-align: -3.005ex;" viewBox="0 -1867.7 23871.2 3161.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper M Subscript n Baseline equals upper S Subscript n Baseline minus upper S Subscript n minus 1 Baseline equals sigma-summation Underscript i equals 1 Overscript n Endscripts left-parenthesis upper X Subscript i Baseline minus upper X overbar Subscript n Baseline right-parenthesis squared minus sigma-summation Underscript i equals 1 Overscript n minus 1 Endscripts left-parenthesis upper X Subscript i Baseline minus upper X overbar Subscript n minus 1 Baseline right-parenthesis squared period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D440" d="M1044 672c0 -20 -9 -20 -32 -20c-75 0 -77 -10 -86 -46l-133 -533c-5 -18 -5 -20 -5 -24c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -13 -20 -19 -20c-41 0 -84 3 -125 3l-124 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47l143 573h-1l-404 -633 c-5 -7 -11 -18 -22 -18c-12 0 -13 11 -15 23l-86 620h-1l-136 -545c-3 -11 -4 -16 -4 -23c0 -23 11 -43 68 -44c7 0 18 0 18 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3c-33 0 -68 -3 -100 -3c-8 0 -14 3 -14 12c0 18 13 19 18 19c81 3 98 35 108 75l127 509 c3 12 4 15 4 19c0 11 -6 14 -22 16c-12 1 -30 2 -43 2c-20 0 -29 0 -29 12c0 19 11 19 30 19h137c26 0 28 0 31 -23l78 -566l365 570c12 19 13 19 39 19h132c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D446" d="M645 695l-54 -219c-4 -17 -5 -20 -15 -20c-12 0 -12 10 -12 10c0 6 4 24 4 56c0 112 -61 155 -144 155c-95 0 -175 -85 -175 -166c0 -53 34 -82 61 -91l67 -18c89 -23 104 -27 127 -50c15 -14 49 -48 49 -117c0 -124 -118 -257 -254 -257c-58 0 -126 14 -169 72l-49 -57 c-12 -14 -13 -15 -18 -15c-6 0 -11 4 -11 10c0 3 56 231 60 235c3 3 5 4 10 4s12 -1 12 -11c0 0 -1 -3 -2 -7c-1 -6 -6 -30 -6 -54c0 -124 111 -146 175 -146c98 0 180 94 180 184c0 82 -55 97 -92 106l-107 28c-51 15 -104 61 -104 142c0 121 120 236 247 236 c65 0 117 -25 143 -72l48 57c12 14 13 15 18 15c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNSIZE1-2211" d="M1387 -130l-121 -320h-1182c-18 0 -27 0 -27 11c0 0 0 6 10 18l518 607l-529 724c0 11 0 30 1 33c3 6 4 7 27 7h1182l121 -281h-25c-34 81 -102 126 -127 142c-79 50 -166 67 -220 75c-9 2 -100 16 -234 16h-548l466 -637c7 -10 7 -15 7 -15c0 -5 -2 -8 -9 -16l-509 -597 h603c192 0 290 26 311 31c115 30 221 98 260 202h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D440" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1372" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1772" y="0"></use>
<g transform="translate(2829,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="867" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4189" y="0"></use>
<g transform="translate(5190,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D446" x="0" y="0"></use>
<g transform="translate(613,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="7510" y="0"></use>
<g transform="translate(8566,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-2211" x="0" y="0"></use>
<g transform="translate(147,-1090)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3D" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="721" y="1627"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="10011" y="0"></use>
<g transform="translate(10400,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="11795" y="0"></use>
<g transform="translate(12796,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1204" y="-213"></use>
</g>
<g transform="translate(14172,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="550" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="15238" y="0"></use>
<g transform="translate(16239,0)">
 <use xlink:href="#E1-LATINMODERNSIZE1-2211" x="0" y="0"></use>
<g transform="translate(147,-1090)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-3D" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
<g transform="translate(57,1151)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="17683" y="0"></use>
<g transform="translate(18073,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="19468" y="0"></use>
<g transform="translate(20468,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
<g transform="translate(851,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
<g transform="translate(22749,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="550" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="23592" y="0"></use>
</g>
</svg>
</div>
<p>

After some algebraic manipulation, this can be found to be equal to
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:welford-S"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="30.877ex" height="3.009ex" style="vertical-align: -0.838ex;" viewBox="0 -934.9 13294.1 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper M Subscript n Baseline equals left-parenthesis upper X Subscript n Baseline minus upper X overbar Subscript n Baseline right-parenthesis left-parenthesis upper X Subscript i Baseline minus upper X overbar Subscript n minus 1 Baseline right-parenthesis comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D440" d="M1044 672c0 -20 -9 -20 -32 -20c-75 0 -77 -10 -86 -46l-133 -533c-5 -18 -5 -20 -5 -24c0 -18 28 -18 65 -18c19 0 28 0 28 -11c0 -20 -13 -20 -19 -20c-41 0 -84 3 -125 3l-124 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47l143 573h-1l-404 -633 c-5 -7 -11 -18 -22 -18c-12 0 -13 11 -15 23l-86 620h-1l-136 -545c-3 -11 -4 -16 -4 -23c0 -23 11 -43 68 -44c7 0 18 0 18 -11c0 -20 -13 -20 -18 -20c-33 0 -69 3 -103 3c-33 0 -68 -3 -100 -3c-8 0 -14 3 -14 12c0 18 13 19 18 19c81 3 98 35 108 75l127 509 c3 12 4 15 4 19c0 11 -6 14 -22 16c-12 1 -30 2 -43 2c-20 0 -29 0 -29 12c0 19 11 19 30 19h137c26 0 28 0 31 -23l78 -566l365 570c12 19 13 19 39 19h132c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44B" d="M851 672c0 -19 -9 -19 -22 -20c-60 -3 -98 -27 -127 -51c-32 -28 -137 -147 -205 -217l129 -309c17 -40 19 -43 86 -44c8 0 18 0 18 -12c0 -19 -12 -19 -19 -19c-25 0 -86 3 -111 3l-126 -3c-4 0 -15 0 -15 12c0 17 9 18 20 19c39 4 58 21 58 29l-5 14l-101 239l-90 -98 l-102 -108c-12 -13 -27 -29 -27 -45c0 -28 31 -30 40 -31c0 0 12 -1 12 -11c0 -20 -12 -20 -18 -20c-36 0 -75 3 -112 3c-31 0 -64 -3 -94 -3c-13 0 -13 11 -13 11c0 19 9 19 22 20c51 3 98 19 147 72c6 5 7 6 13 11l211 227l-118 279c-9 22 -15 32 -75 32 c-13 0 -23 0 -23 11c0 20 12 20 18 20c25 0 87 -3 112 -3c42 0 85 3 126 3c3 0 15 0 15 -12c0 -17 -10 -18 -20 -19c-42 -4 -59 -23 -59 -29l5 -13l84 -199l162 174c8 9 19 22 19 36c0 28 -31 30 -40 31c-7 1 -12 4 -12 11c0 20 13 20 19 20c36 0 74 -3 111 -3 c31 0 64 3 94 3c13 0 13 -11 13 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-AF" d="M431 589h-361v31h361v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D440" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1372" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1772" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="2829" y="0"></use>
<g transform="translate(3218,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1171" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="4794" y="0"></use>
<g transform="translate(5794,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="1204" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7170" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="7560" y="0"></use>
<g transform="translate(7949,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="1171" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="9344" y="0"></use>
<g transform="translate(10345,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-AF" x="190" y="203"></use>
<g transform="translate(851,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45B" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="600" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1379" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="12626" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="13015" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:welford-S">B.18</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

which is comprised of quantities that are all readily available.  The
implementation of the <a href="#VarianceEstimator"><tt>VarianceEstimator</tt></a> <tt>Add()</tt> method is then
just a matter of applying Equations&nbsp;(<a href="#eq:welford-mean">B.18</a>) and (<a href="#eq:welford-S">B.18</a>).

</p>
<p></p>
<span class="anchor" id="fragment-VarianceEstimatorPublicMethods-0"></span><div class="fragmentname">&lt;&lt;VarianceEstimator Public Methods&gt;&gt;=&nbsp;<a href="#fragment-VarianceEstimatorPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="VarianceEstimator::Add"></span>Add(Float x) {
    ++<a href="#VarianceEstimator::n" class="code">n</a>;
    Float delta = x - <a href="#VarianceEstimator::mean" class="code">mean</a>;
    <a href="#VarianceEstimator::mean" class="code">mean</a> += delta / <a href="#VarianceEstimator::n" class="code">n</a>;
    Float delta2 = x - <a href="#VarianceEstimator::mean" class="code">mean</a>;
    <a href="#VarianceEstimator::S" class="code">S</a> += delta * delta2;
}</div><p>


</p>
<p>Given these two quantities, <a href="#VarianceEstimator"><tt>VarianceEstimator</tt></a> can provide a number of
useful statistical quantities.

</p>
<p></p>
<span class="anchor" id="fragment-VarianceEstimatorPublicMethods-1"></span><div class="fragmentname">&lt;&lt;VarianceEstimator Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-VarianceEstimatorPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="VarianceEstimator::Mean"></span><a href="#VarianceEstimator::Mean" class="code">Mean</a>() const { return <a href="#VarianceEstimator::mean" class="code">mean</a>; }
Float <span class="anchor" id="VarianceEstimator::Variance"></span><a href="#VarianceEstimator::Variance" class="code">Variance</a>() const { return (<a href="#VarianceEstimator::n" class="code">n</a> &gt; 1) ? <a href="#VarianceEstimator::S" class="code">S</a> / (<a href="#VarianceEstimator::n" class="code">n</a> - 1) : 0; }
Float <span class="anchor" id="VarianceEstimator::RelativeVariance"></span>RelativeVariance() const {
    return (<a href="#VarianceEstimator::n" class="code">n</a> &lt; 1 || <a href="#VarianceEstimator::mean" class="code">mean</a> == 0) ? 0 : <a href="#VarianceEstimator::Variance" class="code">Variance</a>() / <a href="#VarianceEstimator::Mean" class="code">Mean</a>();
}</div><p>


</p>
<p>It is also possible to merge two <a href="#VarianceEstimator"><tt>VarianceEstimator</tt></a>s so that the
result stores the same mean and variance estimates (modulo minor
floating-point rounding error) as if a single <a href="#VarianceEstimator"><tt>VarianceEstimator</tt></a> had
processed all the values seen by the two of them. This capability is
particularly useful in parallel implementations, where separate threads may
separately compute sample statistics that are merged later.

</p>
<p>The <tt>Merge()</tt><span class="anchor" id="VarianceEstimator::Merge"></span> method implements
this operation, which we will not include here; see the &ldquo;Further Reading&rdquo;
section for details of its derivation.

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#SquareMatrices"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:square-matrix"></span><span id="SquareMatrices"></span><h3>B.2.12  Square Matrices</h3><p>



</p>
<p>The <a href="#SquareMatrix"><tt>SquareMatrix</tt></a> class provides a representation of square matrices
with dimensionality set at compile time via the template parameter
<tt>N</tt>.  It is an integral part of both the <a href="../Geometry_and_Transformations/Transformations.html#Transform"><tt>Transform</tt></a> class and
<tt>pbrt</tt>&rsquo;s color space conversion code.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixDefinition-0"></span><div class="fragmentname">&lt;&lt;SquareMatrix Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">template &lt;int N&gt;
class <span class="anchor" id="SquareMatrix"></span>SquareMatrix {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-SquareMatrixPublicMethods-0">SquareMatrix Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2736" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2736"><i></i></a><div id="fragbit-2736" class="collapse show"><div class="fragmentcode">       static SquareMatrix Zero() {
           SquareMatrix <a href="#SquareMatrix::m" class="code">m</a>;
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   <a href="#SquareMatrix::m" class="code">m</a>.<a href="#SquareMatrix::m" class="code">m</a>[i][j] = 0;
           return <a href="#SquareMatrix::m" class="code">m</a>;
       }
       PBRT_CPU_GPU
       SquareMatrix() {
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   <a href="#SquareMatrix::m" class="code">m</a>[i][j] = (i == j) ? 1 : 0;
       }
       PBRT_CPU_GPU
       SquareMatrix(const Float mat[N][N]) {
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   <a href="#SquareMatrix::m" class="code">m</a>[i][j] = mat[i][j];
       }
       PBRT_CPU_GPU
       SquareMatrix(pstd::span&lt;const Float&gt; t);
       template &lt;typename... Args&gt;
       PBRT_CPU_GPU SquareMatrix(Float v, Args... args) {
           static_assert(1 + sizeof...(Args) == N * N,
                         "Incorrect number of values provided to SquareMatrix constructor");
           init&lt;N&gt;(<a href="#SquareMatrix::m" class="code">m</a>, 0, 0, v, args...);
       }
       template &lt;typename... Args&gt;
       PBRT_CPU_GPU static SquareMatrix Diag(Float v, Args... args) {
           static_assert(1 + sizeof...(Args) == N,
                         "Incorrect number of values provided to SquareMatrix::Diag");
           SquareMatrix <a href="#SquareMatrix::m" class="code">m</a>;
           initDiag&lt;N&gt;(<a href="#SquareMatrix::m" class="code">m</a>.<a href="#SquareMatrix::m" class="code">m</a>, 0, v, args...);
           return <a href="#SquareMatrix::m" class="code">m</a>;
       }
       SquareMatrix operator+(const SquareMatrix &amp;<a href="#SquareMatrix::m" class="code">m</a>) const {
           SquareMatrix r = *this;
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   r.<a href="#SquareMatrix::m" class="code">m</a>[i][j] += <a href="#SquareMatrix::m" class="code">m</a>.<a href="#SquareMatrix::m" class="code">m</a>[i][j];
           return r;
       }
       PBRT_CPU_GPU
       SquareMatrix operator*(Float s) const {
           SquareMatrix r = *this;
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   r.<a href="#SquareMatrix::m" class="code">m</a>[i][j] *= s;
           return r;
       }
       PBRT_CPU_GPU
       SquareMatrix operator/(Float s) const {
           DCHECK_NE(s, 0);
           SquareMatrix r = *this;
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   r.<a href="#SquareMatrix::m" class="code">m</a>[i][j] /= s;
           return r;
       }
       
       PBRT_CPU_GPU
       bool operator==(const SquareMatrix&lt;N&gt; &amp;m2) const {
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   if (<a href="#SquareMatrix::m" class="code">m</a>[i][j] != m2.<a href="#SquareMatrix::m" class="code">m</a>[i][j])
                       return false;
           return true;
       }
       
       PBRT_CPU_GPU
       bool operator!=(const SquareMatrix&lt;N&gt; &amp;m2) const {
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j)
                   if (<a href="#SquareMatrix::m" class="code">m</a>[i][j] != m2.<a href="#SquareMatrix::m" class="code">m</a>[i][j])
                       return true;
           return false;
       }
       
       PBRT_CPU_GPU
       bool operator&lt;(const SquareMatrix&lt;N&gt; &amp;m2) const {
           for (int i = 0; i &lt; N; ++i)
               for (int j = 0; j &lt; N; ++j) {
                   if (<a href="#SquareMatrix::m" class="code">m</a>[i][j] &lt; m2.<a href="#SquareMatrix::m" class="code">m</a>[i][j])
                       return true;
                   if (<a href="#SquareMatrix::m" class="code">m</a>[i][j] &gt; m2.<a href="#SquareMatrix::m" class="code">m</a>[i][j])
                       return false;
               }
           return false;
       }
       bool IsIdentity() const;
       std::string ToString() const;
       pstd::span&lt;const Float&gt; operator[](int i) const { return <a href="#SquareMatrix::m" class="code">m</a>[i]; }
       pstd::span&lt;Float&gt; operator[](int i) { return pstd::span&lt;Float&gt;(<a href="#SquareMatrix::m" class="code">m</a>[i]); }</div></div>
  private:
    Float <span class="anchor" id="SquareMatrix::m"></span>m[N][N];
};</div><p>


</p>
<p>The default constructor initializes the identity matrix.  Other
constructors (not included here) allow providing the values of the matrix
directly or via a two-dimensional array of values.  Alternatively,
<tt>Zero()</tt> can be used to get a zero-valued matrix or
<tt>Diag()</tt><span class="anchor" id="SquareMatrix::Diag"></span> can be called with <tt>N</tt>
values to get the corresponding diagonal matrix.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixPublicMethods-0"></span><div class="fragmentname">&lt;&lt;SquareMatrix Public Methods&gt;&gt;=&nbsp;<a href="#fragment-SquareMatrixPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">static SquareMatrix <span class="anchor" id="SquareMatrix::Zero"></span>Zero() {
    SquareMatrix <a href="#SquareMatrix::m" class="code">m</a>;
    for (int i = 0; i &lt; N; ++i)
        for (int j = 0; j &lt; N; ++j)
            <a href="#SquareMatrix::m" class="code">m</a>.<a href="#SquareMatrix::m" class="code">m</a>[i][j] = 0;
    return <a href="#SquareMatrix::m" class="code">m</a>;
}</div><p>


</p>
<p>

</p>
<p>All the basic arithmetic operations between matrices are provided,
including multiplying them or dividing them by scalar values.  Here
is the implementation of the method that adds two matrices together.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixPublicMethods-1"></span><div class="fragmentname">&lt;&lt;SquareMatrix Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-SquareMatrixPublicMethods-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-SquareMatrixPublicMethods-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">SquareMatrix operator+(const SquareMatrix &amp;<a href="#SquareMatrix::m" class="code">m</a>) const {
    SquareMatrix r = *this;
    for (int i = 0; i &lt; N; ++i)
        for (int j = 0; j &lt; N; ++j)
            r.<a href="#SquareMatrix::m" class="code">m</a>[i][j] += <a href="#SquareMatrix::m" class="code">m</a>.<a href="#SquareMatrix::m" class="code">m</a>[i][j];
    return r;
}</div><p>


</p>
<p>

</p>
<p>The <tt>IsIdentity()</tt> checks whether the matrix is the identity matrix
via a simple loop over its elements.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixPublicMethods-2"></span><div class="fragmentname">&lt;&lt;SquareMatrix Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-SquareMatrixPublicMethods-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-SquareMatrixPublicMethods-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">bool <span class="anchor" id="SquareMatrix::IsIdentity"></span>IsIdentity() const;</div><p>


</p>
<p>

</p>
<p>Indexing operators are provided as well.  Because these methods return
<tt>span</tt>s, the syntax for multidimensional indexing is the same as it is
for regular C++ arrays: <tt>m[i][j]</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixPublicMethods-3"></span><div class="fragmentname">&lt;&lt;SquareMatrix Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-SquareMatrixPublicMethods-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">pstd::span&lt;const Float&gt; operator[](int i) const { return m[i]; }
pstd::span&lt;Float&gt; operator[](int i) { return pstd::span&lt;Float&gt;(m[i]); }</div><p>


</p>
<p>

</p>
<p>The <a href="#SquareMatrix"><tt>SquareMatrix</tt></a> class provides a matrix&ndash;vector multiplication
function based on template classes to define the types of both the vector
that is operated on and the result.  It only requires that the result type
has a default constructor and that both types allow element indexing via
<tt>operator[]</tt>.  Thus it can, for example, be used in <tt>pbrt</tt>&rsquo;s color space conversion
code to convert from <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB"><tt>RGB</tt></a> to <a href="../Radiometry,_Spectra,_and_Color/Color.html#XYZ"><tt>XYZ</tt></a> via a call of the form
<tt>Mul&lt;XYZ&gt;(m, rgb)</tt>, where <tt>m</tt> is a <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.165ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2223.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">3 times 3</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="722" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1723" y="0"></use>
</g>
</svg>
<tt>SquareMatrix</tt> and <tt>rgb</tt> is of type&nbsp;<tt>RGB</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixInlineFunctions-0"></span><div class="fragmentname">&lt;&lt;SquareMatrix Inline Functions&gt;&gt;=&nbsp;<a href="#fragment-SquareMatrixInlineFunctions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename Tresult, int N, typename T&gt;
Tresult <span class="anchor" id="SquareMatrix::Mul"></span>Mul(const SquareMatrix&lt;N&gt; &amp;m, const T &amp;v) {
    Tresult result;
    for (int i = 0; i &lt; N; ++i) {
        result[i] = 0;
        for (int j = 0; j &lt; N; ++j)
            result[i] += m[i][j] * v[j];
    }
    return result;
}</div><p>


</p>
<p>The <tt>Determinant()</tt> function returns the value of the matrix&rsquo;s
determinant using the standard formula.  Specializations for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.165ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2223.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">3 times 3</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="722" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1723" y="0"></use>
</g>
</svg>
and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.165ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2223.9 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">4 times 4</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-D7" d="M624 15c-7 -8 -20 -8 -28 0l-207 207l-207 -207c-8 -8 -21 -8 -28 0c-8 7 -8 20 0 28l207 207l-207 207c-8 8 -8 21 0 28c7 8 20 8 28 0l207 -207l207 207c8 8 21 8 28 0c8 -7 8 -20 0 -28l-207 -207l207 -207c8 -8 8 -21 0 -28Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-D7" x="722" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-34" x="1723" y="0"></use>
</g>
</svg> matrices are carefully written to use
<a href="#DifferenceOfProducts"><tt>DifferenceOfProducts()</tt></a> for intermediate calculations of matrix minors
in order to maximize accuracy in the result for those common cases.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixInlineFunctions-1"></span><div class="fragmentname">&lt;&lt;SquareMatrix Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-SquareMatrixInlineFunctions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-SquareMatrixInlineFunctions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;int N&gt;
Float <span class="anchor" id="SquareMatrix::Determinant"></span>Determinant(const SquareMatrix&lt;N&gt; &amp;m);</div><p>


</p>
<p>

</p>
<p>Finally, there are both <tt>Transpose()</tt> and
<tt>Inverse()</tt> functions.  Like <tt>Determinant()</tt>, <tt>Inverse()</tt> has
specializations for <tt>N</tt> up to&nbsp;4 and then a general implementation for
matrices of larger dimensionality.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixInlineFunctions-2"></span><div class="fragmentname">&lt;&lt;SquareMatrix Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-SquareMatrixInlineFunctions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-SquareMatrixInlineFunctions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;int N&gt;
SquareMatrix&lt;N&gt; <span class="anchor" id="SquareMatrix::Transpose"></span>Transpose(const SquareMatrix&lt;N&gt; &amp;m);
template &lt;int N&gt;
pstd::optional&lt;SquareMatrix&lt;N&gt;&gt; <span class="anchor" id="SquareMatrix::Inverse"></span>Inverse(const SquareMatrix&lt;N&gt; &amp;);</div><p>


</p>
<p>The regular <tt>Inverse()</tt> function returns an unset <tt>optional</tt>
value if the matrix has no inverse.  If no recovery is possible in that
case, <tt>InvertOrExit()</tt> can be used, allowing calling code to directly
access the matrix result.

</p>
<p></p>
<span class="anchor" id="fragment-SquareMatrixInlineFunctions-3"></span><div class="fragmentname">&lt;&lt;SquareMatrix Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-SquareMatrixInlineFunctions-2"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;int N&gt;
SquareMatrix&lt;N&gt; <span class="anchor" id="SquareMatrix::InvertOrExit"></span>InvertOrExit(const SquareMatrix&lt;N&gt; &amp;m) {
    pstd::optional&lt;SquareMatrix&lt;N&gt;&gt; inv = <a href="#SquareMatrix::Inverse" class="code">Inverse</a>(m);
    CHECK(inv.has_value());
    return *inv;
}</div><p>


</p>
<p>

</p>
<p>

</p>
<p>Given the <tt>SquareMatrix</tt> definition, it is easy to implement a
<tt>LinearLeastSquares()</tt> function that finds a matrix <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.537ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1092.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">bold upper M</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D40C" d="M1051 0c-36 3 -130 3 -171 3s-134 0 -170 -3v47h108v592h-1l-279 -615c-4 -9 -12 -24 -32 -24c-11 0 -23 5 -32 25l-272 601h-1v-550c0 -22 1 -23 30 -26c18 -2 35 -3 53 -3h25v-47c-41 3 -93 3 -135 3c-39 0 -96 0 -134 -3v47h25c28 0 30 0 54 3c28 3 29 4 29 26v563 h-108v47h222c22 0 33 0 44 -25l240 -529l240 529c11 25 22 25 44 25h221v-47h-108v-592h108v-47Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D40C" x="0" y="0"></use>
</g>
</svg> that
minimizes the least squares error of a mapping from one set of vectors to
another.  This function is used as part of <tt>pbrt</tt>&rsquo;s infrastructure for
modeling camera response curves.

</p>
<p></p>
<span class="anchor" id="fragment-MathInlineFunctions-36"></span><div class="fragmentname">&lt;&lt;Math Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-MathInlineFunctions-35"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;int N&gt; pstd::optional&lt;SquareMatrix&lt;N&gt;&gt;
<span class="anchor" id="LinearLeastSquares"></span>LinearLeastSquares(const Float A[][N], const Float B[][N], int rows);</div><p>


</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#BeacutezierCurves"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="BeacutezierCurves"></span><h3>B.2.13  B&eacute;zier Curves</h3><p>


</p>
<p>B&eacute;zier curves, first introduced in Section&nbsp;<a href="../Shapes/Curves.html#sec:curves">6.7</a> with the
<a href="../Shapes/Curves.html#Curve"><tt>Curve</tt></a> shape, are polynomial functions that are widely used in
graphics.  They are specified by a number of control points <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.092ex" height="2.176ex" style="vertical-align: -0.838ex;" viewBox="0 -576.1 900.8 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript Baseline Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="787" y="-326"></use>
</g>
</svg> that
have the useful property that the curve passes through the first and last
of them.  Cubic B&eacute;ziers, which are specified by four control points, are
commonly used.  <tt>pbrt</tt>&rsquo;s functions for working with them are defined in the
file <a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/util/splines.h"><tt>util/splines.h</tt></a>.

</p>
<p>They are commonly defined using polynomial
basis functions called the <em>Bernstein basis functions</em>, though here we
will focus on them through an approach called <em>blossoming</em>.  The
blossom <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.026ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5178.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b left-parenthesis u 0 comma u 1 comma u 2 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="429" y="0"></use>
<g transform="translate(819,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1845" y="0"></use>
<g transform="translate(2290,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3316" y="0"></use>
<g transform="translate(3762,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4788" y="0"></use>
</g>
</svg> of a cubic B&eacute;zier is defined by three
stages of linear interpolation, starting with the original control points <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.092ex" height="2.176ex" style="vertical-align: -0.838ex;" viewBox="0 -576.1 900.8 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal p Subscript Baseline Subscript i</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="787" y="-326"></use>
</g>
</svg>:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:blossoming"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="48.783ex" height="10.343ex" style="vertical-align: -4.671ex;" viewBox="0 -2441.8 21003.9 4453.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartLayout 1st Row 1st Column normal a Subscript i 2nd Column equals left-parenthesis 1 minus u 0 right-parenthesis normal p Subscript Baseline Subscript i Baseline plus u 0 normal p Subscript Baseline Subscript i plus 1 Baseline i element-of left-bracket 0 comma 1 comma 2 right-bracket 2nd Row 1st Column normal b Subscript j 2nd Column equals left-parenthesis 1 minus u 1 right-parenthesis normal a Subscript j Baseline plus u 1 normal a Subscript j plus 1 Baseline j element-of left-bracket 0 comma 1 right-bracket 3rd Row 1st Column b left-parenthesis u 0 comma u 1 comma u 2 right-parenthesis 2nd Column equals left-parenthesis 1 minus u 2 right-parenthesis normal b 0 plus u 2 normal b 1 period EndLayout</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-61" d="M483 89c0 -81 -61 -95 -82 -95c-47 0 -74 42 -78 82c-19 -47 -65 -87 -131 -87c-63 0 -160 25 -160 106c0 44 25 96 100 130c63 30 133 33 184 36v37c0 89 -57 128 -106 128c-32 0 -81 -11 -108 -46c46 -1 51 -34 51 -46c0 -26 -18 -46 -46 -46c-26 0 -46 17 -46 47 c0 66 69 113 151 113c48 0 98 -16 137 -55c36 -37 36 -76 36 -118v-200c0 -5 4 -50 37 -50c11 0 36 6 36 64v56h25v-56zM316 140v100c-165 -6 -207 -89 -207 -144c0 -50 41 -85 90 -85c45 0 117 34 117 129Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2208" d="M587 -23c0 -11 -9 -20 -20 -20h-193c-162 0 -293 131 -293 293s131 293 293 293h193c11 0 20 -9 20 -20s-9 -20 -20 -20h-193c-133 0 -242 -103 -252 -233h445c27 0 27 -40 0 -40h-445c10 -130 119 -233 252 -233h193c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-62" d="M521 216c0 -129 -104 -227 -223 -227c-74 0 -116 50 -131 73l-36 -62h-25v596c0 49 -8 56 -78 56v31l144 11v-317c16 18 59 65 137 65c114 0 212 -99 212 -226zM438 217c0 41 -3 98 -29 139c-24 38 -60 64 -105 64c-24 0 -79 -8 -118 -64c-11 -16 -11 -17 -11 -36v-206 c0 -18 0 -21 14 -42c24 -37 60 -61 105 -61c54 0 92 33 113 64c29 45 31 105 31 142Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D457" d="M397 625c0 -27 -27 -53 -54 -53c-23 0 -37 16 -37 36c0 30 30 53 53 53c24 0 38 -17 38 -36zM360 350c0 -3 0 -17 -5 -37l-92 -366c-25 -99 -118 -152 -188 -152c-48 0 -88 22 -88 62c0 36 29 57 54 57c27 0 38 -19 38 -35c0 -20 -15 -46 -45 -53c18 -9 33 -9 39 -9 c56 0 104 57 123 133l94 373c4 17 7 28 7 51c0 42 -18 46 -32 46c-55 0 -101 -61 -126 -122c-8 -19 -9 -20 -18 -20c0 0 -12 0 -12 10c0 9 57 154 159 154c50 0 92 -35 92 -92Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(167,0)">
<g transform="translate(-11,0)">
<g transform="translate(4333,1567)">
 <use xlink:href="#E1-LATINMODERNMAIN-61" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="707" y="-213"></use>
</g>
<g transform="translate(4396,-23)">
 <use xlink:href="#E1-LATINMODERNMAIN-62" x="0" y="0"></use>
<g transform="translate(556,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="-236" y="0"></use>
</g>
</g>
<g transform="translate(0,-1619)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="429" y="0"></use>
<g transform="translate(819,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1845" y="0"></use>
<g transform="translate(2290,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3316" y="0"></use>
<g transform="translate(3762,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4788" y="0"></use>
</g>
</g>
<g transform="translate(5445,0)">
<g transform="translate(0,1567)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1056" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1445" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2168" y="0"></use>
<g transform="translate(3169,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4195" y="0"></use>
<g transform="translate(4585,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="787" y="-326"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="5708" y="0"></use>
<g transform="translate(6708,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="809" y="-213"></use>
</g>
<g transform="translate(7901,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
<g transform="translate(556,-231)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2B" x="345" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="1124" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D456" x="10707" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2208" x="11330" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="12275" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="12554" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="13054" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="13499" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="14000" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="14445" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="14946" y="0"></use>
</g>
<g transform="translate(0,-23)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1056" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1445" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2168" y="0"></use>
<g transform="translate(3169,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4195" y="0"></use>
<g transform="translate(4585,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-61" x="0" y="0"></use>
<g transform="translate(500,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="-236" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="5532" y="0"></use>
<g transform="translate(6533,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="809" y="-213"></use>
</g>
<g transform="translate(7726,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-61" x="0" y="0"></use>
<g transform="translate(500,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D457" x="-236" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2B" x="176" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="955" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D457" x="10356" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2208" x="11046" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="11992" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="12270" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="12771" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="13216" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="13716" y="0"></use>
</g>
<g transform="translate(0,-1619)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1056" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1445" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2168" y="0"></use>
<g transform="translate(3169,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4195" y="0"></use>
<g transform="translate(4585,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="787" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="5817" y="0"></use>
<g transform="translate(6818,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="809" y="-213"></use>
</g>
<g transform="translate(8011,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-62" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="787" y="-213"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="9021" y="0"></use>
</g>
</g>
</g>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:blossoming">B.18</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>


</p>
<p><tt>BlossomBezier()</tt> implements this computation, which we will see has a
variety of uses.  The type <tt>P</tt> of the control point is a template
parameter, which makes it possible to call this function with any type for
which a <tt>Lerp()</tt> function is defined.

</p>
<p></p>
<span class="anchor" id="fragment-BezierInlineFunctions-0"></span><div class="fragmentname">&lt;&lt;Bezier Inline Functions&gt;&gt;=&nbsp;<a href="#fragment-BezierInlineFunctions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename P&gt;
P <span class="anchor" id="BlossomCubicBezier"></span>BlossomCubicBezier(pstd::span&lt;const P&gt; p, Float u0, Float u1, Float u2) {
    P a[3] = { <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u0, p[0], p[1]), <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u0, p[1], p[2]),
               <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u0, p[2], p[3]) };
    P b[2] = { <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u1, a[0], a[1]), <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u1, a[1], a[2]) };
    return <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u2, b[0], b[1]);
}</div><p>


</p>
<p>The blossom <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.109ex" height="2.843ex" style="vertical-align: -0.838ex; margin-left: -0.073ex;" viewBox="-31.5 -863.1 3921.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">p left-parenthesis u comma u comma u right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="893" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1465" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="1910" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2483" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2928" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3500" y="0"></use>
</g>
</svg> gives the curve&rsquo;s value at position <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg>. (To
verify this for yourself, expand Equation&nbsp;(<a href="#eq:blossoming">B.18</a>) using <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.558ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 2823.4 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u Subscript i Baseline equals u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="809" y="-213"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1194" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="2250" y="0"></use>
</g>
</svg>, simplify, and compare to Equation&nbsp;(<a href="../Shapes/Curves.html#eq:bezier-basic">6.16</a>).)  Thus,
implementation of the <tt>EvaluateCubicBezier()</tt> function is trivial.
It too is a template function of the type of control point.

</p>
<p></p>
<span class="anchor" id="fragment-BezierInlineFunctions-1"></span><div class="fragmentname">&lt;&lt;Bezier Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BezierInlineFunctions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-BezierInlineFunctions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename P&gt;
P <span class="anchor" id="EvaluateCubicBezier"></span>EvaluateCubicBezier(pstd::span&lt;const P&gt; cp, Float u) {
    return <a href="#BlossomCubicBezier" class="code">BlossomCubicBezier</a>(cp, u, u, u);
}</div><p>


</p>
<p>

</p>
<p>A second variant of <tt>EvaluateCubicBezier()</tt> also optionally returns
the curve&rsquo;s derivative at the evaluation point. This and the
following B&eacute;zier functions could also be template functions based on the
type of control point; for <tt>pbrt</tt>&rsquo;s uses, however, only <a href="../Geometry_and_Transformations/Points.html#Point3f"><tt>Point3f</tt></a> variants are
required.  We therefore implement them in terms of <tt>Point3f</tt>, if only
to save the verbosity and slight obscurity of the templated variants.

</p>
<p></p>
<span class="anchor" id="fragment-BezierInlineFunctions-2"></span><div class="fragmentname">&lt;&lt;Bezier Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BezierInlineFunctions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-BezierInlineFunctions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> EvaluateCubicBezier(pstd::span&lt;const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>&gt; cp, Float u,
                            <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> *deriv) {
    <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> cp1[3] = { <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u, cp[0], cp[1]), <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u, cp[1], cp[2]),
                       <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u, cp[2], cp[3]) };
    <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a> cp2[2] = { <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u, cp1[0], cp1[1]), <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u, cp1[1], cp1[2]) };
    if (deriv) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputeBeziercurvederivativeatu-0">Compute B&eacute;zier curve derivative at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2737" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2737"><i></i></a><div id="fragbit-2737" class="collapse show"><div class="fragmentcode">           if (<a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(cp2[1] - cp2[0]) &gt; 0)
               *deriv = 3 * (cp2[1] - cp2[0]);
           else
               *deriv = cp[3] - cp[0];</div></div>
    }
    return <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(u, cp2[0], cp2[1]);
}</div><p>


</p>
<p>With blossoming, the final two control points that are linearly interpolated to compute the
curve value define a line that is tangent to the curve.

</p>
<p>One edge case must be handled here: if, for example, the first three
control points are coincident, then the derivative of the curve is
legitimately 0 at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.591ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2407.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="850" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1906" y="0"></use>
</g>
</svg>. 
However, returning a zero-valued derivative
in that case would be problematic since <tt>pbrt</tt> uses the derivative to
compute the tangent vector of the curve.
Therefore, this function
returns the difference between the first and last control points in such
cases.

</p>
<p></p>
<span class="anchor" id="fragment-ComputeBeziercurvederivativeatu-0"></span><div class="fragmentname">&lt;&lt;Compute B&eacute;zier curve derivative at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.33ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 572.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
</g>
</svg>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (<a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(cp2[1] - cp2[0]) &gt; 0)
    *deriv = 3 * (cp2[1] - cp2[0]);
else
    *deriv = cp[3] - cp[0];</div><p>


</p>
<p><tt>SubdivideCubicBezier()</tt> splits a B&eacute;zier curve into two B&eacute;zier
curves that together are equivalent to the original curve. The last control
point of the first subdivided curve is the same as the first control point
of the second one and the 7&nbsp;total control points are specified by the
blossoms <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.365ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3170.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2781" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.689ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4171.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 comma 1 slash 2 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2781" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="3281" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3782" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.014ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5172.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 1 slash 2 comma 1 slash 2 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="2336" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2836" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="3281" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3782" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="4282" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4783" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.339ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 6173.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 1 slash 2 comma 1 slash 2 comma 1 slash 2 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1390" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1891" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2336" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2836" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="3337" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3837" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="4282" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="4783" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="5283" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="5784" y="0"></use>
</g>
</svg>,
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.014ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5172.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 1 slash 2 comma 1 slash 2 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1390" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1891" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2336" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2836" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="3337" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3837" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="4282" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="4783" y="0"></use>
</g>
</svg>, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.689ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4171.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 1 slash 2 comma 1 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1390" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1891" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2336" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2836" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="3281" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3782" y="0"></use>
</g>
</svg>, and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.365ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3170.8 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 1 comma 1 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1835" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2280" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2781" y="0"></use>
</g>
</svg>.  There is no need to call
<a href="#BlossomCubicBezier"><tt>BlossomCubicBezier()</tt></a> to evaluate them, however, as each one works out
to be a simple combination of existing control points.

</p>
<p></p>
<span class="anchor" id="fragment-BezierInlineFunctions-3"></span><div class="fragmentname">&lt;&lt;Bezier Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BezierInlineFunctions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-BezierInlineFunctions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">pstd::array&lt;<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>, 7&gt; <span class="anchor" id="SubdivideCubicBezier"></span>SubdivideCubicBezier(pstd::span&lt;const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>&gt; cp) {
    return {cp[0],
            (cp[0] + cp[1]) / 2,
            (cp[0] + 2 * cp[1] + cp[2]) / 4,
            (cp[0] + 3 * cp[1] + 3 * cp[2] + cp[3]) / 8,
            (cp[1] + 2 * cp[2] + cp[3]) / 4,
            (cp[2] + cp[3]) / 2,
            cp[3]};
}</div><p>


</p>
<p> </p>
<span class="anchor" id="fig:bezier-blossom"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
<img src="phabbf05.png" style="max-width: 100%; height: auto;" width=1088 height=280>
</div>
<p>


</p>
<figcaption class="caption">Figure B.5: Blossoming to Find Control Points for a Segment of a B&eacute;zier
Curve. <span class="legend">
The four blossoms in Equation&nbsp;(<a href="#eq:blossom-4-cp">B.18</a>) give the control
points for the curve from <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.302ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 1852.3 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u Subscript normal m normal i normal n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
</svg> to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.621ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 1989.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u Subscript normal m normal a normal x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-61" d="M483 89c0 -81 -61 -95 -82 -95c-47 0 -74 42 -78 82c-19 -47 -65 -87 -131 -87c-63 0 -160 25 -160 106c0 44 25 96 100 130c63 30 133 33 184 36v37c0 89 -57 128 -106 128c-32 0 -81 -11 -108 -46c46 -1 51 -34 51 -46c0 -26 -18 -46 -46 -46c-26 0 -46 17 -46 47 c0 66 69 113 151 113c48 0 98 -16 137 -55c36 -37 36 -76 36 -118v-200c0 -5 4 -50 37 -50c11 0 36 6 36 64v56h25v-56zM316 140v100c-165 -6 -207 -89 -207 -144c0 -50 41 -85 90 -85c45 0 117 34 117 129Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-78" d="M516 0c-30 2 -69 3 -96 3l-108 -3v31c27 1 36 16 36 25c0 6 -13 22 -21 33l-76 100c-61 -72 -90 -105 -90 -127c0 -15 7 -28 29 -31v-31l-95 3c-26 0 -57 -1 -83 -3v31c21 0 80 2 128 60c47 57 47 59 94 119l-99 129c-47 60 -48 61 -118 61v31c27 -2 74 -3 95 -3l108 3 v-31c-20 -1 -35 -10 -35 -25c0 -6 0 -8 9 -18l78 -101l62 78c5 6 15 19 15 35s-8 29 -29 31v31c13 -1 66 -3 96 -3c26 0 56 1 82 3v-31c-47 -1 -88 -16 -119 -52c-24 -26 -62 -75 -92 -113l134 -173c23 -29 41 -31 95 -31v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
</svg>.
Blossoming provides an elegant method to compute the B&eacute;zier control
points of the curve that represent a subset of the overall curve.</span>
</figcaption><p>


</p>
</div></div><p>


</p>
<p>More generally, the four control points for the curve segment over the range
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.302ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 1852.3 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u Subscript normal m normal i normal n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
</svg> to <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.621ex" height="2.009ex" style="vertical-align: -0.671ex;" viewBox="0 -576.1 1989.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">u Subscript normal m normal a normal x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-61" d="M483 89c0 -81 -61 -95 -82 -95c-47 0 -74 42 -78 82c-19 -47 -65 -87 -131 -87c-63 0 -160 25 -160 106c0 44 25 96 100 130c63 30 133 33 184 36v37c0 89 -57 128 -106 128c-32 0 -81 -11 -108 -46c46 -1 51 -34 51 -46c0 -26 -18 -46 -46 -46c-26 0 -46 17 -46 47 c0 66 69 113 151 113c48 0 98 -16 137 -55c36 -37 36 -76 36 -118v-200c0 -5 4 -50 37 -50c11 0 36 6 36 64v56h25v-56zM316 140v100c-165 -6 -207 -89 -207 -144c0 -50 41 -85 90 -85c45 0 117 34 117 129Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-78" d="M516 0c-30 2 -69 3 -96 3l-108 -3v31c27 1 36 16 36 25c0 6 -13 22 -21 33l-76 100c-61 -72 -90 -105 -90 -127c0 -15 7 -28 29 -31v-31l-95 3c-26 0 -57 -1 -83 -3v31c21 0 80 2 128 60c47 57 47 59 94 119l-99 129c-47 60 -48 61 -118 61v31c27 -2 74 -3 95 -3l108 3 v-31c-20 -1 -35 -10 -35 -25c0 -6 0 -8 9 -18l78 -101l62 78c5 6 15 19 15 35s-8 29 -29 31v31c13 -1 66 -3 96 -3c26 0 56 1 82 3v-31c-47 -1 -88 -16 -119 -52c-24 -26 -62 -75 -92 -113l134 -173c23 -29 41 -31 95 -31v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
</svg> are given by the blossoms:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:blossom-4-cp"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="25.229ex" height="13.843ex" style="vertical-align: -6.338ex;" viewBox="0 -3231.2 10862.3 5960" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartLayout 1st Row 1st Column normal p 0 2nd Column equals normal p Subscript Baseline left-parenthesis u Subscript normal m normal i normal n Baseline comma u Subscript normal m normal i normal n Baseline comma u Subscript normal m normal i normal n Baseline right-parenthesis 2nd Row 1st Column normal p 1 2nd Column equals normal p Subscript Baseline left-parenthesis u Subscript normal m normal i normal n Baseline comma u Subscript normal m normal i normal n Baseline comma u Subscript normal m normal a normal x Baseline right-parenthesis 3rd Row 1st Column normal p 2 2nd Column equals normal p Subscript Baseline left-parenthesis u Subscript normal m normal i normal n Baseline comma u Subscript normal m normal a normal x Baseline comma u Subscript normal m normal a normal x Baseline right-parenthesis 4th Row 1st Column normal p 3 2nd Column equals normal p Subscript Baseline left-parenthesis u Subscript normal m normal a normal x Baseline comma u Subscript normal m normal a normal x Baseline comma u Subscript normal m normal a normal x Baseline right-parenthesis EndLayout</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-61" d="M483 89c0 -81 -61 -95 -82 -95c-47 0 -74 42 -78 82c-19 -47 -65 -87 -131 -87c-63 0 -160 25 -160 106c0 44 25 96 100 130c63 30 133 33 184 36v37c0 89 -57 128 -106 128c-32 0 -81 -11 -108 -46c46 -1 51 -34 51 -46c0 -26 -18 -46 -46 -46c-26 0 -46 17 -46 47 c0 66 69 113 151 113c48 0 98 -16 137 -55c36 -37 36 -76 36 -118v-200c0 -5 4 -50 37 -50c11 0 36 6 36 64v56h25v-56zM316 140v100c-165 -6 -207 -89 -207 -144c0 -50 41 -85 90 -85c45 0 117 34 117 129Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-78" d="M516 0c-30 2 -69 3 -96 3l-108 -3v31c27 1 36 16 36 25c0 6 -13 22 -21 33l-76 100c-61 -72 -90 -105 -90 -127c0 -15 7 -28 29 -31v-31l-95 3c-26 0 -57 -1 -83 -3v31c21 0 80 2 128 60c47 57 47 59 94 119l-99 129c-47 60 -48 61 -118 61v31c27 -2 74 -3 95 -3l108 3 v-31c-20 -1 -35 -10 -35 -25c0 -6 0 -8 9 -18l78 -101l62 78c5 6 15 19 15 35s-8 29 -29 31v31c13 -1 66 -3 96 -3c26 0 56 1 82 3v-31c-47 -1 -88 -16 -119 -52c-24 -26 -62 -75 -92 -113l134 -173c23 -29 41 -31 95 -31v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(167,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,2298)">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="787" y="-213"></use>
</g>
<g transform="translate(0,749)">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="787" y="-213"></use>
</g>
<g transform="translate(0,-800)">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="787" y="-213"></use>
</g>
<g transform="translate(0,-2349)">
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33" x="787" y="-213"></use>
</g>
</g>
<g transform="translate(1277,0)">
<g transform="translate(0,2298)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1056" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1612" y="0"></use>
<g transform="translate(2002,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3854" y="0"></use>
<g transform="translate(4299,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="6152" y="0"></use>
<g transform="translate(6597,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8449" y="0"></use>
</g>
<g transform="translate(0,749)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1056" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1612" y="0"></use>
<g transform="translate(2002,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3854" y="0"></use>
<g transform="translate(4299,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="6152" y="0"></use>
<g transform="translate(6597,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8586" y="0"></use>
</g>
<g transform="translate(0,-800)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1056" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1612" y="0"></use>
<g transform="translate(2002,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="1112" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3854" y="0"></use>
<g transform="translate(4299,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="6289" y="0"></use>
<g transform="translate(6734,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8723" y="0"></use>
</g>
<g transform="translate(0,-2349)">
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1056" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1612" y="0"></use>
<g transform="translate(2002,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3991" y="0"></use>
<g transform="translate(4436,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="6426" y="0"></use>
<g transform="translate(6871,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="0" y="0"></use>
<g transform="translate(572,-150)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-61" x="833" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-78" x="1334" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="8861" y="0"></use>
</g>
</g>
</g>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:blossom-4-cp">B.18</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

(see Figure&nbsp;<a href="#fig:bezier-blossom">B.5</a>).
<tt>CubicBezierControlPoints()</tt> implements this computation.

</p>
<p></p>
<span class="anchor" id="fragment-BezierInlineFunctions-4"></span><div class="fragmentname">&lt;&lt;Bezier Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BezierInlineFunctions-3"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-BezierInlineFunctions-5"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">pstd::array&lt;<a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>, 4&gt;
<span class="anchor" id="CubicBezierControlPoints"></span>CubicBezierControlPoints(pstd::span&lt;const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>&gt; cp, Float uMin,
                         Float uMax) {
    return { BlossomCubicBezier(cp, uMin, uMin, uMin),
             BlossomCubicBezier(cp, uMin, uMin, uMax),
             BlossomCubicBezier(cp, uMin, uMax, uMax),
             BlossomCubicBezier(cp, uMax, uMax, uMax) };
}</div><p>


</p>
<p>Bounding boxes of <tt>Curve</tt>s can be efficiently computed by taking
advantage of the <em>convex hull property</em>, a property of B&eacute;zier curves
that says that they must lie within the convex hull of their control
points.  Therefore, the bounding box of the control points gives a
conservative bound of the underlying curve.  This bounding box is returned
by the <a href="#BoundCubicBezier"><tt>BoundCubicBezier()</tt></a> function.

</p>
<p></p>
<span class="anchor" id="fragment-BezierInlineFunctions-5"></span><div class="fragmentname">&lt;&lt;Bezier Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BezierInlineFunctions-4"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-BezierInlineFunctions-6"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds3f" class="code">Bounds3f</a> <span class="anchor" id="BoundCubicBezier"></span>BoundCubicBezier(pstd::span&lt;const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>&gt; cp) {
    return <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds3::Union" class="code">Union</a>(<a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds3f" class="code">Bounds3f</a>(cp[0], cp[1]), <a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds3f" class="code">Bounds3f</a>(cp[2], cp[3]));
}</div><p>


</p>
<p>A second variant of this function bounds a B&eacute;zier curve over a specified
parametric range via a call to <tt>CubicBezierControlPoints()</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-BezierInlineFunctions-6"></span><div class="fragmentname">&lt;&lt;Bezier Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-BezierInlineFunctions-5"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Bounding_Boxes.html#Bounds3f" class="code">Bounds3f</a> <a href="#BoundCubicBezier" class="code">BoundCubicBezier</a>(pstd::span&lt;const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>&gt; cp, Float uMin,
                          Float uMax) {
    if (uMin == 0 &amp;&amp; uMax == 1)
        return <a href="#BoundCubicBezier" class="code">BoundCubicBezier</a>(cp);
    auto cpSeg = <a href="#CubicBezierControlPoints" class="code">CubicBezierControlPoints</a>(cp, uMin, uMax);
    return <a href="#BoundCubicBezier" class="code">BoundCubicBezier</a>(pstd::span&lt;const <a href="../Geometry_and_Transformations/Points.html#Point3f" class="code">Point3f</a>&gt;(cpSeg));
}</div><p>


</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#Pseudo-RandomNumberGeneration"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span id="Pseudo-RandomNumberGeneration"></span><h3>B.2.14  Pseudo-Random Number Generation</h3><p>


</p>
<p><tt>pbrt</tt> uses an implementation of the PCG pseudo-random number generator
(O&rsquo;Neill&nbsp;<a href="Further_Reading.html#cite:ONeill2014">2014</a>) to generate pseudo-random numbers.  This
generator not only passes a variety of rigorous statistical tests of
randomness, but its implementation is also extremely efficient.

</p>
<p>We wrap its implementation in a small random number generator class,
<tt>RNG</tt>, which can be found in the files <a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/util/rng.h"><tt>util/rng.h</tt></a> and
<a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/util/rng.cpp"><tt>util/rng.cpp</tt></a>.  Random number generator implementation is an
esoteric art; therefore, we will not include or discuss the implementation
here but will describe the interfaces provided.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-RNGDefinition-0"></span><div class="fragmentname">&lt;&lt;RNG Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="RNG"></span>RNG {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-RNGPublicMethods-0">RNG Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2738" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2738"><i></i></a><div id="fragbit-2738" class="collapse show"><div class="fragmentcode">       <a href="#RNG" class="code">RNG</a>() : state(PCG32_DEFAULT_STATE), inc(PCG32_DEFAULT_STREAM) {}
       <a href="#RNG" class="code">RNG</a>(uint64_t seqIndex, uint64_t offset) { <a href="#RNG::SetSequence" class="code">SetSequence</a>(seqIndex, offset); }
       <a href="#RNG" class="code">RNG</a>(uint64_t seqIndex) { <a href="#RNG::SetSequence" class="code">SetSequence</a>(seqIndex); }
       void <a href="#RNG::SetSequence" class="code">SetSequence</a>(uint64_t sequenceIndex, uint64_t offset);
       void <a href="#RNG::SetSequence" class="code">SetSequence</a>(uint64_t sequenceIndex) {
           <a href="#RNG::SetSequence" class="code">SetSequence</a>(sequenceIndex, <a href="#MixBits" class="code">MixBits</a>(sequenceIndex));
       }
       template &lt;typename T&gt;
       T Uniform();
       template &lt;typename T&gt;
       typename std::enable_if_t&lt;std::is_integral_v&lt;T&gt;, T&gt; Uniform(T b) {
           T threshold = (~b + 1u) % b;
           while (true) {
               T r = Uniform&lt;T&gt;();
               if (r &gt;= threshold)
                   return r % b;
           }
       }
       void Advance(int64_t idelta);
       std::string ToString() const;</div></div>
  private:
    &lt;&lt;<span class="fragmentname">RNG Private Members</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2739" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2739"><i></i></a><div id="fragbit-2739" class="collapse show"><div class="fragmentcode">       uint64_t state, inc;</div></div>
};</div><p>


</p>
<p>The <tt>RNG</tt> class provides three constructors. The first, which takes no
arguments, sets the internal state to reasonable defaults.  The others
allow providing values that seed its state.  The PCG random number
generator actually allows the user to provide two 64-bit values to
configure its operation: one chooses from one of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 1308.3 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript 63</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-36" d="M457 204c0 -132 -95 -226 -206 -226c-93 0 -209 71 -209 338c0 221 135 350 263 350c83 0 127 -48 127 -108c0 -39 -30 -48 -46 -48c-22 0 -46 15 -46 46c0 45 40 45 55 45c-22 34 -64 40 -88 40c-51 0 -175 -36 -175 -289v-24c20 48 57 99 125 99 c111 0 200 -96 200 -223zM367 205c0 49 0 100 -18 137c-31 62 -77 62 -93 62c-90 0 -122 -100 -122 -178c0 -18 0 -98 18 -145c6 -15 36 -75 99 -75c23 0 69 5 99 65c17 36 17 86 17 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-36"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33" x="500" y="0"></use>
</g>
</g>
</svg> different
sequences of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 1308.3 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript 64</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-36" d="M457 204c0 -132 -95 -226 -206 -226c-93 0 -209 71 -209 338c0 221 135 350 263 350c83 0 127 -48 127 -108c0 -39 -30 -48 -46 -48c-22 0 -46 15 -46 46c0 45 40 45 55 45c-22 34 -64 40 -88 40c-51 0 -175 -36 -175 -289v-24c20 48 57 99 125 99 c111 0 200 -96 200 -223zM367 205c0 49 0 100 -18 137c-31 62 -77 62 -93 62c-90 0 -122 -100 -122 -178c0 -18 0 -98 18 -145c6 -15 36 -75 99 -75c23 0 69 5 99 65c17 36 17 86 17 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-36"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-34" x="500" y="0"></use>
</g>
</g>
</svg> random numbers, while the second effectively selects
a starting point within such a sequence.  Many pseudo-random number
generators only allow this second form of configuration, which alone is not
as useful: having independent non-overlapping sequences of values rather
than different starting points in a single sequence provides greater
nonuniformity in the generated values.

</p>
<p></p>
<span class="anchor" id="fragment-RNGPublicMethods-0"></span><div class="fragmentname">&lt;&lt;RNG Public Methods&gt;&gt;=&nbsp;<a href="#fragment-RNGPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="#RNG" class="code">RNG</a>() : state(PCG32_DEFAULT_STATE), inc(PCG32_DEFAULT_STREAM) {}
<a href="#RNG" class="code">RNG</a>(uint64_t seqIndex, uint64_t offset) { <a href="#RNG::SetSequence" class="code">SetSequence</a>(seqIndex, offset); }
<a href="#RNG" class="code">RNG</a>(uint64_t seqIndex) { <a href="#RNG::SetSequence" class="code">SetSequence</a>(seqIndex); }</div><p>


</p>
<p>

</p>
<p><tt>RNG</tt>s should not be used in <tt>pbrt</tt> without either providing an
initial sequence index via the constructor or a call to the
<tt>SetSequence()</tt> method; otherwise, there is risk that different parts
of the system will inadvertently use correlated sequences of pseudo-random
values, which in turn could cause surprising errors.

</p>
<p></p>
<span class="anchor" id="fragment-RNGPublicMethods-1"></span><div class="fragmentname">&lt;&lt;RNG Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-RNGPublicMethods-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RNGPublicMethods-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="RNG::SetSequence"></span><a href="#RNG::SetSequence" class="code">SetSequence</a>(uint64_t sequenceIndex, uint64_t offset);
void <a href="#RNG::SetSequence" class="code">SetSequence</a>(uint64_t sequenceIndex) {
    <a href="#RNG::SetSequence" class="code">SetSequence</a>(sequenceIndex, <a href="#MixBits" class="code">MixBits</a>(sequenceIndex));
}</div><p>


</p>
<p>The <tt>RNG</tt> class defines a template method <tt>Uniform()</tt> that
returns a uniformly distributed random value of the specified type.  A
variety of specializations of this method are provided for basic arithmetic
types.

</p>
<p></p>
<span class="anchor" id="fragment-RNGPublicMethods-2"></span><div class="fragmentname">&lt;&lt;RNG Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-RNGPublicMethods-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RNGPublicMethods-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <span class="anchor" id="RNG::Uniform"></span>Uniform();</div><p>


</p>
<p>The default implementation of <tt>Uniform()</tt> attempts to ensure that a
useful error message is issued if it is invoked with an unsupported type.

</p>
<p></p>
<span class="anchor" id="fragment-RNGInlineMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;RNG Inline Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <a href="#RNG" class="code">RNG</a>::Uniform() { return T::unimplemented; }</div><p>


</p>
<p>A specialization for <tt>uint32_t</tt> uses the PCG algorithm to generate
a 32-bit value.  We will not include its implementation here, as it would
be impenetrable without an extensive discussion of the details of the
pseudo-random number generation approach it implements.

</p>
<p></p>
<span class="anchor" id="fragment-RNGInlineMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;RNG Inline Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
uint32_t <span class="anchor" id="RNG::Uniformuint32_t"></span><a href="#RNG" class="code">RNG</a>::Uniform&lt;uint32_t&gt;();</div><p>


</p>
<p>

</p>
<p>Given a source of pseudo-randomness, a variety of other specializations of
<tt>Uniform()</tt> can be provided.  For example, a uniform 64-bit unsigned
integer can be generated by using the bits from two 32-bit random numbers.

</p>
<p></p>
<span class="anchor" id="fragment-RNGInlineMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;RNG Inline Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
uint64_t <span class="anchor" id="RNG::Uniformuint64_t"></span><a href="#RNG" class="code">RNG</a>::Uniform&lt;uint64_t&gt;() {
    uint64_t v0 = Uniform&lt;uint32_t&gt;(), v1 = Uniform&lt;uint32_t&gt;();
    return (v0 &lt;&lt; 32) | v1;
}</div><p>


</p>
<p>Generating a uniformly distributed signed 32-bit integer requires
surprisingly tricky code.  The issue is that in C++, it is undefined
behavior to assign a value to a signed integer that is larger than it can
represent.  Undefined behavior does not just mean that the result is
undefined, but that, in principle, no further guarantees are made about
correct program execution after it occurs.  Therefore, the following code
is carefully written to avoid integer overflow.  In practice, a good
compiler can be expected to optimize away the extra work.

</p>
<p></p>
<span class="anchor" id="fragment-RNGInlineMethodDefinitions-3"></span><div class="fragmentname">&lt;&lt;RNG Inline Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
int32_t <span class="anchor" id="RNG::Uniformint32_t"></span><a href="#RNG" class="code">RNG</a>::Uniform&lt;int32_t&gt;() {
    uint32_t v = Uniform&lt;uint32_t&gt;();
    if (v &lt;= (uint32_t)std::numeric_limits&lt;int32_t&gt;::max())
        return int32_t(v);
    return int32_t(v - std::numeric_limits&lt;int32_t&gt;::min()) +
           std::numeric_limits&lt;int32_t&gt;::min();
}</div><p>


</p>
<p>A similar method returns pseudo-random <tt>int64_t</tt> values.

</p>
<p>

</p>
<p>

</p>
<p>It is often useful to generate a value that is uniformly distributed
in the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.49ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3655.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma b minus 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1875" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2876" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="3377" y="0"></use>
</g>
</svg> given a bound <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.998ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 429.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="0" y="0"></use>
</g>
</svg>.  The first two versions of
<tt>pbrt</tt> effectively computed <tt>Uniform&lt;int32_t&gt;() % b</tt> to do so. That
approach is subtly flawed&mdash;in the case that <tt>b</tt> does not evenly divide
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 1308.3 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript 32</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="500" y="0"></use>
</g>
</g>
</svg>, there is higher probability of choosing any given value in
the sub-range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.694ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 7187.8 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 2 Superscript 32 Baseline normal m normal o normal d b minus 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
<g transform="translate(1224,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="500" y="0"></use>
</g>
</g>
<g transform="translate(2699,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="833" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="1334" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="4756" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="5408" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="6408" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="6909" y="0"></use>
</g>
</svg>.

</p>
<p>Therefore, the implementation here first computes the above remainder
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.201ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 3961.6 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript 32 Baseline normal m normal o normal d b</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6D" d="M813 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31 c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c45 0 119 -11 133 -98c17 38 61 98 145 98c58 0 91 -20 105 -37c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="500" y="0"></use>
</g>
<g transform="translate(1474,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-6D" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="833" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="1334" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="3532" y="0"></use>
</g>
</svg> efficiently using 32-bit arithmetic and stores it in
the variable <tt>threshold</tt>. Then, if the value returned by
<tt>Uniform()</tt> is less than <tt>threshold</tt>, it is discarded and a new
value is generated. The resulting distribution of values has a uniform
distribution after the modulus operation, giving a uniformly distributed
sample value.

</p>
<p>The tricky declaration of the return value ensures that this variant of
<tt>Uniform()</tt> is only available for integral types.

</p>
<p></p>
<span class="anchor" id="fragment-RNGPublicMethods-3"></span><div class="fragmentname">&lt;&lt;RNG Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-RNGPublicMethods-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-RNGPublicMethods-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
typename std::enable_if_t&lt;std::is_integral_v&lt;T&gt;, T&gt; Uniform(T b) {
    T threshold = (~b + 1u) % b;
    while (true) {
        T r = Uniform&lt;T&gt;();
        if (r &gt;= threshold)
            return r % b;
    }
}</div><p>


</p>
<p>A specialization of <tt>Uniform()</tt> for <tt>float</tt>s generates a
pseudo-random floating-point number in the half-open interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.91ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2114.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1724" y="0"></use>
</g>
</svg> by
multiplying a 32-bit random value by <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.317ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 1858.8 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript negative 32</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
<g transform="translate(550,0)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="500" y="0"></use>
</g>
</g>
</g>
</svg>.  Mathematically, this value
is always less than one; it can be at most <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.052ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 5619.6 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 2 Superscript 32 Baseline minus 1 right-parenthesis slash 2 Superscript 32</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
<g transform="translate(389,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="500" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1920" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="2920" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3421" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="3810" y="0"></use>
<g transform="translate(4311,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-33"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="500" y="0"></use>
</g>
</g>
</g>
</svg>.  However,
some values still round to&nbsp;1 when computed using floating-point arithmetic.
That case is handled here by clamping to the largest representable
<tt>float</tt> less than one.  Doing so introduces a tiny bias, but not one
that is meaningful for rendering applications.

</p>
<p></p>
<span class="anchor" id="fragment-RNGInlineMethodDefinitions-4"></span><div class="fragmentname">&lt;&lt;RNG Inline Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-RNGInlineMethodDefinitions-3"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
float <span class="anchor" id="RNG::UniformFloat"></span><a href="#RNG" class="code">RNG</a>::Uniform&lt;float&gt;() {
    return std::min&lt;float&gt;(<a href="../Sampling_and_Reconstruction/Sampling_Interface.html#OneMinusEpsilon" class="code">OneMinusEpsilon</a>, Uniform&lt;uint32_t&gt;() * 0x1p-32f);
}</div><p>


</p>
<p>An equivalent method for <tt>double</tt>s is provided but is not included
here.

</p>
<p>

</p>
<p>With this random number generator, it is possible to step forward or back to
a different spot in the sequence without generating all the intermediate
values.  The <tt>Advance()</tt> method provides this functionality.

</p>
<p></p>
<span class="anchor" id="fragment-RNGPublicMethods-4"></span><div class="fragmentname">&lt;&lt;RNG Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-RNGPublicMethods-3"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">void <span class="anchor" id="RNG::Advance"></span>Advance(int64_t idelta);
</div><p>


</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#IntervalArithmetic"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:interval-arithmetic"></span><span id="IntervalArithmetic"></span><h3>B.2.15  Interval Arithmetic</h3><p>



</p>
<p>Interval arithmetic is a technique that can be used to
reason about the range of a function over some range of values and also to
bound the round-off error introduced by a series of floating-point
calculations.  The <tt>Interval</tt> class provides functionality for both of
these uses.

</p>
<p>To understand the basic idea of interval arithmetic, consider, for example,
the function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.013ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4311.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis x right-parenthesis equals 2 x</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1514" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2181" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="3238" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="3738" y="0"></use>
</g>
</svg>.  If we have an interval of values <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.659ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 4158.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket subset-of bold upper R Superscript</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2282" d="M693 -23c0 -11 -9 -20 -20 -20h-295c-162 0 -293 131 -293 293s131 293 293 293h295c11 0 20 -9 20 -20s-9 -20 -20 -20h-295c-140 0 -253 -113 -253 -253s113 -253 253 -253h295c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D411" d="M858 95c0 -16 -13 -106 -120 -106c-41 0 -103 4 -147 26c-70 34 -70 83 -70 149c0 73 0 92 -32 127c-31 34 -75 34 -89 34h-117v-278h108v-47c-36 3 -134 3 -176 3s-140 0 -176 -3v47h108v592h-108v47h380c188 0 298 -84 298 -185c0 -66 -51 -131 -167 -161 c43 -16 98 -47 112 -117c1 -5 9 -74 11 -85c5 -42 14 -113 74 -113c30 0 59 22 64 69c1 13 2 23 23 23c10 0 24 0 24 -22zM564 500c0 61 -2 139 -163 139h-118v-278h116c165 0 165 83 165 139Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2282" x="2238" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D411" x="3295" y="0"></use>
</g>
</svg>, then we can see that, over the interval, the range of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg> is the
interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.88ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2962.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 2 a comma 2 b right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1308" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1753" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="2254" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2683" y="0"></use>
</g>
</svg>.  In other words, <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.626ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 7588.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis left-bracket a comma b right-bracket right-parenthesis subset-of left-bracket 2 a comma 2 b right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2282" d="M693 -23c0 -11 -9 -20 -20 -20h-295c-162 0 -293 131 -293 293s131 293 293 293h295c11 0 20 -9 20 -20s-9 -20 -20 -20h-295c-140 0 -253 -113 -253 -253s113 -253 253 -253h295c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="1220" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1750" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="2195" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2624" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2903" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2282" x="3570" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="4626" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="4905" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="5405" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5935" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="6380" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="6880" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="7310" y="0"></use>
</g>
</svg>.  More
generally, all the basic operations of arithmetic have <em>interval
extensions</em> that describe how they operate on intervals of values.  For
example, given two intervals <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.555ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1961.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.543ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1956.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket c comma d right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="712" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1157" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1677" y="0"></use>
</g>
</svg>,
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.136ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 12113.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket plus left-bracket c comma d right-bracket subset-of left-bracket a plus c comma b plus d right-bracket period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2282" d="M693 -23c0 -11 -9 -20 -20 -20h-295c-162 0 -293 131 -293 293s131 293 293 293h295c11 0 20 -9 20 -20s-9 -20 -20 -20h-295c-140 0 -253 -113 -253 -253s113 -253 253 -253h295c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="2183" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="3184" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3462" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3896" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="4341" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="4861" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2282" x="5418" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="6474" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="6752" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="7504" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="8505" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="8938" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="9383" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="10035" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="11036" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="11556" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11835" y="0"></use>
</g>
</svg>
</div>
<p>

In other words, if we add together two values where one is in the range
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.555ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1961.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
</g>
</svg> and the second is in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.543ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1956.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket c comma d right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="712" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1157" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1677" y="0"></use>
</g>
</svg>, then the result must be in the range
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.452ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 5361.1 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a plus c comma b plus d right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="1030" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="2030" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2464" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="2909" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="3561" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="4562" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="5082" y="0"></use>
</g>
</svg>.
Interval arithmetic has the important property that the intervals that it
gives are conservative.  For example, if <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.289ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 6582.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f left-parenthesis left-bracket a comma b right-bracket right-parenthesis subset-of left-bracket c comma d right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2282" d="M693 -23c0 -11 -9 -20 -20 -20h-295c-162 0 -293 131 -293 293s131 293 293 293h295c11 0 20 -9 20 -20s-9 -20 -20 -20h-295c-140 0 -253 -113 -253 -253s113 -253 253 -253h295c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="942" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="1220" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1750" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="2195" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2624" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2903" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2282" x="3570" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="4626" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="4905" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5338" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="5783" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="6304" y="0"></use>
</g>
</svg> and if
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.268ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2268.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">c greater-than 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3E" d="M688 230l-581 -275c-25 -11 -42 25 -18 36l548 259l-548 259c-24 11 -7 47 18 36l581 -275c17 -8 17 -32 0 -40Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3E" x="711" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1767" y="0"></use>
</g>
</svg>, then we know for sure that no value in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.555ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1961.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
</g>
</svg> causes <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg> to be
negative.  

</p>
<p>When implemented in floating-point arithmetic, interval operations can be
defined so that they result in intervals that bound the true value.  Given
a function <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.659ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 5450.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper R normal o normal u normal n normal d normal upper D normal o normal w normal n</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-52" d="M732 88c0 -28 -17 -110 -95 -110c-30 0 -85 6 -126 42c-41 38 -41 78 -41 143c0 67 0 98 -38 134c-35 34 -77 34 -93 34h-115v-253c0 -36 2 -47 79 -47h24v-31c-36 3 -107 3 -146 3s-110 0 -146 -3v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31h314 c147 0 261 -84 261 -180c0 -78 -78 -139 -175 -163c55 -19 104 -52 122 -116l13 -80c14 -93 22 -144 71 -144c25 0 60 18 66 89c1 7 1 16 12 16c13 0 13 -11 13 -17zM507 503c0 145 -112 149 -202 149c-20 0 -49 0 -59 -2c-22 -3 -22 -15 -22 -38v-259h111 c148 0 172 81 172 150Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-75" d="M535 0l-144 -11v90c-29 -62 -73 -90 -129 -90c-152 0 -152 91 -152 169v150c0 89 0 92 -78 92v31l147 11v-332c0 -52 4 -99 88 -99c73 0 121 68 121 155v178c0 49 -8 56 -78 56v31l147 11v-355c0 -49 8 -56 78 -56v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-44" d="M707 336c0 -188 -138 -336 -306 -336h-366v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31h366c171 0 306 -157 306 -347zM607 336c0 78 -9 164 -52 223c-51 71 -120 93 -182 93h-100c-47 0 -49 -7 -49 -40v-541c0 -33 2 -40 49 -40h101c101 0 158 58 178 85 c36 49 55 109 55 220Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-77" d="M703 400c-35 -1 -66 -14 -84 -64l-117 -328c-4 -10 -7 -19 -20 -19s-16 8 -20 19l-102 284l-101 -283c-5 -14 -7 -20 -20 -20s-16 8 -21 22l-126 354c-12 32 -24 35 -74 35v31l93 -3l109 3v-31c-20 0 -59 0 -59 -27c0 -4 0 -6 5 -18l95 -267l86 242c-7 19 -18 49 -23 55 c-10 13 -26 15 -63 15v31c30 -2 59 -3 89 -3l104 3v-31c-20 0 -59 0 -59 -27c0 -5 1 -7 5 -19l99 -279l91 256c5 13 5 15 5 21c0 29 -22 47 -58 48v31l93 -3c22 0 51 1 73 3v-31Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-52" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="736" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-75" x="1237" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="1793" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2350" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-44" x="2906" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="3671" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-77" x="4171" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="4894" y="0"></use>
</g>
</svg> that rounds a value that cannot exactly be
represented as a floating-point value down to the next lower floating-point
value and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.786ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 4213.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal upper R normal o normal u normal n normal d normal upper U normal p</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-52" d="M732 88c0 -28 -17 -110 -95 -110c-30 0 -85 6 -126 42c-41 38 -41 78 -41 143c0 67 0 98 -38 134c-35 34 -77 34 -93 34h-115v-253c0 -36 2 -47 79 -47h24v-31c-36 3 -107 3 -146 3s-110 0 -146 -3v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31h314 c147 0 261 -84 261 -180c0 -78 -78 -139 -175 -163c55 -19 104 -52 122 -116l13 -80c14 -93 22 -144 71 -144c25 0 60 18 66 89c1 7 1 16 12 16c13 0 13 -11 13 -17zM507 503c0 145 -112 149 -202 149c-20 0 -49 0 -59 -2c-22 -3 -22 -15 -22 -38v-259h111 c148 0 172 81 172 150Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-75" d="M535 0l-144 -11v90c-29 -62 -73 -90 -129 -90c-152 0 -152 91 -152 169v150c0 89 0 92 -78 92v31l147 11v-332c0 -52 4 -99 88 -99c73 0 121 68 121 155v178c0 49 -8 56 -78 56v31l147 11v-355c0 -49 8 -56 78 -56v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-55" d="M716 652c-103 0 -103 -45 -103 -78v-320c0 -40 0 -49 -3 -69c-17 -114 -107 -207 -222 -207c-136 0 -252 109 -252 250v377c0 36 -2 47 -79 47h-24v31c35 -3 110 -3 148 -3s112 0 147 3v-31h-24c-77 0 -79 -11 -79 -47v-381c0 -190 118 -215 165 -215 c95 0 192 80 192 222v347c0 27 0 74 -103 74v31l119 -3l118 3v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-52" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="736" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-75" x="1237" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="1793" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2350" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-55" x="2906" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="3657" y="0"></use>
</g>
</svg> that similarly rounds up, interval addition can be
defined&nbsp;as
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="eq:interval-fp-addition"></span><div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="54.209ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 23339.9 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket a comma b right-bracket circled-plus left-bracket c comma d right-bracket subset-of left-bracket normal upper R normal o normal u normal n normal d normal upper D normal o normal w normal n left-parenthesis a plus c right-parenthesis comma normal upper R normal o normal u normal n normal d normal upper U normal p left-parenthesis c plus d right-parenthesis right-bracket period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44E" d="M498 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293c45 0 74 -27 92 -64c3 22 18 44 42 44c17 0 29 -10 29 -27c0 -4 0 -6 -7 -34l-36 -140l-22 -90 c-11 -44 -13 -52 -13 -74c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D44F" d="M415 282c0 -144 -123 -293 -241 -293c-74 0 -127 62 -127 157c0 35 4 51 16 101l82 326c5 21 14 55 14 62c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 18 11 19 19 20c26 2 99 10 122 10c13 0 13 -11 13 -11l-74 -301c30 31 71 60 117 60c80 0 133 -69 133 -160zM343 326 c0 64 -27 94 -63 94c-26 0 -71 -15 -120 -80c-9 -11 -9 -13 -15 -35l-22 -92c-16 -63 -16 -82 -16 -101c0 -74 33 -101 67 -101c39 0 85 36 118 103c18 38 51 153 51 212Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2295" d="M690 270c-10 151 -130 271 -281 281v-281h281zM369 270v281c-151 -10 -271 -130 -281 -281h281zM369 -51v281h-281c10 -151 130 -271 281 -281zM690 230h-281v-281c151 10 271 130 281 281zM731 250c0 -189 -153 -342 -342 -342s-342 153 -342 342s153 342 342 342 s342 -153 342 -342Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D450" d="M430 107c0 -12 -84 -118 -227 -118c-104 0 -162 79 -162 169c0 141 133 284 268 284c71 0 118 -37 118 -86c0 -40 -27 -64 -56 -64c-19 0 -37 11 -37 35c0 7 2 24 18 39c14 14 28 14 44 14c-14 27 -52 40 -86 40c-55 0 -110 -43 -141 -100c-34 -62 -54 -159 -54 -200 c0 -60 27 -109 90 -109c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2282" d="M693 -23c0 -11 -9 -20 -20 -20h-295c-162 0 -293 131 -293 293s131 293 293 293h295c11 0 20 -9 20 -20s-9 -20 -20 -20h-295c-140 0 -253 -113 -253 -253s113 -253 253 -253h295c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-52" d="M732 88c0 -28 -17 -110 -95 -110c-30 0 -85 6 -126 42c-41 38 -41 78 -41 143c0 67 0 98 -38 134c-35 34 -77 34 -93 34h-115v-253c0 -36 2 -47 79 -47h24v-31c-36 3 -107 3 -146 3s-110 0 -146 -3v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31h314 c147 0 261 -84 261 -180c0 -78 -78 -139 -175 -163c55 -19 104 -52 122 -116l13 -80c14 -93 22 -144 71 -144c25 0 60 18 66 89c1 7 1 16 12 16c13 0 13 -11 13 -17zM507 503c0 145 -112 149 -202 149c-20 0 -49 0 -59 -2c-22 -3 -22 -15 -22 -38v-259h111 c148 0 172 81 172 150Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-75" d="M535 0l-144 -11v90c-29 -62 -73 -90 -129 -90c-152 0 -152 91 -152 169v150c0 89 0 92 -78 92v31l147 11v-332c0 -52 4 -99 88 -99c73 0 121 68 121 155v178c0 49 -8 56 -78 56v31l147 11v-355c0 -49 8 -56 78 -56v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-44" d="M707 336c0 -188 -138 -336 -306 -336h-366v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31h366c171 0 306 -157 306 -347zM607 336c0 78 -9 164 -52 223c-51 71 -120 93 -182 93h-100c-47 0 -49 -7 -49 -40v-541c0 -33 2 -40 49 -40h101c101 0 158 58 178 85 c36 49 55 109 55 220Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-77" d="M703 400c-35 -1 -66 -14 -84 -64l-117 -328c-4 -10 -7 -19 -20 -19s-16 8 -20 19l-102 284l-101 -283c-5 -14 -7 -20 -20 -20s-16 8 -21 22l-126 354c-12 32 -24 35 -74 35v31l93 -3l109 3v-31c-20 0 -59 0 -59 -27c0 -4 0 -6 5 -18l95 -267l86 242c-7 19 -18 49 -23 55 c-10 13 -26 15 -63 15v31c30 -2 59 -3 89 -3l104 3v-31c-20 0 -59 0 -59 -27c0 -5 1 -7 5 -19l99 -279l91 256c5 13 5 15 5 21c0 29 -22 47 -58 48v31l93 -3c22 0 51 1 73 3v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-55" d="M716 652c-103 0 -103 -45 -103 -78v-320c0 -40 0 -49 -3 -69c-17 -114 -107 -207 -222 -207c-136 0 -252 109 -252 250v377c0 36 -2 47 -79 47h-24v31c35 -3 110 -3 148 -3s112 0 147 3v-31h-24c-77 0 -79 -11 -79 -47v-381c0 -190 118 -215 165 -215 c95 0 192 80 192 222v347c0 27 0 74 -103 74v31l119 -3l118 3v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="808" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44F" x="1253" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1682" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2295" x="2183" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="3184" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="3462" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="3896" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="4341" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="4861" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2282" x="5418" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="6474" y="0"></use>
<g transform="translate(6752,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-52" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="736" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-75" x="1237" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="1793" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2350" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-44" x="2906" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="3671" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-77" x="4171" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="4894" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="12203" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D44E" x="12592" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="13344" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="14345" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="14778" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="15168" y="0"></use>
<g transform="translate(15613,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-52" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="736" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-75" x="1237" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-6E" x="1793" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-64" x="2350" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-55" x="2906" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-70" x="3657" y="0"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="19826" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D450" x="20216" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="20872" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D451" x="21872" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="22393" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="22782" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="23061" y="0"></use>
</g>
</svg>
</div>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">
<div class="eqno">(<a href="#eq:interval-fp-addition">B.18</a>)</div>
</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<p>

Performing a series of floating-point calculations in this manner is the
basis of running error analysis, which was described in
Section&nbsp;<a href="../Shapes/Managing_Rounding_Error.html#sec:ieee-fp">6.8.1</a>.

</p>
<p><tt>pbrt</tt> uses interval arithmetic to
compute error bounds for ray intersections with quadrics and also uses the
interval-based <tt>Point3i</tt> class to store computed ray intersection
points on surfaces.
The zero-finding method used to find the
extrema of moving bounding boxes in
<tt>AnimatedTransform::BoundPointMotion()</tt> (included
in the online edition) is also based on interval arithmetic.

</p>
<p>The <tt>Interval</tt> class provides interval arithmetic capabilities using
operator overloading to make it fairly easy to switch existing regular
floating-point computations over to be interval-based.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalDefinition-0"></span><div class="fragmentname">&lt;&lt;Interval Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="Interval"></span>Interval {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-IntervalPublicMethods-0">Interval Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2740" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2740"><i></i></a><div id="fragbit-2740" class="collapse show"><div class="fragmentcode">       explicit Interval(Float v) : <a href="#Interval::low" class="code">low</a>(v), <a href="#Interval::high" class="code">high</a>(v) {}
       Interval(Float <a href="#Interval::low" class="code">low</a>, Float <a href="#Interval::high" class="code">high</a>)
           : <a href="#Interval::low" class="code">low</a>(std::min(<a href="#Interval::low" class="code">low</a>, <a href="#Interval::high" class="code">high</a>)), <a href="#Interval::high" class="code">high</a>(std::max(<a href="#Interval::low" class="code">low</a>, <a href="#Interval::high" class="code">high</a>)) {}
       static Interval FromValueAndError(Float v, Float err) {
           Interval i;
           if (err == 0)
               i.<a href="#Interval::low" class="code">low</a> = i.<a href="#Interval::high" class="code">high</a> = v;
           else {
               i.<a href="#Interval::low" class="code">low</a> = SubRoundDown(v, err);
               i.<a href="#Interval::high" class="code">high</a> = <a href="#AddRoundUp" class="code">AddRoundUp</a>(v, err);
           }
           return i;
       }
       PBRT_CPU_GPU
       Interval &amp;operator=(Float v) {
           <a href="#Interval::low" class="code">low</a> = <a href="#Interval::high" class="code">high</a> = v;
           return *this;
       }
       Float UpperBound() const { return <a href="#Interval::high" class="code">high</a>; }
       Float LowerBound() const { return <a href="#Interval::low" class="code">low</a>; }
       Float <a href="#Interval::Midpoint" class="code">Midpoint</a>() const { return (<a href="#Interval::low" class="code">low</a> + <a href="#Interval::high" class="code">high</a>) / 2; }
       Float Width() const { return <a href="#Interval::high" class="code">high</a> - <a href="#Interval::low" class="code">low</a>; }
       Float operator[](int i) const {
           return (i == 0) ? <a href="#Interval::low" class="code">low</a> : <a href="#Interval::high" class="code">high</a>;
       }
       explicit operator Float() const { return <a href="#Interval::Midpoint" class="code">Midpoint</a>(); }
       bool Exactly(Float v) const { return <a href="#Interval::low" class="code">low</a> == v &amp;&amp; <a href="#Interval::high" class="code">high</a> == v; }
       PBRT_CPU_GPU
       bool operator==(Float v) const { return Exactly(v); }
       Interval operator-() const { return {-<a href="#Interval::high" class="code">high</a>, -<a href="#Interval::low" class="code">low</a>}; }
       Interval operator+(Interval i) const {
           return {<a href="#AddRoundDown" class="code">AddRoundDown</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::low" class="code">low</a>), <a href="#AddRoundUp" class="code">AddRoundUp</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::high" class="code">high</a>)};
       }
       PBRT_CPU_GPU
       Interval operator-(Interval i) const {
           return {SubRoundDown(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::high" class="code">high</a>), SubRoundUp(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::low" class="code">low</a>)};
       }
       Interval operator*(Interval i) const {
           Float lp[4] = { <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::low" class="code">low</a>),  <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::low" class="code">low</a>),
                           <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::high" class="code">high</a>), <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::high" class="code">high</a>)};
           Float hp[4] = { <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::low" class="code">low</a>),  <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::low" class="code">low</a>),
                           <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::high" class="code">high</a>), <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::high" class="code">high</a>)};
           return {std::min({lp[0], lp[1], lp[2], lp[3]}),
                   std::max({hp[0], hp[1], hp[2], hp[3]})};
       }
       PBRT_CPU_GPU
       Interval operator/(Interval i) const;
       PBRT_CPU_GPU bool operator==(Interval i) const {
           return <a href="#Interval::low" class="code">low</a> == i.<a href="#Interval::low" class="code">low</a> &amp;&amp; <a href="#Interval::high" class="code">high</a> == i.<a href="#Interval::high" class="code">high</a>;
       }
       PBRT_CPU_GPU
       bool operator!=(Float f) const { return f &lt; <a href="#Interval::low" class="code">low</a> || f &gt; <a href="#Interval::high" class="code">high</a>; }
       std::string ToString() const;
       PBRT_CPU_GPU Interval &amp;operator+=(Interval i) {
           *this = Interval(*this + i);
           return *this;
       }
       PBRT_CPU_GPU Interval &amp;operator-=(Interval i) {
           *this = Interval(*this - i);
           return *this;
       }
       PBRT_CPU_GPU Interval &amp;operator*=(Interval i) {
           *this = Interval(*this * i);
           return *this;
       }
       PBRT_CPU_GPU Interval &amp;operator/=(Interval i) {
           *this = Interval(*this / i);
           return *this;
       }
       PBRT_CPU_GPU
       Interval &amp;operator+=(Float f) { return *this += Interval(f); }
       PBRT_CPU_GPU
       Interval &amp;operator-=(Float f) { return *this -= Interval(f); }
       PBRT_CPU_GPU
       Interval &amp;operator*=(Float f) {
           if (f &gt; 0)
               *this = Interval(<a href="#MulRoundDown" class="code">MulRoundDown</a>(f, <a href="#Interval::low" class="code">low</a>), <a href="#MulRoundUp" class="code">MulRoundUp</a>(f, <a href="#Interval::high" class="code">high</a>));
           else
               *this = Interval(<a href="#MulRoundDown" class="code">MulRoundDown</a>(f, <a href="#Interval::high" class="code">high</a>), <a href="#MulRoundUp" class="code">MulRoundUp</a>(f, <a href="#Interval::low" class="code">low</a>));
           return *this;
       }
       PBRT_CPU_GPU
       Interval &amp;operator/=(Float f) {
          if (f &gt; 0) *this = Interval(DivRoundDown(<a href="#Interval::low" class="code">low</a>, f), DivRoundUp(<a href="#Interval::high" class="code">high</a>, f));
          else *this = Interval(DivRoundDown(<a href="#Interval::high" class="code">high</a>, f), DivRoundUp(<a href="#Interval::low" class="code">low</a>, f));
          return *this;
       }
       #ifndef PBRT_IS_GPU_CODE
       static const Interval Pi;
       #endif</div></div>
  private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-IntervalPrivateMembers-0">Interval Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2741" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2741"><i></i></a><div id="fragbit-2741" class="collapse show"><div class="fragmentcode">       Float low, high;</div></div>
};</div><p>


</p>
<p>Before we go further with <tt>Interval</tt>, we will define some supporting
utility functions for performing basic arithmetic with specified rounding.
Recall that the default with floating-point arithmetic is that results are
rounded to the nearest representable floating-point value, with ties being
rounded to the nearest even value (i.e., with a zero-valued low bit in its
significand).  However, in order to compute conservative intervals like
those in Equation&nbsp;(<a href="#eq:interval-fp-addition">B.18</a>), it is necessary to
specify different rounding modes for different operations, rounding down
when computing the value at the lower range of the interval and rounding up
at the upper range.

</p>
<p>The IEEE floating-point standard requires capabilities to control the
rounding mode, but unfortunately it is expensive to change it on modern
CPUs.  Doing so generally requires a flush of the execution pipeline, which
may cost many tens of cycles.  Therefore, <tt>pbrt</tt> provides utility
functions that perform various arithmetic operations where the final value is
then nudged up or down to the next representable float. This will lead
to intervals that are slightly too large, sometimes nudging when it is not
necessary, but for <tt>pbrt</tt>&rsquo;s purposes it is
preferable to paying the cost of changing the rounding mode.

</p>
<p>Some GPUs provide intrinsic functions to perform these various operations
directly, with the rounding mode specified as part of the instruction and
with no performance cost.
Alternative implementations of these functions, not included here, use
those when they are available.

</p>
<p></p>
<span class="anchor" id="fragment-Floating-pointInlineFunctions-13"></span><div class="fragmentname">&lt;&lt;Floating-point Inline Functions&gt;&gt;+=&nbsp;<a href="../Shapes/Managing_Rounding_Error.html#fragment-Floating-pointInlineFunctions-12"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="AddRoundUp"></span>AddRoundUp(Float a, Float b) {
    return <a href="../Shapes/Managing_Rounding_Error.html#NextFloatUp" class="code">NextFloatUp</a>(a + b);
}
Float <span class="anchor" id="AddRoundDown"></span>AddRoundDown(Float a, Float b) {
    return <a href="../Shapes/Managing_Rounding_Error.html#NextFloatDown" class="code">NextFloatDown</a>(a + b);
}</div><p>


</p>
<p>Beyond addition, there are equivalent methods that are not included here
for subtraction, multiplication, division, the square root, and
FMA.<span class="anchor" id="MulRoundUp"></span><span class="anchor" id="MulRoundDown"></span><span class="anchor" id="DivRoundUp"></span><span class="anchor" id="DivRoundDown"></span><span class="anchor" id="SqrtRoundUp"></span><span class="anchor" id="SqrtRoundDown"></span><span class="anchor" id="FMARoundUp"></span><span class="anchor" id="FMARoundDown"></span>

</p>
<p>

</p>
<p>An interval can be initialized with a single value or a pair of values that
specify an interval with nonzero width.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalPublicMethods-0"></span><div class="fragmentname">&lt;&lt;Interval Public Methods&gt;&gt;=&nbsp;<a href="#fragment-IntervalPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">explicit Interval(Float v) : <a href="#Interval::low" class="code">low</a>(v), <a href="#Interval::high" class="code">high</a>(v) {}
Interval(Float <a href="#Interval::low" class="code">low</a>, Float <a href="#Interval::high" class="code">high</a>)
    : <a href="#Interval::low" class="code">low</a>(std::min(<a href="#Interval::low" class="code">low</a>, <a href="#Interval::high" class="code">high</a>)), <a href="#Interval::high" class="code">high</a>(std::max(<a href="#Interval::low" class="code">low</a>, <a href="#Interval::high" class="code">high</a>)) {}</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-IntervalPrivateMembers-0"></span><div class="fragmentname">&lt;&lt;Interval Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float <span class="anchor" id="Interval::low"></span>low, <span class="anchor" id="Interval::high"></span>high;</div><p>


</p>
<p>It can also be specified by a value and an error bound.  Note that the
implementation uses rounded arithmetic functions to ensure a
conservative interval.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalPublicMethods-1"></span><div class="fragmentname">&lt;&lt;Interval Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-IntervalPublicMethods-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-IntervalPublicMethods-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">static Interval <span class="anchor" id="Interval::FromValueAndError"></span>FromValueAndError(Float v, Float err) {
    Interval i;
    if (err == 0)
        i.<a href="#Interval::low" class="code">low</a> = i.<a href="#Interval::high" class="code">high</a> = v;
    else {
        i.<a href="#Interval::low" class="code">low</a> = SubRoundDown(v, err);
        i.<a href="#Interval::high" class="code">high</a> = AddRoundUp(v, err);
    }
    return i;
}</div><p>


</p>
<p>

</p>
<p>A number of accessor methods provide information about the interval.  An
implementation of <tt>operator[]</tt>, not included here, allows indexing the
two bounding values.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalPublicMethods-2"></span><div class="fragmentname">&lt;&lt;Interval Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-IntervalPublicMethods-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-IntervalPublicMethods-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Float <span class="anchor" id="Interval::UpperBound"></span>UpperBound() const { return <a href="#Interval::high" class="code">high</a>; }
Float <span class="anchor" id="Interval::LowerBound"></span>LowerBound() const { return <a href="#Interval::low" class="code">low</a>; }
Float <span class="anchor" id="Interval::Midpoint"></span>Midpoint() const { return (<a href="#Interval::low" class="code">low</a> + <a href="#Interval::high" class="code">high</a>) / 2; }
Float <span class="anchor" id="Interval::Width"></span>Width() const { return <a href="#Interval::high" class="code">high</a> - <a href="#Interval::low" class="code">low</a>; }</div><p>


</p>
<p>

</p>
<p>An interval can be converted to a <tt>Float</tt> approximation to it, but
only through an explicit cast, which ensures that intervals are not
accidentally reduced to <tt>Float</tt>s in the middle of a computation, thus
causing an inaccurate final interval.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalPublicMethods-3"></span><div class="fragmentname">&lt;&lt;Interval Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-IntervalPublicMethods-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-IntervalPublicMethods-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">explicit operator Float() const { return <a href="#Interval::Midpoint" class="code">Midpoint</a>(); }</div><p>


</p>
<p>

</p>
<p><tt>InRange()</tt> method implementations check whether a given value is in
the interval and whether two intervals overlap.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalInlineFunctions-0"></span><div class="fragmentname">&lt;&lt;Interval Inline Functions&gt;&gt;=&nbsp;<a href="#fragment-IntervalInlineFunctions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">bool <span class="anchor" id="Interval::InRange"></span>InRange(Float v, Interval i) {
    return v &gt;= i.<a href="#Interval::LowerBound" class="code">LowerBound</a>() &amp;&amp; v &lt;= i.<a href="#Interval::UpperBound" class="code">UpperBound</a>();
}
bool InRange(Interval a, Interval b) {
    return a.<a href="#Interval::LowerBound" class="code">LowerBound</a>() &lt;= b.<a href="#Interval::UpperBound" class="code">UpperBound</a>() &amp;&amp;
           a.<a href="#Interval::UpperBound" class="code">UpperBound</a>() &gt;= b.<a href="#Interval::LowerBound" class="code">LowerBound</a>();
}</div><p>


</p>
<p>

</p>
<p>Negation of an interval is straightforward, as it does not require any
rounding.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalPublicMethods-4"></span><div class="fragmentname">&lt;&lt;Interval Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-IntervalPublicMethods-3"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-IntervalPublicMethods-5"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Interval operator-() const { return {-<a href="#Interval::high" class="code">high</a>, -<a href="#Interval::low" class="code">low</a>}; }</div><p>


</p>
<p>The addition operator just requires implementing
Equation&nbsp;(<a href="#eq:interval-fp-addition">B.18</a>) with the appropriate rounding.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalPublicMethods-5"></span><div class="fragmentname">&lt;&lt;Interval Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-IntervalPublicMethods-4"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-IntervalPublicMethods-6"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Interval operator+(Interval i) const {
    return {<a href="#AddRoundDown" class="code">AddRoundDown</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::low" class="code">low</a>), <a href="#AddRoundUp" class="code">AddRoundUp</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::high" class="code">high</a>)};
}</div><p>


</p>
<p>The subtraction operator and the <tt>+=</tt> and <tt>-=</tt> operators follow
the same pattern, so they are not included in the text.

</p>
<p>

</p>
<p>Interval multiplication and division are slightly more involved: which of
the <tt>low</tt> and <tt>high</tt> bounds of each of the two intervals is used
to determine each of the bounds of the result depends on the signs of
the values involved.  Rather than incur the overhead of working out exactly
which pairs to use, <a href="#Interval"><tt>Interval</tt></a>&rsquo;s implementation of the multiply
operator computes all of them and then takes the minimum and maximum.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalPublicMethods-6"></span><div class="fragmentname">&lt;&lt;Interval Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-IntervalPublicMethods-5"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Interval operator*(Interval i) const {
    Float lp[4] = { <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::low" class="code">low</a>),  <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::low" class="code">low</a>),
                    <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::high" class="code">high</a>), <a href="#MulRoundDown" class="code">MulRoundDown</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::high" class="code">high</a>)};
    Float hp[4] = { <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::low" class="code">low</a>),  <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::low" class="code">low</a>),
                    <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::low" class="code">low</a>, i.<a href="#Interval::high" class="code">high</a>), <a href="#MulRoundUp" class="code">MulRoundUp</a>(<a href="#Interval::high" class="code">high</a>, i.<a href="#Interval::high" class="code">high</a>)};
    return {std::min({lp[0], lp[1], lp[2], lp[3]}),
            std::max({hp[0], hp[1], hp[2], hp[3]})};
}</div><p>


</p>
<p>The division operator follows a similar form, though it must check to see
if the divisor interval spans zero.  If so, an infinite interval must be
returned.

</p>
<p>

</p>
<p>The interval <tt>Sqr()</tt> function is more than a shorthand; it is
sometimes able to compute a tighter bound than would be found by
multiplying an interval by itself using <tt>operator*</tt>.  To see why,
consider two independent intervals that both happen to have the range <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.461ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2781.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket negative 2 comma 3 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1057" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1557" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="2002" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2503" y="0"></use>
</g>
</svg>.  Multiplying them together results in the interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.461ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2781.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket negative 6 comma 9 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-36" d="M457 204c0 -132 -95 -226 -206 -226c-93 0 -209 71 -209 338c0 221 135 350 263 350c83 0 127 -48 127 -108c0 -39 -30 -48 -46 -48c-22 0 -46 15 -46 46c0 45 40 45 55 45c-22 34 -64 40 -88 40c-51 0 -175 -36 -175 -289v-24c20 48 57 99 125 99 c111 0 200 -96 200 -223zM367 205c0 49 0 100 -18 137c-31 62 -77 62 -93 62c-90 0 -122 -100 -122 -178c0 -18 0 -98 18 -145c6 -15 36 -75 99 -75c23 0 69 5 99 65c17 36 17 86 17 134Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-39" d="M457 329c0 -215 -122 -351 -251 -351c-85 0 -139 41 -139 108c0 39 30 48 46 48c22 0 46 -15 46 -46c0 -17 -8 -46 -52 -46c27 -34 81 -36 98 -36c58 0 162 46 162 280v32c-23 -58 -64 -100 -125 -100c-112 0 -200 98 -200 223c0 75 23 117 64 162c43 45 92 63 147 63 c89 0 204 -68 204 -337zM365 421c0 46 -4 109 -16 141c-17 45 -50 79 -96 79c-35 0 -73 -13 -100 -63c-21 -37 -21 -84 -21 -138c0 -49 0 -99 18 -136c31 -63 77 -63 93 -63c88 0 122 97 122 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-36" x="1057" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1557" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-39" x="2002" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2503" y="0"></use>
</g>
</svg>.
However, if we are multiplying an interval by itself, we know that there is
no way that squaring it would result in a negative value.  Therefore, if an
interval with the bounds <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.461ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2781.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket negative 2 comma 3 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1057" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1557" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="2002" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2503" y="0"></use>
</g>
</svg> is multiplied by itself, it is possible to
return the tighter interval <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 9 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-39" d="M457 329c0 -215 -122 -351 -251 -351c-85 0 -139 41 -139 108c0 39 30 48 46 48c22 0 46 -15 46 -46c0 -17 -8 -46 -52 -46c27 -34 81 -36 98 -36c58 0 162 46 162 280v32c-23 -58 -64 -100 -125 -100c-112 0 -200 98 -200 223c0 75 23 117 64 162c43 45 92 63 147 63 c89 0 204 -68 204 -337zM365 421c0 46 -4 109 -16 141c-17 45 -50 79 -96 79c-35 0 -73 -13 -100 -63c-21 -37 -21 -84 -21 -138c0 -49 0 -99 18 -136c31 -63 77 -63 93 -63c88 0 122 97 122 180Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-39" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg> instead.

</p>
<p></p>
<span class="anchor" id="fragment-IntervalInlineFunctions-1"></span><div class="fragmentname">&lt;&lt;Interval Inline Functions&gt;&gt;+=&nbsp;<a href="#fragment-IntervalInlineFunctions-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">Interval <span class="anchor" id="Interval::Sqr"></span>Sqr(Interval i) {
    Float alow = std::abs(i.<a href="#Interval::LowerBound" class="code">LowerBound</a>()), ahigh = std::abs(i.<a href="#Interval::UpperBound" class="code">UpperBound</a>());
    if (alow &gt; ahigh)
        pstd::swap(alow, ahigh);
    if (<a href="#Interval::InRange" class="code">InRange</a>(0, i))
        return Interval(0, <a href="#MulRoundUp" class="code">MulRoundUp</a>(ahigh, ahigh));
    return Interval(<a href="#MulRoundDown" class="code">MulRoundDown</a>(alow, alow), <a href="#MulRoundUp" class="code">MulRoundUp</a>(ahigh, ahigh));
}</div><p>


</p>
<p>

</p>
<p>A variety of additional arithmetic operations are provided by the
<tt>Interval</tt> class, including
<tt>Abs()</tt><span class="anchor" id="Interval::Abs"></span>,
<tt>Min()</tt><span class="anchor" id="Interval::Min"></span>,
<tt>Max()</tt><span class="anchor" id="Interval::Max"></span>,
<tt>Sqrt()</tt><span class="anchor" id="Interval::Sqrt"></span>,
<tt>Floor()</tt><span class="anchor" id="Interval::Floor"></span>,
<tt>Ceil()</tt><span class="anchor" id="Interval::Ceil"></span>, 
<tt>Quadratic()</tt><span class="anchor" id="Interval::Quadratic"></span>, and assorted
trigonometric
functions<span class="anchor" id="Interval::Sin"></span><span class="anchor" id="Interval::Cos"></span>.
See the <tt>pbrt</tt> source code for their implementations.
 


</p>
<p><tt>pbrt</tt> provides 3D vector and point classes that use <a href="#Interval"><tt>Interval</tt></a> for the
coordinate values.  Here, the &ldquo;fi&rdquo; at the end of <a href="#Vector3fi"><tt>Vector3fi</tt></a> denotes
&ldquo;float interval.&rdquo;  These classes are easily defined thanks to the
templated definition of the <a href="../Geometry_and_Transformations/Vectors.html#Vector3"><tt>Vector3</tt></a> and <a href="../Geometry_and_Transformations/Points.html#Point3"><tt>Point3</tt></a> classes and the
underlying <a href="../Geometry_and_Transformations/n-Tuple_Base_Classes.html#Tuple3"><tt>Tuple3</tt></a> class from Section&nbsp;<a href="../Geometry_and_Transformations/n-Tuple_Base_Classes.html#sec:ntuple">3.2</a>.
 
</p>
<span class="anchor" id="fragment-Vector3fiDefinition-0"></span><div class="fragmentname">&lt;&lt;Vector3fi Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="Vector3fi"></span>Vector3fi : public Vector3&lt;Interval&gt; {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Vector3fiPublicMethods-0">Vector3fi Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-2742" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-2742"><i></i></a><div id="fragbit-2742" class="collapse show"><div class="fragmentcode">       using Vector3&lt;Interval&gt;::x;
       using Vector3&lt;Interval&gt;::y;
       using Vector3&lt;Interval&gt;::z;
       using Vector3&lt;Interval&gt;::HasNaN;
       using Vector3&lt;Interval&gt;::operator+;
       using Vector3&lt;Interval&gt;::operator+=;
       using Vector3&lt;Interval&gt;::operator*;
       using Vector3&lt;Interval&gt;::operator*=;
       Vector3fi(Float x, Float y, Float z)
           : Vector3&lt;Interval&gt;(Interval(x), Interval(y),
                                      Interval(z)) {}
       Vector3fi(Interval x, Interval y, Interval z)
           : Vector3&lt;Interval&gt;(x, y, z) {}
       Vector3fi(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> p)
           : Vector3&lt;Interval&gt;(Interval(p.x), Interval(p.y),
                                      Interval(p.z)) {}
       template &lt;typename T&gt;
       PBRT_CPU_GPU
       explicit Vector3fi(Point3&lt;T&gt; p)
           : Vector3&lt;Interval&gt;(Interval(p.x), Interval(p.y), Interval(p.z)) {}
       PBRT_CPU_GPU Vector3fi(Vector3&lt;Interval&gt; pfi)
           : Vector3&lt;Interval&gt;(pfi) {}
       Vector3fi(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> v, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> e)
           : Vector3&lt;Interval&gt;(Interval::FromValueAndError(v.x, e.x),
                               Interval::FromValueAndError(v.y, e.y),
                               Interval::FromValueAndError(v.z, e.z)) {}
       <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> Error() const {
           return {x.Width() / 2, y.Width() / 2, z.Width() / 2};
       }
       bool IsExact() const {
           return x.Width() == 0 &amp;&amp; y.Width() == 0 &amp;&amp; z.Width() == 0;
       }</div></div>
};</div><p>


</p>
<p>

</p>
<p>In addition to the usual constructors, <tt>Vector3fi</tt> can be initialized
by specifying a base vector and a second one that gives error bounds for
each component.

</p>
<p></p>
<span class="anchor" id="fragment-Vector3fiPublicMethods-0"></span><div class="fragmentname">&lt;&lt;Vector3fi Public Methods&gt;&gt;=&nbsp;<a href="#fragment-Vector3fiPublicMethods-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">Vector3fi(<a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> v, <a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> e)
    : Vector3&lt;Interval&gt;(Interval::FromValueAndError(v.x, e.x),
                        Interval::FromValueAndError(v.y, e.y),
                        Interval::FromValueAndError(v.z, e.z)) {}</div><p>


</p>
<p>Helper methods return error bounds for the vector components and indicate
if the value stored has empty intervals.

</p>
<p></p>
<span class="anchor" id="fragment-Vector3fiPublicMethods-1"></span><div class="fragmentname">&lt;&lt;Vector3fi Public Methods&gt;&gt;+=&nbsp;<a href="#fragment-Vector3fiPublicMethods-0"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Vectors.html#Vector3f" class="code">Vector3f</a> <span class="anchor" id="Vector3fi::Error"></span>Error() const {
    return {x.Width() / 2, y.Width() / 2, z.Width() / 2};
}
bool <span class="anchor" id="Vector3fi::IsExact"></span>IsExact() const {
    return x.Width() == 0 &amp;&amp; y.Width() == 0 &amp;&amp; z.Width() == 0;
}</div><p>


</p>
<p>The <tt>Point3fi</tt><span class="anchor" id="Point3fi"></span> class, not included here,
similarly provides the capabilities of a <a href="../Geometry_and_Transformations/Points.html#Point3"><tt>Point3</tt></a> using intervals for
its coordinate values.  It, too, provides
<tt>Error()</tt><span class="anchor" id="Point3fi::Error"></span> and
<tt>IsExact()</tt><span class="anchor" id="Point3fi::IsExact"></span> methods.

</p>
<p>

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
<div class="container-fluid">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>,<br>
<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">&copy; 2004-2023</a> Matt Pharr, Wenzel Jakob, and Greg Humphreys.
<a href="https://github.com/mmp/pbr-book-website/"><span class="fab fa-github"></span></a><br>
Purchase a printed copy: <a href="https://www.amazon.com/Physically-Based-Rendering-fourth-Implementation/dp/0262048027?keywords=physically+based+rendering+4th+edition&qid=1671730412&sprefix=physically+based%!C(MISSING)aps%!C(MISSING)145&sr=8-1&linkCode=ll1&tag=pharr-20&linkId=81a816d90f0c7e872617f1f930a51fd6&language=en_US&ref_=as_li_ss_tl"><span class="fab fa-amazon"></span></a>
<a href="https://mitpress.mit.edu/9780262048026/physically-based-rendering/"><img src="/mitpress.png" width=10 height=16></a>
</span>
</div>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Utilities/User_Interaction.html">Utilities / User Interaction</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
