
<!doctype html>
<html lang="en">
<head>

<!-- all praise to https://realfavicongenerator.net -->
<link rel="icon" href="/favicon.ico?v=2" /> <!-- force refresh -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="../pbrstyle.css">
  <link rel="stylesheet" href="/fontawesome-free-5.15.3-web/css/all.css">

<script async src="https://cse.google.com/cse.js?cx=22a43cef261a245ea"></script>  <script src="/react.min.js"></script>
  <script src="/react-dom.min.js"></script>
  <script src="/jeri.min.js"></script>
  <link rel="preload" href="/exr.worker.js" as="script" crossorigin="anonymous">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/bootstrap.min.css">

  <title>Image Texture</title>
</head>
        
<body>

<nav class="fixed-top-lg-navbar navbar navbar-expand bg-light navbar-light">
  <ul class="nav navbar-nav">
    <a class="navbar-brand" href="../contents.html"><img src="../pbr.jpg" width=25 height=25></a>
    <li class="nav-item"><a class="nav-link" href="../Textures_and_Materials.html">Textures and Materials</a></li>
    <span class="navbar-text">/</span>
    <li class="nav-item"><a class="nav-link" href="#">Image Texture</a></li>
    <span class="navbar-text">&nbsp;&nbsp;</span>
    <li class="nav-item"><a class="nav-link" href="../Textures_and_Materials/Texture_Interface_and_Basic_Textures.html">(Previous: Texture Interface and Basic Textures)</a></li>
  </ul>

  <ul class="nav navbar-nav ml-auto d-none d-md-block">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
  <ul class="nav navbar-nav d-block d-md-none">
        <li class="nav-item"><div class="gcse-search"></div></li>
    </ul>
</nav>

<div class="maincontainer">
<div class="container-fluid">

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#"><i class="fas fa-link "></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:texture-mapping"></span><h2>10.4 Image Texture</h2><p>



</p>
<p>Image textures store 2D arrays of point-sampled values of a texture
function.  They use these samples to reconstruct a continuous image
function that can be evaluated at an arbitrary <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg>
position.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="The term <em>texture map</em> is often used to refer to
this type of texture, although this usage blurs the distinction between the
mapping that computes texture coordinates and the texture function itself.">
      <sup>&dagger;</sup>
    </button>
		
These sample values are often called <em>texels</em>, since they are similar
to pixels in an image but are used in the context of a texture.  Image
textures are the most widely used type of texture in computer graphics;
digital photographs, scanned artwork, images created with image-editing
programs, and images generated by renderers are all extremely useful
sources of data for this particular texture representation
(Figure&nbsp;<a href="#fig:image-texture-example">10.14</a>).

</p>
<p></p>
<span class="anchor" id="fig:image-texture-example"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>

<div class="card-img-top" style="display:block; width: 100%; padding-top: 134.613%;  position:relative;">
<div id="xa_With_textures36" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div></div>
<script>
Jeri.renderViewer(document.getElementById('xa_With_textures36'), {
  title: '(a)_With_textures36', children: [
 { title: '(a) With textures', image: 'watercolor-with-textures.png' },  { title: '(b) Without textures', image: 'watercolor-without-textures.png' }]});
</script>
<button data-toggle="tooltip" data-placement="left" class="btn yojeri" title="This image is interactive. Click and drag to pan and use the mouse-wheel to zoom. After clicking on the image to select it, type '?' to see a summary of keyboard controls."><i class="fa fa-snowflake fa-border"></i></button><p>

</p>
<figcaption class="caption">Figure 10.14: An Example of Image Textures. <span class="legend"> Image textures are used
throughout the <em>Watercolor</em> scene to represent spatially varying surface
appearance properties. (a)&nbsp;Scene rendered with image textures. (b)&nbsp;Each
image texture has been replaced with its average value. Note how much visual
richness is lost.
<em>(Scene courtesy of Angelo Ferretti.)</em>
</span>
</figcaption>
</div></div><p>


</p>
<p>As with most of the other types of texture, <tt>pbrt</tt> provides both
<tt>Float</tt> and spectral variants.  Both implementations inherit from
<a href="#ImageTextureBase"><tt>ImageTextureBase</tt></a>, which provides some common functionality.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTextureBaseDefinition-0"></span><div class="fragmentname">&lt;&lt;ImageTextureBase Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="ImageTextureBase"></span>ImageTextureBase {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ImageTextureBasePublicMethods-0">ImageTextureBase Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1482" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1482"><i></i></a><div id="fragbit-1482" class="collapse show"><div class="fragmentcode">       ImageTextureBase(<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D" class="code">TextureMapping2D</a> mapping, std::string filename,
               <a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> filterOptions, <a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> wrapMode, Float scale,
               bool invert, <a href="../Utilities/Images.html#ColorEncoding" class="code">ColorEncoding</a> encoding, <a href="../Introduction/Using_and_Understanding_the_Code.html#Allocator" class="code">Allocator</a> alloc)
           : mapping(mapping), filename(filename), scale(scale), invert(invert) {
           &lt;&lt;<span class="fragmentname"><a href="#fragment-GetmonoMIPMapfromtexturecacheifpresent-0">Get <tt>MIPMap</tt> from texture cache if present</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1483" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1483"><i></i></a><div id="fragbit-1483" class="collapse show"><div class="fragmentcode">              TexInfo texInfo(filename, filterOptions, wrapMode, encoding);
              std::unique_lock&lt;std::mutex&gt; lock(<a href="#ImageTextureBase::textureCacheMutex" class="code">textureCacheMutex</a>);
              if (auto iter = <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>.find(texInfo); iter != <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>.end()) {
                  <a href="#ImageTextureBase::mipmap" class="code">mipmap</a> = iter-&gt;second;
                  return;
              }
              lock.unlock();</div></div>
           &lt;&lt;<span class="fragmentname"><a href="#fragment-CreatemonoMIPMapformonofilenameandaddtotexturecache-0">Create <tt>MIPMap</tt> for <tt>filename</tt> and add to texture cache</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1484" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1484"><i></i></a><div id="fragbit-1484" class="collapse show"><div class="fragmentcode">              <a href="#ImageTextureBase::mipmap" class="code">mipmap</a> = <a href="#MIPMap" class="code">MIPMap</a>::CreateFromFile(filename, filterOptions, wrapMode,
                                              encoding, alloc);
              lock.lock();
              <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>[texInfo] = <a href="#ImageTextureBase::mipmap" class="code">mipmap</a>;</div></div>
       }
       static void ClearCache() { textureCache.clear(); }
       void MultiplyScale(Float s) { scale *= s; }</div></div>
  protected:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ImageTextureBaseProtectedMembers-0">ImageTextureBase Protected Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1485" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1485"><i></i></a><div id="fragbit-1485" class="collapse show"><div class="fragmentcode">       <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D" class="code">TextureMapping2D</a> mapping;
       std::string filename;
       Float scale;
       bool invert;
       <a href="#MIPMap" class="code">MIPMap</a> *mipmap;</div></div>
  private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ImageTextureBasePrivateMembers-0">ImageTextureBase Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1486" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1486"><i></i></a><div id="fragbit-1486" class="collapse show"><div class="fragmentcode">       static std::mutex textureCacheMutex;
       static std::map&lt;TexInfo, <a href="#MIPMap" class="code">MIPMap</a> *&gt; textureCache;</div></div>
};</div><p>


</p>
<p>

</p>
<p>In the following, we will present the implementation of
<tt>SpectrumImageTexture</tt>;
<tt>FloatImageTexture</tt><span class="anchor" id="FloatImageTexture"></span> is analogous and
does not add anything new.

</p>
<p></p>
<span class="anchor" id="fragment-SpectrumImageTextureDefinition-0"></span><div class="fragmentname">&lt;&lt;SpectrumImageTexture Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="SpectrumImageTexture"></span>SpectrumImageTexture : public <a href="#ImageTextureBase" class="code">ImageTextureBase</a> {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-SpectrumImageTexturePublicMethods-0">SpectrumImageTexture Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1487" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1487"><i></i></a><div id="fragbit-1487" class="collapse show"><div class="fragmentcode">       SpectrumImageTexture(<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D" class="code">TextureMapping2D</a> mapping, std::string filename,
               <a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> filterOptions, <a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> wrapMode, Float scale,
               bool invert, <a href="../Utilities/Images.html#ColorEncoding" class="code">ColorEncoding</a> encoding, <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType" class="code">SpectrumType</a> spectrumType,
               <a href="../Introduction/Using_and_Understanding_the_Code.html#Allocator" class="code">Allocator</a> alloc)
           : <a href="#ImageTextureBase" class="code">ImageTextureBase</a>(mapping, filename, filterOptions, wrapMode,
                              scale, invert, encoding, alloc),
             spectrumType(spectrumType) {}
       PBRT_CPU_GPU
       <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> Evaluate(<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> ctx,
                                <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> lambda) const;
       
       static SpectrumImageTexture *Create(const <a href="../Geometry_and_Transformations/Transformations.html#Transform" class="code">Transform</a> &amp;renderFromTexture,
                                           const TextureParameterDictionary &amp;parameters,
                                           <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType" class="code">SpectrumType</a> spectrumType, const FileLoc *loc, <a href="../Introduction/Using_and_Understanding_the_Code.html#Allocator" class="code">Allocator</a> alloc);
       
       std::string ToString() const;</div></div>
  private:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-SpectrumImageTexturePrivateMembers-0">SpectrumImageTexture Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1488" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1488"><i></i></a><div id="fragbit-1488" class="collapse show"><div class="fragmentcode">       <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType" class="code">SpectrumType</a> spectrumType;</div></div>
};</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#TextureMemoryManagement"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:texture-caching"></span><span id="TextureMemoryManagement"></span><h3>10.4.1  Texture Memory Management</h3><p>



</p>
<p>The caller of <tt>SpectrumImageTexture</tt>&rsquo;s constructor provides a texture
mapping function, the filename of an image, various parameters that control
the filtering of the image map, how boundary conditions are managed, and
how colors are converted to spectral samples.  All the necessary initialization is handled by
<a href="#ImageTextureBase"><tt>ImageTextureBase</tt></a>.

</p>
<p></p>
<span class="anchor" id="fragment-SpectrumImageTexturePublicMethods-0"></span><div class="fragmentname">&lt;&lt;SpectrumImageTexture Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">SpectrumImageTexture(<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D" class="code">TextureMapping2D</a> mapping, std::string filename,
        <a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> filterOptions, <a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> wrapMode, Float scale,
        bool invert, <a href="../Utilities/Images.html#ColorEncoding" class="code">ColorEncoding</a> encoding, <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType" class="code">SpectrumType</a> spectrumType,
        <a href="../Introduction/Using_and_Understanding_the_Code.html#Allocator" class="code">Allocator</a> alloc)
    : <a href="#ImageTextureBase" class="code">ImageTextureBase</a>(mapping, filename, filterOptions, wrapMode,
                       scale, invert, encoding, alloc),
      spectrumType(spectrumType) {}</div><p>


</p>
<p>As was discussed in Section&nbsp;<a href="../Radiometry,_Spectra,_and_Color/Color.html#sec:rgb-to-spectrum">4.6.6</a>, RGB colors are
transformed into spectra differently depending on whether or not they
represent reflectances.  The <tt>spectrumType</tt> records what type of RGB
a texture represents.

</p>
<p></p>
<span class="anchor" id="fragment-SpectrumImageTexturePrivateMembers-0"></span><div class="fragmentname">&lt;&lt;SpectrumImageTexture Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType" class="code">SpectrumType</a> <span class="anchor" id="SpectrumImageTexture::spectrumType"></span>spectrumType;</div><p>


</p>
<p>The contents of the image file are used to create an instance of the
<a href="#MIPMap"><tt>MIPMap</tt></a> class that stores the texels in memory and handles the details
of reconstruction and filtering to reduce aliasing.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTextureBasePublicMethods-0"></span><div class="fragmentname">&lt;&lt;ImageTextureBase Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">ImageTextureBase(<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D" class="code">TextureMapping2D</a> mapping, std::string filename,
        <a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> filterOptions, <a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> wrapMode, Float scale,
        bool invert, <a href="../Utilities/Images.html#ColorEncoding" class="code">ColorEncoding</a> encoding, <a href="../Introduction/Using_and_Understanding_the_Code.html#Allocator" class="code">Allocator</a> alloc)
    : mapping(mapping), filename(filename), scale(scale), invert(invert) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-GetmonoMIPMapfromtexturecacheifpresent-0">Get <tt>MIPMap</tt> from texture cache if present</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1489" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1489"><i></i></a><div id="fragbit-1489" class="collapse show"><div class="fragmentcode">       TexInfo texInfo(filename, filterOptions, wrapMode, encoding);
       std::unique_lock&lt;std::mutex&gt; lock(<a href="#ImageTextureBase::textureCacheMutex" class="code">textureCacheMutex</a>);
       if (auto iter = <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>.find(texInfo); iter != <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>.end()) {
           <a href="#ImageTextureBase::mipmap" class="code">mipmap</a> = iter-&gt;second;
           return;
       }
       lock.unlock();</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-CreatemonoMIPMapformonofilenameandaddtotexturecache-0">Create <tt>MIPMap</tt> for <tt>filename</tt> and add to texture cache</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1490" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1490"><i></i></a><div id="fragbit-1490" class="collapse show"><div class="fragmentcode">       <a href="#ImageTextureBase::mipmap" class="code">mipmap</a> = <a href="#MIPMap" class="code">MIPMap</a>::CreateFromFile(filename, filterOptions, wrapMode,
                                       encoding, alloc);
       lock.lock();
       <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>[texInfo] = <a href="#ImageTextureBase::mipmap" class="code">mipmap</a>;</div></div>
}</div><p>


</p>
<p>A floating-point scale can be specified with each texture; it is applied to
the values returned by the <tt>Evaluate()</tt> method.  Further, a
<tt>true</tt> value for the <tt>invert</tt> parameter causes the texture value
to be subtracted from&nbsp;1 before it is returned.
While the same functionality can be achieved with scale and mix textures,
it is easy to also provide that functionality
directly in the texture here.  Doing so can lead to more efficient texture
evaluation on GPUs, as is discussed further in Section&nbsp;<a href="../Wavefront_Rendering_on_GPUs/Path_Tracer_Implementation.html#sec:gpu-surface-scatter">15.3.9</a>.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTextureBaseProtectedMembers-0"></span><div class="fragmentname">&lt;&lt;ImageTextureBase Protected Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D" class="code">TextureMapping2D</a> <span class="anchor" id="ImageTextureBase::mapping"></span>mapping;
std::string <span class="anchor" id="ImageTextureBase::filename"></span>filename;
Float <span class="anchor" id="ImageTextureBase::scale"></span>scale;
bool <span class="anchor" id="ImageTextureBase::invert"></span>invert;
<a href="#MIPMap" class="code">MIPMap</a> *<span class="anchor" id="ImageTextureBase::mipmap"></span>mipmap;</div><p>


</p>
<p>

</p>
<p>Each MIP map may require a meaningful amount of memory, and a complex scene
may have thousands of image textures.  Because an on-disk image may be
reused for multiple textures in a scene, <tt>pbrt</tt> maintains a table of MIP
maps that have been loaded so far so that they are only loaded into memory
once even if they are used in more than one image texture.

</p>
<p><tt>pbrt</tt> loads textures in parallel after the scene description has been
parsed; doing so reduces startup time before rendering begins.  Therefore,
a mutex is used here to ensure that only one thread accesses the texture
cache at a time.  Note that if the <tt>MIPMap</tt> is not found in the cache,
the lock is released before it is read so that other threads can access the
cache in the meantime.

</p>
<p></p>
<span class="anchor" id="fragment-GetmonoMIPMapfromtexturecacheifpresent-0"></span><div class="fragmentname">&lt;&lt;Get <tt>MIPMap</tt> from texture cache if present&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">TexInfo texInfo(filename, filterOptions, wrapMode, encoding);
std::unique_lock&lt;std::mutex&gt; lock(<a href="#ImageTextureBase::textureCacheMutex" class="code">textureCacheMutex</a>);
if (auto iter = <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>.find(texInfo); iter != <a href="#ImageTextureBase::textureCache" class="code">textureCache</a>.end()) {
    <a href="#ImageTextureBase::mipmap" class="code">mipmap</a> = iter-&gt;second;
    return;
}
lock.unlock();</div><p>


</p>
<p>The texture cache itself is managed with a <tt>std::map</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-ImageTextureBasePrivateMembers-0"></span><div class="fragmentname">&lt;&lt;ImageTextureBase Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">static std::mutex <span class="anchor" id="ImageTextureBase::textureCacheMutex"></span>textureCacheMutex;
static std::map&lt;TexInfo, <a href="#MIPMap" class="code">MIPMap</a> *&gt; <span class="anchor" id="ImageTextureBase::textureCache"></span>textureCache;</div><p>


</p>
<p><a href="#TexInfo"><tt>TexInfo</tt></a> is a simple structure that acts as a key for the texture
cache <tt>std::map</tt>.  It holds all the specifics that must match
for a <a href="#MIPMap"><tt>MIPMap</tt></a> to be reused in another image texture.

</p>
<p></p>
<span class="anchor" id="fragment-TexInfoDefinition-0"></span><div class="fragmentname">&lt;&lt;TexInfo Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">struct <span class="anchor" id="TexInfo"></span>TexInfo {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-TexInfoPublicMethods-0">TexInfo Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1491" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1491"><i></i></a><div id="fragbit-1491" class="collapse show"><div class="fragmentcode">       TexInfo(const std::string &amp;f, MIPMapFilterOptions <a href="#TexInfo::filterOptions" class="code">filterOptions</a>, WrapMode wm,
               <a href="../Utilities/Images.html#ColorEncoding" class="code">ColorEncoding</a> <a href="#TexInfo::encoding" class="code">encoding</a>)
           : <a href="#TexInfo::filename" class="code">filename</a>(f), <a href="#TexInfo::filterOptions" class="code">filterOptions</a>(<a href="#TexInfo::filterOptions" class="code">filterOptions</a>), <a href="#TexInfo::wrapMode" class="code">wrapMode</a>(wm), <a href="#TexInfo::encoding" class="code">encoding</a>(<a href="#TexInfo::encoding" class="code">encoding</a>) {}
       bool operator&lt;(const TexInfo &amp;t) const {
           return std::tie(<a href="#TexInfo::filename" class="code">filename</a>, <a href="#TexInfo::filterOptions" class="code">filterOptions</a>, <a href="#TexInfo::encoding" class="code">encoding</a>, <a href="#TexInfo::wrapMode" class="code">wrapMode</a>) &lt;
                  std::tie(t.<a href="#TexInfo::filename" class="code">filename</a>, t.<a href="#TexInfo::filterOptions" class="code">filterOptions</a>, t.<a href="#TexInfo::encoding" class="code">encoding</a>, t.<a href="#TexInfo::wrapMode" class="code">wrapMode</a>);
       }
       std::string ToString() const;</div></div>
    std::string <span class="anchor" id="TexInfo::filename"></span>filename;
    <a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> <span class="anchor" id="TexInfo::filterOptions"></span>filterOptions;
    <a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> <span class="anchor" id="TexInfo::wrapMode"></span>wrapMode;
    <a href="../Utilities/Images.html#ColorEncoding" class="code">ColorEncoding</a> <span class="anchor" id="TexInfo::encoding"></span>encoding;
};</div><p>


</p>
<p>

</p>
<p>The <tt>TexInfo</tt> constructor, not included here, sets its member
variables with provided values.  Its only other method is a comparison
operator, which is required by <tt>std::map</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-TexInfoPublicMethods-0"></span><div class="fragmentname">&lt;&lt;TexInfo Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">bool operator&lt;(const TexInfo &amp;t) const {
    return std::tie(<a href="#TexInfo::filename" class="code">filename</a>, <a href="#TexInfo::filterOptions" class="code">filterOptions</a>, <a href="#TexInfo::encoding" class="code">encoding</a>, <a href="#TexInfo::wrapMode" class="code">wrapMode</a>) &lt;
           std::tie(t.<a href="#TexInfo::filename" class="code">filename</a>, t.<a href="#TexInfo::filterOptions" class="code">filterOptions</a>, t.<a href="#TexInfo::encoding" class="code">encoding</a>, t.<a href="#TexInfo::wrapMode" class="code">wrapMode</a>);
}</div><p>


</p>
<p>

</p>
<p>If the texture has not yet been loaded, a call to <tt>CreateFromFile()</tt>
yields a <a href="#MIPMap"><tt>MIPMap</tt></a> for it.  If the file is not found or there is an
error reading it, <tt>pbrt</tt> exits with an error message, so a <tt>nullptr</tt>
return value does not need to be handled here.

</p>
<p></p>
<span class="anchor" id="fragment-CreatemonoMIPMapformonofilenameandaddtotexturecache-0"></span><div class="fragmentname">&lt;&lt;Create <tt>MIPMap</tt> for <tt>filename</tt> and add to texture cache&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="#ImageTextureBase::mipmap" class="code">mipmap</a> = <a href="#MIPMap" class="code">MIPMap</a>::CreateFromFile(filename, filterOptions, wrapMode,
                                encoding, alloc);
lock.lock();
<a href="#ImageTextureBase::textureCache" class="code">textureCache</a>[texInfo] = <a href="#ImageTextureBase::mipmap" class="code">mipmap</a>;</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#ImageTextureEvaluation"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:image-texture-eval"></span><span id="ImageTextureEvaluation"></span><h3>10.4.2  Image Texture Evaluation</h3><p>



</p>
<p>Before describing the <a href="#MIPMap"><tt>MIPMap</tt></a> implementation, we will discuss the
<a href="#SpectrumImageTexture"><tt>SpectrumImageTexture</tt></a> <tt>Evaluate()</tt> method.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-SpectrumImageTextureMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;SpectrumImageTexture Method Definitions&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a> <span class="anchor" id="SpectrumImageTexture::Evaluate"></span>SpectrumImageTexture::Evaluate(
        <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureEvalContext" class="code">TextureEvalContext</a> ctx, <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledWavelengths" class="code">SampledWavelengths</a> lambda) const {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Applytexturemappingandfliptcoordinateforimagetexturelookup-0">Apply texture mapping and flip <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> coordinate for image texture lookup</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1492" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1492"><i></i></a><div id="fragbit-1492" class="collapse show"><div class="fragmentcode">       <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D" class="code">TexCoord2D</a> c = <a href="#ImageTextureBase::mapping" class="code">mapping</a>.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D::Map" class="code">Map</a>(ctx);
       c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::st" class="code">st</a>[1] = 1 - c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::st" class="code">st</a>[1];</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-LookupfilteredRGBvalueinmonoMIPMap-0">Lookup filtered RGB value in <tt>MIPMap</tt></a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1493" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1493"><i></i></a><div id="fragbit-1493" class="collapse show"><div class="fragmentcode">       <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a> rgb = <a href="#ImageTextureBase::scale" class="code">scale</a> * <a href="#ImageTextureBase::mipmap" class="code">mipmap</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter" class="code">Filter</a>&lt;<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>&gt;(c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::st" class="code">st</a>, {c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dsdx" class="code">dsdx</a>, c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dtdx" class="code">dtdx</a>},  
                                                   {c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dsdy" class="code">dsdy</a>, c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dtdy" class="code">dtdy</a>});
       rgb = ClampZero(<a href="#ImageTextureBase::invert" class="code">invert</a> ? (<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>(1, 1, 1) - rgb) : rgb);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ReturnmonoSampledSpectrumforRGBimagetexturevalue-0">Return <tt>SampledSpectrum</tt> for RGB image texture value</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1494" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1494"><i></i></a><div id="fragbit-1494" class="collapse show"><div class="fragmentcode">       if (const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *cs = mipmap-&gt;<a href="#MIPMap::GetRGBColorSpace" class="code">GetRGBColorSpace</a>(); cs) {
           if (<a href="#SpectrumImageTexture::spectrumType" class="code">spectrumType</a> == <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType::Albedo" class="code">SpectrumType</a>::Unbounded)
               return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBUnboundedSpectrum" class="code">RGBUnboundedSpectrum</a>(*cs, rgb).<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum::Sample" class="code">Sample</a>(lambda);
           else if (<a href="#SpectrumImageTexture::spectrumType" class="code">spectrumType</a> == <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType::Albedo" class="code">SpectrumType</a>::Albedo)
               return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBAlbedoSpectrum" class="code">RGBAlbedoSpectrum</a>(*cs, <a href="../Utilities/Mathematical_Infrastructure.html#Clamp" class="code">Clamp</a>(rgb, 0, 1)).<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum::Sample" class="code">Sample</a>(lambda);
           else
               return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum" class="code">RGBIlluminantSpectrum</a>(*cs, rgb).<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum::Sample" class="code">Sample</a>(lambda);
       }
       DCHECK(rgb[0] == rgb[1] &amp;&amp; rgb[1] == rgb[2]);
       return <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a>(rgb[0]);</div></div>
}</div><p>


</p>
<p>It is easy to compute the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> texture coordinates and their derivatives
for filtering with the <a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D"><tt>TextureMapping2D</tt></a>&rsquo;s <tt>Map()</tt> method.
However, the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> coordinate must be flipped, because <tt>pbrt</tt>&rsquo;s <a href="../Utilities/Images.html#Image"><tt>Image</tt></a>
class (and in turn, <a href="#MIPMap"><tt>MIPMap</tt></a>, which is based on it) defines <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.168ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2225.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1835" y="0"></use>
</g>
</svg> to
be the upper left corner of the image, while image textures have <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.168ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2225.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis 0 comma 0 right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="890" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1335" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1835" y="0"></use>
</g>
</svg> at the
lower left.  (These are the typical conventions for indexing these entities
in computer graphics.)

</p>
<p></p>
<span class="anchor" id="fragment-Applytexturemappingandfliptcoordinateforimagetexturelookup-0"></span><div class="fragmentname">&lt;&lt;Apply texture mapping and flip <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> coordinate for image texture lookup&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D" class="code">TexCoord2D</a> c = <a href="#ImageTextureBase::mapping" class="code">mapping</a>.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TextureMapping2D::Map" class="code">Map</a>(ctx);
c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::st" class="code">st</a>[1] = 1 - c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::st" class="code">st</a>[1];</div><p>


</p>
<p>The <a href="#MIPMap"><tt>MIPMap</tt></a>&rsquo;s <tt>Filter()</tt> method provides the filtered
value of the image texture over the specified region; any specified
scale or inversion is easily applied to the value it returns.  A call to
<tt>ClampZero()</tt> here ensures that no negative values are returned after
inversion.

</p>
<p></p>
<span class="anchor" id="fragment-LookupfilteredRGBvalueinmonoMIPMap-0"></span><div class="fragmentname">&lt;&lt;Lookup filtered RGB value in <tt>MIPMap</tt>&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a> rgb = <a href="#ImageTextureBase::scale" class="code">scale</a> * <a href="#ImageTextureBase::mipmap" class="code">mipmap</a>-&gt;<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter" class="code">Filter</a>&lt;<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>&gt;(c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::st" class="code">st</a>, {c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dsdx" class="code">dsdx</a>, c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dtdx" class="code">dtdx</a>},  
                                            {c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dsdy" class="code">dsdy</a>, c.<a href="../Textures_and_Materials/Texture_Coordinate_Generation.html#TexCoord2D::dtdy" class="code">dtdy</a>});
rgb = ClampZero(<a href="#ImageTextureBase::invert" class="code">invert</a> ? (<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>(1, 1, 1) - rgb) : rgb);</div><p>


</p>
<p>

</p>
<p>As discussed in Section&nbsp;<a href="../Radiometry,_Spectra,_and_Color/Color.html#sec:rgb">4.6.2</a>, an RGB color space is
necessary in order to interpret the meaning of an <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB"><tt>RGB</tt></a> color value.
Normally, the code that reads image file formats from disk returns an
<tt>RGBCcolorSpace</tt> with the read image.  Most RGB image formats default to sRGB, and
some allow specifying an alternative color space.  (For example, OpenEXR
allows specifying the primaries of an arbitrary RGB color space in the
image file&rsquo;s metadata.)
A color space and the value of <tt>spectrumType</tt> make it possible to
create the appropriate type RGB spectrum, and in turn, its
<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#Spectrum::Sample"><tt>Spectrum::Sample()</tt></a> can be called to get the
<a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum"><tt>SampledSpectrum</tt></a> that will be returned.

</p>
<p>If the <a href="#MIPMap"><tt>MIPMap</tt></a> has no associated color space, the image is
assumed to have the same value in all channels and a constant value is
returned for all the spectrum samples.  This assumption is verified by a
<a href="../Utilities/User_Interaction.html#DCHECK"><tt>DCHECK()</tt></a> call in non-optimized builds.

</p>
<p></p>
<span class="anchor" id="fragment-ReturnmonoSampledSpectrumforRGBimagetexturevalue-0"></span><div class="fragmentname">&lt;&lt;Return <tt>SampledSpectrum</tt> for RGB image texture value&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *cs = mipmap-&gt;<a href="#MIPMap::GetRGBColorSpace" class="code">GetRGBColorSpace</a>(); cs) {
    if (<a href="#SpectrumImageTexture::spectrumType" class="code">spectrumType</a> == <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType::Albedo" class="code">SpectrumType</a>::Unbounded)
        return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBUnboundedSpectrum" class="code">RGBUnboundedSpectrum</a>(*cs, rgb).<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum::Sample" class="code">Sample</a>(lambda);
    else if (<a href="#SpectrumImageTexture::spectrumType" class="code">spectrumType</a> == <a href="../Processing_the_Scene_Description/Managing_the_Scene_Description.html#SpectrumType::Albedo" class="code">SpectrumType</a>::Albedo)
        return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBAlbedoSpectrum" class="code">RGBAlbedoSpectrum</a>(*cs, <a href="../Utilities/Mathematical_Infrastructure.html#Clamp" class="code">Clamp</a>(rgb, 0, 1)).<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum::Sample" class="code">Sample</a>(lambda);
    else
        return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum" class="code">RGBIlluminantSpectrum</a>(*cs, rgb).<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBIlluminantSpectrum::Sample" class="code">Sample</a>(lambda);
}
DCHECK(rgb[0] == rgb[1] &amp;&amp; rgb[1] == rgb[2]);
return <a href="../Radiometry,_Spectra,_and_Color/Representing_Spectral_Distributions.html#SampledSpectrum" class="code">SampledSpectrum</a>(rgb[0]);</div><p>


</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#MIPMaps"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:mipmap"></span><span id="MIPMaps"></span><h3>10.4.3  MIP Maps</h3><p>



</p>
<p>As always, if the image texture function has higher frequency detail than
can be represented by the texture sampling rate, aliasing will be present
in the final image.  Any frequencies higher than the Nyquist limit must be
removed by prefiltering before the function is evaluated.
Figure&nbsp;<a href="#fig:tex-filter-large-area">10.15</a> shows the basic problem we face: an
image texture has texels that are samples of some image function at a fixed
frequency.  The filter region for the lookup is given by its <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> center
point and offsets to the estimated texture coordinate locations for the
adjacent image samples.  Because these offsets are estimates of the texture
sampling rate, we must remove any frequencies higher than twice the
distance to the adjacent samples in order to satisfy the Nyquist
criterion.

</p>
<p></p>
<span class="anchor" id="fig:tex-filter-large-area"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha10f15.svg" title=""><img src="pha10f15.svg" width=280 height=252 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.15: <span class="legend"> Given a point at which to perform
an image map lookup (denoted by the solid point in the center) and estimates of the
texture-space sampling rate (denoted by adjacent solid points), it may be
necessary to filter the contributions of a large number of texels in the
image map (denoted by open points).</span>
</figcaption>
</div></div><p>


</p>
<p>The texture sampling and reconstruction process has a few key differences
from the image sampling process discussed in
Chapter&nbsp;<a href="../Sampling_and_Reconstruction.html#chap:sampling-reconstruction">8</a>.  These differences make it
possible to address the antialiasing problem with more effective and less
computationally expensive techniques.  For example, here it is inexpensive
to get the value of a sample&mdash;only an array lookup is necessary (as
opposed to having to trace a number of rays to compute radiance).  Further,
because the texture image function is fully defined by the set of samples
and there is no mystery about what its highest frequency could be, there is
no uncertainty related to the function&rsquo;s behavior between samples.  These
differences make it possible to remove detail from the texture before
sampling, thus eliminating aliasing.

</p>
<p>However, the texture sampling rate will typically change from pixel to
pixel.  The sampling rate is determined by scene geometry and its
orientation, the texture coordinate mapping function, and the camera
projection and image sampling rate. Because the texture sampling rate is
not fixed, texture filtering algorithms need to be able to filter over
arbitrary regions of texture samples efficiently.

</p>
<p>The <a href="#MIPMap"><tt>MIPMap</tt></a> class implements a number of methods for texture filtering
with spatially varying filter widths.  It can be found in the files
<a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/util/mipmap.h"><tt>util/mipmap.h</tt></a> and <a href="https://github.com/mmp/pbrt-v4/tree/master/src/pbrt/util/mipmap.cpp"><tt>util/mipmap.cpp</tt></a>.  The filtering
algorithms it offers range from simple point sampling to bilinear
interpolation and trilinear interpolation,
which is fast and easy to implement and was widely used for texture
filtering in early graphics hardware, to elliptically weighted averaging,
which is more complex but returns extremely high-quality results.
Figure&nbsp;<a href="#fig:texfilt-ewa-trilerp">10.16</a> compares the result of texture
filtering using trilinear interpolation and the EWA algorithm.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapDefinition-0"></span><div class="fragmentname">&lt;&lt;MIPMap Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">class <span class="anchor" id="MIPMap"></span>MIPMap {
  public:
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MIPMapPublicMethods-0">MIPMap Public Methods</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1495" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1495"><i></i></a><div id="fragbit-1495" class="collapse show"><div class="fragmentcode">       <a href="#MIPMap" class="code">MIPMap</a>(<a href="../Utilities/Images.html#Image" class="code">Image</a> image, const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *<a href="#MIPMap::colorSpace" class="code">colorSpace</a>, WrapMode wrapMode,
              Allocator alloc, const MIPMapFilterOptions &amp;options);
       static <a href="#MIPMap" class="code">MIPMap</a> *CreateFromFile(const std::string &amp;filename,
                                                     const MIPMapFilterOptions &amp;options,
                                                     WrapMode wrapMode,
                                                     <a href="../Utilities/Images.html#ColorEncoding" class="code">ColorEncoding</a> encoding,
                                                     Allocator alloc);
       template &lt;typename T&gt;
       T <a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter" class="code">Filter</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dstdx, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dstdy) const;
       std::string ToString() const;
       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> LevelResolution(int level) const {
           return <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::Resolution" class="code">Resolution</a>();
       }
       int Levels() const { return int(<a href="#MIPMap::pyramid" class="code">pyramid</a>.size()); }
       const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *GetRGBColorSpace() const { return <a href="#MIPMap::colorSpace" class="code">colorSpace</a>; }
       const <a href="../Utilities/Images.html#Image" class="code">Image</a> &amp;GetLevel(int level) const { return <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]; }</div></div>
  private:
    &lt;&lt;<span class="fragmentname">MIPMap Private Methods</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1496" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1496"><i></i></a><div id="fragbit-1496" class="collapse show"><div class="fragmentcode">       template &lt;typename T&gt;
       T Texel(int level, <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> st) const;
       template &lt;typename T&gt;
       T Bilerp(int level, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st) const;
       template &lt;typename T&gt;
       T EWA(int level, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst0, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst1) const;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-MIPMapPrivateMembers-0">MIPMap Private Members</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1497" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1497"><i></i></a><div id="fragbit-1497" class="collapse show"><div class="fragmentcode">       pstd::vector&lt;<a href="../Utilities/Images.html#Image" class="code">Image</a>&gt; pyramid;
       const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *colorSpace;
       <a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> wrapMode;
       <a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> options;</div></div>
};</div><p>


</p>
<p></p>
<span class="anchor" id="fig:texfilt-ewa-trilerp"></span><div class="card outerfigure"><div class="card-body figure"><p>


</p>
<div class="figure-row">
<img src="sphere-ewa-vs-trilerp.png" style="max-width: 100%; height: auto;" width=1800 height=900>
</div>
<p>

</p>
<figcaption class="caption">Figure 10.16: <span class="legend"> Filtering the image map properly substantially improves
the image.  Trilinear interpolation is used for the sphere on the left and
the EWA algorithm is used for the sphere on the right.  Both of these
approaches give a much better result than the unfiltered image map on the
sphere on the left in
Figure&nbsp;<a href="../Textures_and_Materials.html#fig:texture-aliasing-example">10.1</a>.  Trilinear interpolation is
not as effective as EWA at handling strongly anisotropic filter footprints, which
is why the lines on the left sphere are blurrier.  In regions with highly
anisotropic filter footprints such as the pole of the sphere and toward the
edges, EWA resolves much more detail.</span>
</figcaption>
</div></div><p>


</p>
<p>

</p>
<p>If an RGB image is provided to the <tt>MIPMap</tt> constructor, its channels
should be stored in R, G, B order in memory; for efficiency, the following code assumes
that this is the case.
All the code that currently uses <tt>MIPMaps</tt> in <tt>pbrt</tt> ensures that
this is so.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-0"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-1"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode"><a href="#MIPMap" class="code">MIPMap</a>::<a href="#MIPMap" class="code">MIPMap</a>(
        <a href="../Utilities/Images.html#Image" class="code">Image</a> image, const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *colorSpace, <a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> wrapMode,
        <a href="../Introduction/Using_and_Understanding_the_Code.html#Allocator" class="code">Allocator</a> alloc, const <a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> &amp;options)
    : colorSpace(colorSpace), wrapMode(wrapMode), options(options) {
    pyramid = <a href="../Utilities/Images.html#Image" class="code">Image</a>::GeneratePyramid(std::move(image), wrapMode, alloc);
}</div><p>


</p>
<p>To limit the potential number of texels that need to be accessed, these
filtering methods use an <em>image pyramid</em> of increasingly lower
resolution prefiltered versions of the original image to accelerate their
operation.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="The name &ldquo;MIP map&rdquo; comes from the Latin <em>multum
in parvo</em>, which means &ldquo;much in little,&rdquo; a nod to the image pyramid.">
      <sup>&dagger;</sup>
    </button>
		
The original image texels are at the bottom level of the pyramid, and the
image at each level is half the resolution of the previous level, up to the
top level, which has a single texel representing the average of all the
texels in the original image.  This collection of images needs at most
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.487ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 1501.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1 slash 3</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-33" d="M457 171c0 -102 -91 -193 -213 -193c-109 0 -202 66 -202 157c0 44 32 58 56 58c29 0 56 -20 56 -56c0 -38 -31 -60 -66 -55c35 -59 110 -76 153 -76c44 0 113 29 113 165c0 98 -37 166 -119 166h-44c-17 0 -24 0 -24 11c0 10 7 11 15 12c7 0 31 2 39 3c25 1 59 4 89 52 c26 44 28 102 28 114c0 90 -55 112 -96 112c-36 0 -102 -13 -133 -62c15 0 62 0 62 -50c0 -29 -20 -51 -51 -51c-29 0 -51 19 -51 52c0 76 76 136 177 136c96 0 184 -56 184 -138c0 -79 -58 -149 -140 -176c104 -21 167 -99 167 -181Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-33" x="1001" y="0"></use>
</g>
</svg> more memory than storing the most detailed level alone and can be
used to quickly find filtered values over large regions of the original
image.  The basic idea behind the pyramid is that if a large area of texels
needs to be filtered, a reasonable approximation is to use a higher level of
the pyramid and do the filtering over the same area there, accessing many
fewer texels.

</p>
<p>The <tt>MIPMap</tt>&rsquo;s image pyramid is represented by a vector of
<a href="../Utilities/Images.html#Image"><tt>Image</tt></a>s.  See Section&nbsp;<a href="../Utilities/Images.html#sec:image-class">B.5</a> for the implementation of
<a href="../Utilities/Images.html#Image"><tt>Image</tt></a> and Section&nbsp;<a href="../Utilities/Images.html#sec:image-pyramids">B.5.5</a> for its
<tt>GeneratePyramid()</tt> method, which
generates image pyramids.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapPrivateMembers-0"></span><div class="fragmentname">&lt;&lt;MIPMap Private Members&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">pstd::vector&lt;<a href="../Utilities/Images.html#Image" class="code">Image</a>&gt; <span class="anchor" id="MIPMap::pyramid"></span>pyramid;
const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *<span class="anchor" id="MIPMap::colorSpace"></span>colorSpace;
<a href="../Utilities/Images.html#WrapMode" class="code">WrapMode</a> <span class="anchor" id="MIPMap::wrapMode"></span>wrapMode;
<a href="#MIPMapFilterOptions" class="code">MIPMapFilterOptions</a> <span class="anchor" id="MIPMap::options"></span>options;</div><p>


</p>
<p>The choice of filtering algorithm and a parameter used by the <tt>EWA</tt> method
are represented by <tt>MIPMapFilterOptions</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapFilterOptionsDefinition-0"></span><div class="fragmentname">&lt;&lt;MIPMapFilterOptions Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">struct <span class="anchor" id="MIPMapFilterOptions"></span>MIPMapFilterOptions {
    <a href="#FilterFunction::EWA" class="code">FilterFunction</a> <span class="anchor" id="MIPMapFilterOptions::filter"></span>filter = <a href="#FilterFunction::EWA" class="code">FilterFunction</a>::EWA;
    Float <span class="anchor" id="MIPMapFilterOptions::maxAnisotropy"></span>maxAnisotropy = 8.f;
};</div><p>


</p>
<p></p>
<span class="anchor" id="fragment-FilterFunctionDefinition-0"></span><div class="fragmentname">&lt;&lt;FilterFunction Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">enum class <span class="anchor" id="FilterFunction"></span>FilterFunction { <span class="anchor" id="FilterFunction::Point"></span>Point, <span class="anchor" id="FilterFunction::Bilinear"></span>Bilinear, <span class="anchor" id="FilterFunction::Trilinear"></span>Trilinear, <span class="anchor" id="FilterFunction::EWA"></span>EWA };</div><p>


</p>
<p>A few simple utility methods return information about the image pyramid and
the <tt>MIPMap</tt>&rsquo;s color space.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapPublicMethods-0"></span><div class="fragmentname">&lt;&lt;MIPMap Public Methods&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> <span class="anchor" id="MIPMap::LevelResolution"></span>LevelResolution(int level) const {
    return <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::Resolution" class="code">Resolution</a>();
}
int <span class="anchor" id="MIPMap::Levels"></span>Levels() const { return int(<a href="#MIPMap::pyramid" class="code">pyramid</a>.size()); }
const <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGBColorSpace" class="code">RGBColorSpace</a> *<span class="anchor" id="MIPMap::GetRGBColorSpace"></span>GetRGBColorSpace() const { return <a href="#MIPMap::colorSpace" class="code">colorSpace</a>; }
const <a href="../Utilities/Images.html#Image" class="code">Image</a> &amp;<span class="anchor" id="MIPMap::GetLevel"></span>GetLevel(int level) const { return <a href="#MIPMap::pyramid" class="code">pyramid</a>[level]; }</div><p>


</p>
<p>

</p>
<p>Given the image pyramid, we will define some utility <a href="#MIPMap"><tt>MIPMap</tt></a> methods
that retrieve the texel value at a specified pyramid level and discrete
integer pixel coordinates.  For the <tt>RGB</tt> variant, there is an
implicit assumption that the image channels are laid out in R, G, B (and
maybe A) order.

</p>
<p>

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-1"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-0"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapMethodDefinitions-2"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a> <span class="anchor" id="MIPMap::Texel"></span><a href="#MIPMap" class="code">MIPMap</a>::Texel(int level, <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> st) const {
    if (int nc = <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::NChannels" class="code">NChannels</a>(); nc == 3 || nc == 4)
        return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>(<a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::GetChannel" class="code">GetChannel</a>(st, 0, wrapMode),
                   <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::GetChannel" class="code">GetChannel</a>(st, 1, wrapMode),
                   <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::GetChannel" class="code">GetChannel</a>(st, 2, wrapMode));
    else {
        Float v = <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::GetChannel" class="code">GetChannel</a>(st, 0, wrapMode);
        return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>(v, v, v);
    }
}</div><p>


</p>
<p>The <tt>Float</tt> specialization of <tt>Texel()</tt>, not included here, is
analogous.

</p>
<p>

</p>
<p></p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">
<a href="#ImageMapFiltering"><i class="fas fa-link h3h4marginlink"></i></a>
</div>
<div class="col-md-10 col-lg-8">
<span class="anchor" id="sec:image-map-filtering"></span><span id="ImageMapFiltering"></span><h3>10.4.4  Image Map Filtering</h3><p>



</p>
<p>The <tt>MIPMap</tt> <tt>Filter()</tt> method returns a filtered image function
value at the provided <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> coordinates.  It takes two derivatives that
give the change in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> with respect to image pixel samples.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-2"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-1"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapMethodDefinitions-3"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <span class="anchor" id="MIPMap::Filter"></span><a href="#MIPMap" class="code">MIPMap</a>::<a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#Filter" class="code">Filter</a>(<a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst0, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst1) const {
    if (<a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::filter" class="code">filter</a> != <a href="#FilterFunction::EWA" class="code">FilterFunction</a>::EWA) {
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Handlenon-EWAMIPMapfilter-0">Handle non-EWA MIP Map filter</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1498" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1498"><i></i></a><div id="fragbit-1498" class="collapse show"><div class="fragmentcode">           Float width = 2 * std::max({std::abs(dst0[0]), std::abs(dst0[1]),
                                       std::abs(dst1[0]), std::abs(dst1[1])});
           &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputeMIPMaplevelformonowidthandhandleverywidefilter-0">Compute MIP Map level for <tt>width</tt> and handle very wide filter</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1499" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1499"><i></i></a><div id="fragbit-1499" class="collapse show"><div class="fragmentcode">              int nLevels = <a href="#MIPMap::Levels" class="code">Levels</a>();
              Float level = nLevels - 1 + <a href="../Utilities/Mathematical_Infrastructure.html#Log2" class="code">Log2</a>(std::max&lt;Float&gt;(width, 1e-8));
              if (level &gt;= <a href="#MIPMap::Levels" class="code">Levels</a>() - 1)
                  return <a href="#MIPMap::Texel" class="code">Texel</a>&lt;T&gt;(<a href="#MIPMap::Levels" class="code">Levels</a>() - 1, <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(0, 0));
              int iLevel = std::max(0, int(pstd::floor(level)));</div></div>
           if (<a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::filter" class="code">filter</a> == <a href="#FilterFunction::Bilinear" class="code">FilterFunction</a>::Point) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Returnpoint-sampledvalueatselectedMIPlevel-0">Return point-sampled value at selected MIP level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1500" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1500"><i></i></a><div id="fragbit-1500" class="collapse show"><div class="fragmentcode">                  <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution = <a href="#MIPMap::LevelResolution" class="code">LevelResolution</a>(iLevel);
                  <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> sti(pstd::round(st[0] * resolution[0] - 0.5f),
                              pstd::round(st[1] * resolution[1] - 0.5f));
                  return <a href="#MIPMap::Texel" class="code">Texel</a>&lt;T&gt;(iLevel, sti);</div></div>
           } else if (<a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::filter" class="code">filter</a> == <a href="#FilterFunction::Bilinear" class="code">FilterFunction</a>::Bilinear) {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Returnbilinear-filteredvalueatselectedMIPlevel-0">Return bilinear-filtered value at selected MIP level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1501" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1501"><i></i></a><div id="fragbit-1501" class="collapse show"><div class="fragmentcode">                  return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel, st);</div></div>
           } else {
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Returntrilinear-filteredvalueatselectedMIPlevel-0">Return trilinear-filtered value at selected MIP level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1502" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1502"><i></i></a><div id="fragbit-1502" class="collapse show"><div class="fragmentcode">                  if (iLevel == 0)
                      return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(0, st);
                  else
                      return <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(level - iLevel, <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel, st),
                                  <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel + 1, st));
                  </div></div>
           }</div></div>
    }
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ComputeEWAellipseaxes-0">Compute EWA ellipse axes</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1503" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1503"><i></i></a><div id="fragbit-1503" class="collapse show"><div class="fragmentcode">       if (<a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(dst0) &lt; <a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(dst1))
           pstd::swap(dst0, dst1);
       Float longerVecLength = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(dst0), shorterVecLength = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(dst1);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Clampellipsevectorratioiftoolarge-0">Clamp ellipse vector ratio if too large</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1504" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1504"><i></i></a><div id="fragbit-1504" class="collapse show"><div class="fragmentcode">       if (shorterVecLength * <a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::maxAnisotropy" class="code">maxAnisotropy</a> &lt; longerVecLength &amp;&amp;
           shorterVecLength &gt; 0) {
           Float scale = longerVecLength /
               (shorterVecLength * <a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::maxAnisotropy" class="code">maxAnisotropy</a>);
           dst1 *= scale;
           shorterVecLength *= scale;
       }
       if (shorterVecLength == 0)
           return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(0, st);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ChooselevelofdetailforEWAlookupandperformEWAfiltering-0">Choose level of detail for EWA lookup and perform EWA filtering</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1505" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1505"><i></i></a><div id="fragbit-1505" class="collapse show"><div class="fragmentcode">       Float lod = std::max&lt;Float&gt;(0, <a href="#MIPMap::Levels" class="code">Levels</a>() - 1 + <a href="../Utilities/Mathematical_Infrastructure.html#Log2" class="code">Log2</a>(shorterVecLength));
       int ilod = pstd::floor(lod);
       return <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(lod - ilod, <a href="#MIPMap::EWA" class="code">EWA</a>&lt;T&gt;(ilod, st, dst0, dst1),
                   <a href="#MIPMap::EWA" class="code">EWA</a>&lt;T&gt;(ilod + 1, st, dst0, dst1));</div></div>
}</div><p>


</p>
<p>The <tt>EWA</tt> filtering technique to be described shortly uses both
derivatives of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> to compute an <em>anisotropic filter</em>&mdash;one that
filters by different amounts in the different dimensions.  The other three
use an <em>isotropic filter</em> that filters both equally.  The isotropic
filters are more
computationally efficient than the anisotropic filter,
though they do not give results that are as good.
For them, only a single value is needed to specify the width of the
filter.  The width here is conservatively chosen to avoid aliasing in both
the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> directions, though this choice means that textures viewed
at an oblique angle will appear blurry, since the required sampling rate
in one direction will be very different from the sampling rate along the
other in this case.

</p>
<p></p>
<span class="anchor" id="fragment-Handlenon-EWAMIPMapfilter-0"></span><div class="fragmentname">&lt;&lt;Handle non-EWA MIP Map filter&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float width = 2 * std::max({std::abs(dst0[0]), std::abs(dst0[1]),
                            std::abs(dst1[0]), std::abs(dst1[1])});
&lt;&lt;<span class="fragmentname"><a href="#fragment-ComputeMIPMaplevelformonowidthandhandleverywidefilter-0">Compute MIP Map level for <tt>width</tt> and handle very wide filter</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1506" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1506"><i></i></a><div id="fragbit-1506" class="collapse show"><div class="fragmentcode">   int nLevels = <a href="#MIPMap::Levels" class="code">Levels</a>();
   Float level = nLevels - 1 + <a href="../Utilities/Mathematical_Infrastructure.html#Log2" class="code">Log2</a>(std::max&lt;Float&gt;(width, 1e-8));
   if (level &gt;= <a href="#MIPMap::Levels" class="code">Levels</a>() - 1)
       return <a href="#MIPMap::Texel" class="code">Texel</a>&lt;T&gt;(<a href="#MIPMap::Levels" class="code">Levels</a>() - 1, <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(0, 0));
   int iLevel = std::max(0, int(pstd::floor(level)));</div></div>
if (<a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::filter" class="code">filter</a> == <a href="#FilterFunction::Bilinear" class="code">FilterFunction</a>::Point) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Returnpoint-sampledvalueatselectedMIPlevel-0">Return point-sampled value at selected MIP level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1507" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1507"><i></i></a><div id="fragbit-1507" class="collapse show"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution = <a href="#MIPMap::LevelResolution" class="code">LevelResolution</a>(iLevel);
       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> sti(pstd::round(st[0] * resolution[0] - 0.5f),
                   pstd::round(st[1] * resolution[1] - 0.5f));
       return <a href="#MIPMap::Texel" class="code">Texel</a>&lt;T&gt;(iLevel, sti);</div></div>
} else if (<a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::filter" class="code">filter</a> == <a href="#FilterFunction::Bilinear" class="code">FilterFunction</a>::Bilinear) {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Returnbilinear-filteredvalueatselectedMIPlevel-0">Return bilinear-filtered value at selected MIP level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1508" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1508"><i></i></a><div id="fragbit-1508" class="collapse show"><div class="fragmentcode">       return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel, st);</div></div>
} else {
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Returntrilinear-filteredvalueatselectedMIPlevel-0">Return trilinear-filtered value at selected MIP level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1509" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1509"><i></i></a><div id="fragbit-1509" class="collapse show"><div class="fragmentcode">       if (iLevel == 0)
           return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(0, st);
       else
           return <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(level - iLevel, <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel, st),
                       <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel + 1, st));
       </div></div>
}</div><p>


</p>
<p>Because filtering over many texels for wide filter widths would be
inefficient, this method chooses a MIP map level from the pyramid such that
the filter region at that level would cover four texels at that level.
Figure&nbsp;<a href="#fig:mipmap-trilerp">10.17</a> illustrates this idea.

</p>
<p> </p>
<span class="anchor" id="fig:mipmap-trilerp"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha10f17.svg" title=""><img src="pha10f17.svg" width=673 height=169 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.17: Choosing a MIP Map Level for the Triangle
Filter. <span class="legend"> The <tt>MIPMap</tt> chooses a level such that the filter
covers four texels.</span>
</figcaption>
</div></div><p>


</p>
<p>Since the resolutions of the levels of the pyramid are all powers of two, the
resolution of level <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.693ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 298.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D459" x="0" y="0"></use>
</g>
</svg> is <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.639ex" height="2.676ex" style="vertical-align: -0.338ex;" viewBox="0 -1006.6 4580.5 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">2 Superscript normal n normal upper L normal e normal v normal e normal l normal s minus 1 minus l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-4C" d="M582 258l-28 -258h-521v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31c35 -3 113 -3 152 -3c41 0 132 0 168 3v-31h-33c-95 0 -95 -14 -95 -48v-533c0 -33 2 -40 49 -40h82c176 0 190 125 201 227h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-76" d="M508 400c-66 -1 -83 -44 -92 -67l-131 -325c-4 -10 -8 -19 -21 -19s-15 5 -21 19l-144 355c-13 31 -17 37 -80 37v31c30 -2 70 -3 97 -3l109 3v-31c-18 0 -57 0 -57 -26c0 0 0 -4 6 -17l112 -279l102 255c4 11 6 15 6 24c0 19 -11 42 -48 43v31l87 -3c23 0 52 1 75 3v-31 Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,393)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-4C" x="556" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="1182" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-76" x="1626" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="2155" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6C" x="2599" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-73" x="2878" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="3272" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="4051" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="4551" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D459" x="5330" y="0"></use>
</g>
</g>
</svg>.  Therefore, to find the
level with a texel spacing width <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 716.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">w</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D464" d="M691 372c0 -48 -32 -182 -66 -260c-26 -60 -70 -123 -145 -123c-30 0 -99 6 -125 70c-40 -70 -87 -70 -104 -70c-75 0 -142 35 -142 126c0 38 12 84 56 202c7 17 18 45 18 70c0 32 -16 33 -25 33c-35 0 -74 -31 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c49 0 82 -37 82 -82c0 -20 -6 -34 -17 -64c-47 -123 -52 -162 -52 -194c0 -17 0 -91 80 -91c39 0 69 31 92 84c-1 5 -1 7 -1 18c0 18 2 36 9 66c7 26 54 217 57 224c7 20 25 28 37 28c15 0 29 -9 29 -27c0 -6 -10 -43 -15 -65l-42 -168 c-4 -14 -11 -45 -11 -73c0 -57 27 -87 74 -87c49 0 84 35 110 88c26 51 55 149 55 183c0 48 -25 74 -36 85c-9 8 -15 14 -15 27c0 22 25 48 50 48c17 0 44 -15 44 -70Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D464" x="0" y="0"></use>
</g>
</svg> requires solving
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.237ex" height="5.176ex" style="vertical-align: -1.838ex;" viewBox="0 -1437.2 6991 2228.5" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction 1 Over w EndFraction equals 2 Superscript normal n normal upper L normal e normal v normal e normal l normal s minus 1 minus l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D464" d="M691 372c0 -48 -32 -182 -66 -260c-26 -60 -70 -123 -145 -123c-30 0 -99 6 -125 70c-40 -70 -87 -70 -104 -70c-75 0 -142 35 -142 126c0 38 12 84 56 202c7 17 18 45 18 70c0 32 -16 33 -25 33c-35 0 -74 -31 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c49 0 82 -37 82 -82c0 -20 -6 -34 -17 -64c-47 -123 -52 -162 -52 -194c0 -17 0 -91 80 -91c39 0 69 31 92 84c-1 5 -1 7 -1 18c0 18 2 36 9 66c7 26 54 217 57 224c7 20 25 28 37 28c15 0 29 -9 29 -27c0 -6 -10 -43 -15 -65l-42 -168 c-4 -14 -11 -45 -11 -73c0 -57 27 -87 74 -87c49 0 84 35 110 88c26 51 55 149 55 183c0 48 -25 74 -36 85c-9 8 -15 14 -15 27c0 22 25 48 50 48c17 0 44 -15 44 -70Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-4C" d="M582 258l-28 -258h-521v31h24c77 0 79 11 79 47v527c0 36 -2 47 -79 47h-24v31c35 -3 113 -3 152 -3c41 0 132 0 168 3v-31h-33c-95 0 -95 -14 -95 -48v-533c0 -33 2 -40 49 -40h82c176 0 190 125 201 227h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-76" d="M508 400c-66 -1 -83 -44 -92 -67l-131 -325c-4 -10 -8 -19 -21 -19s-15 5 -21 19l-144 355c-13 31 -17 37 -80 37v31c30 -2 70 -3 97 -3l109 3v-31c-18 0 -57 0 -57 -26c0 0 0 -4 6 -17l112 -279l102 255c4 11 6 15 6 24c0 19 -11 42 -48 43v31l87 -3c23 0 52 1 75 3v-31 Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="836" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="168" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D464" x="60" y="-686"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="1354" y="0"></use>
<g transform="translate(2410,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
<g transform="translate(500,412)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6E" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-4C" x="556" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="1182" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-76" x="1626" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="2155" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6C" x="2599" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-73" x="2878" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="3272" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-31" x="4051" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="4551" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D459" x="5330" y="0"></use>
</g>
</g>
</g>
</svg>
</div>
<p>

for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.693ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 298.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D459" x="0" y="0"></use>
</g>
</svg>.  In general, this will be a floating-point value between two MIP
map levels.  Values of <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.693ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 298.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">l</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D459" d="M258 683l-144 -578c-5 -19 -6 -24 -6 -48c0 -14 0 -46 30 -46c40 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -12 -60 -30 -98c-17 -36 -42 -56 -75 -56c-47 0 -91 35 -91 92c0 16 2 23 5 34l126 500l3 20c0 8 -1 17 -49 17c-15 0 -25 0 -25 11 c0 19 11 20 19 21c26 2 99 10 122 10c13 0 13 -11 13 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D459" x="0" y="0"></use>
</g>
</svg> greater than the number of pyramid levels
correspond to a filter width wider than the image, in which case the single
pixel at the top level is returned.

</p>
<p></p>
<span class="anchor" id="fragment-ComputeMIPMaplevelformonowidthandhandleverywidefilter-0"></span><div class="fragmentname">&lt;&lt;Compute MIP Map level for <tt>width</tt> and handle very wide filter&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">int nLevels = <a href="#MIPMap::Levels" class="code">Levels</a>();
Float level = nLevels - 1 + <a href="../Utilities/Mathematical_Infrastructure.html#Log2" class="code">Log2</a>(std::max&lt;Float&gt;(width, 1e-8));
if (level &gt;= <a href="#MIPMap::Levels" class="code">Levels</a>() - 1)
    return <a href="#MIPMap::Texel" class="code">Texel</a>&lt;T&gt;(<a href="#MIPMap::Levels" class="code">Levels</a>() - 1, <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a>(0, 0));
int iLevel = std::max(0, int(pstd::floor(level)));</div><p>


</p>
<p>For a point-sampled texture lookup, it is only necessary to convert the
continuous texture coordinates over <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg> to discrete coordinates over
the image resolution and to retrieve the appropriate texel value via
the <tt>MIPMap</tt>&rsquo;s <tt>Texel()</tt> method.

</p>
<p></p>
<span class="anchor" id="fragment-Returnpoint-sampledvalueatselectedMIPlevel-0"></span><div class="fragmentname">&lt;&lt;Return point-sampled value at selected MIP level&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> resolution = <a href="#MIPMap::LevelResolution" class="code">LevelResolution</a>(iLevel);
<a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> sti(pstd::round(st[0] * resolution[0] - 0.5f),
            pstd::round(st[1] * resolution[1] - 0.5f));
return <a href="#MIPMap::Texel" class="code">Texel</a>&lt;T&gt;(iLevel, sti);</div><p>


</p>
<p>Bilinear filtering, which is equivalent to filtering using a triangle
filter, is easily implemented via a call to <tt>Bilerp()</tt>.

</p>
<p></p>
<span class="anchor" id="fragment-Returnbilinear-filteredvalueatselectedMIPlevel-0"></span><div class="fragmentname">&lt;&lt;Return bilinear-filtered value at selected MIP level&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel, st);</div><p>


</p>
<p>Bilinear interpolation is provided in a separate method so that it can also
be used for trilinear filtering.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-3"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-2"><span class="fa fa-caret-up"></span></a>&nbsp;<a href="#fragment-MIPMapMethodDefinitions-4"><span class="fa fa-caret-down"></span></a></div>
<div class="fragmentcode">template &lt;&gt;
<a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a> <span class="anchor" id="MIPMap::Bilerp"></span><a href="#MIPMap" class="code">MIPMap</a>::Bilerp(int level, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st) const {
    if (int nc = <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::NChannels" class="code">NChannels</a>(); nc == 3 || nc == 4)
        return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>(<a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(st, 0, wrapMode),
                   <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(st, 1, wrapMode),
                   <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(st, 2, wrapMode));
    else {
        Float v = <a href="#MIPMap::pyramid" class="code">pyramid</a>[level].<a href="../Utilities/Images.html#Image::BilerpChannel" class="code">BilerpChannel</a>(st, 0, wrapMode);
        return <a href="../Radiometry,_Spectra,_and_Color/Color.html#RGB" class="code">RGB</a>(v, v, v);
    }
}</div><p>


</p>
<p>As shown by Figure&nbsp;<a href="#fig:mipmap-trilerp">10.17</a>, applying a triangle filter to
the four texels around the sample point will either filter over too small a
region or too large a region (except for very carefully selected filter
widths).  Therefore, the <tt>Trilinear</tt> filtering option applies the
triangle filter at both of these levels and blends between them according
to how close <tt>level</tt> is to each of them.  This helps hide the
transitions from one MIP map level to the next at nearby pixels in the
final image.  While applying a triangle filter to four texels at two levels
in this manner does not generally give exactly the same result as applying
a triangle filter to the original pixels, the difference is not too bad in
practice, and the efficiency of this approach is worth this penalty.  In
any case, the following elliptically weighted average filtering approach
should be used when texture quality is important.

</p>
<p></p>
<span class="anchor" id="fragment-Returntrilinear-filteredvalueatselectedMIPlevel-0"></span><div class="fragmentname">&lt;&lt;Return trilinear-filtered value at selected MIP level&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (iLevel == 0)
    return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(0, st);
else
    return <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(level - iLevel, <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel, st),
                <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(iLevel + 1, st));
</div><p>


</p>
<p>The elliptically weighted average (EWA) algorithm fits an ellipse to the
two differential vectors in texture space and
then filters the texture with a Gaussian filter function
(Figure&nbsp;<a href="#fig:ewa-ellipse-axes">10.18</a>). It is widely regarded as one of the
best texture filtering algorithms in graphics and has been carefully
derived from the basic principles of sampling theory.  Unlike the triangle
filter, it can filter over arbitrarily oriented
regions of the texture, with different filter
extents in different directions.  The quality of its results is improved
by it being an anisotropic filter, since it can adapt to different sampling
rates along the two image axes.

</p>
<p></p>
<span class="anchor" id="fig:ewa-ellipse-axes"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha10f18.svg" title=""><img src="pha10f18.svg" width=280 height=225 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.18: <span class="legend"> The EWA filter applies a Gaussian
filter to the texels in an elliptical area around the evaluation point.
The extent of the ellipse is such that its edge passes through the positions of
the adjacent texture samples as estimated by the texture coordinate partial
derivatives.</span>
</figcaption>
</div></div><p>


</p>
<p>

</p>
<p>
We will not show the full derivation of this filter here, although we do note
that it is distinguished by being a <em>unified resampling filter</em>: it
simultaneously computes the result of a Gaussian filtered texture function
convolved with a Gaussian reconstruction filter in image space.  This is in
contrast to many other texture filtering methods that ignore the effect of
the image-space filter or equivalently assume that it is a box.  Even if a
Gaussian is not being used for filtering the samples for the image being
rendered, taking some account of the spatial variation of the image filter
improves the results, assuming that the filter being used is somewhat
similar in shape to the Gaussian, as the Mitchell and windowed sinc filters&nbsp;are.

</p>
<p>The screen-space partial derivatives of the texture coordinates define the
ellipse.  The lookup method starts out by determining which of the
two axes is the longer of the two,
swapping them if needed so that <tt>dst0</tt> is the longer vector.  The
length of the shorter vector will be used to select a MIP map level.

</p>
<p></p>
<span class="anchor" id="fragment-ComputeEWAellipseaxes-0"></span><div class="fragmentname">&lt;&lt;Compute EWA ellipse axes&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (<a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(dst0) &lt; <a href="../Geometry_and_Transformations/Vectors.html#LengthSquared" class="code">LengthSquared</a>(dst1))
    pstd::swap(dst0, dst1);
Float longerVecLength = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(dst0), shorterVecLength = <a href="../Geometry_and_Transformations/Vectors.html#Length" class="code">Length</a>(dst1);</div><p>


</p>
<p>Next the ratio of
the length of the longer vector to the length of the shorter one is considered.  A large
ratio indicates a very long and skinny ellipse.  Because this method
filters texels from a MIP map level chosen based on the length of the shorter
differential vector, a large ratio means that a large number of texels need to be
filtered.  To avoid this expense (and to ensure that any EWA lookup takes a
bounded amount of time), the length of the shorter vector may be increased to limit
this ratio.  The result may be an increase in blurring,
although this effect usually is not noticeable in practice.

</p>
<p></p>
<span class="anchor" id="fragment-Clampellipsevectorratioiftoolarge-0"></span><div class="fragmentname">&lt;&lt;Clamp ellipse vector ratio if too large&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">if (shorterVecLength * <a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::maxAnisotropy" class="code">maxAnisotropy</a> &lt; longerVecLength &amp;&amp;
    shorterVecLength &gt; 0) {
    Float scale = longerVecLength /
        (shorterVecLength * <a href="#MIPMap::options" class="code">options</a>.<a href="#MIPMapFilterOptions::maxAnisotropy" class="code">maxAnisotropy</a>);
    dst1 *= scale;
    shorterVecLength *= scale;
}
if (shorterVecLength == 0)
    return <a href="#MIPMap::Bilerp" class="code">Bilerp</a>&lt;T&gt;(0, st);</div><p>


</p>
<p>
Like the triangle filter, the EWA filter uses the image pyramid to reduce
the number of texels to be filtered for a particular texture lookup, 
choosing a MIP map level based on the length of the shorter vector.  Given the
limited ratio from the clamping above, the total
number of texels used is thus bounded.  Given the length of the shorter vector,
the computation to find the appropriate pyramid level is the same as was
used for the triangle filter.  Similarly, the implementation here blends
between the filtered results at the two levels around the computed level of
detail, again to reduce artifacts from transitions from one level to
another.

</p>
<p></p>
<span class="anchor" id="fragment-ChooselevelofdetailforEWAlookupandperformEWAfiltering-0"></span><div class="fragmentname">&lt;&lt;Choose level of detail for EWA lookup and perform EWA filtering&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float lod = std::max&lt;Float&gt;(0, <a href="#MIPMap::Levels" class="code">Levels</a>() - 1 + <a href="../Utilities/Mathematical_Infrastructure.html#Log2" class="code">Log2</a>(shorterVecLength));
int ilod = pstd::floor(lod);
return <a href="../Monte_Carlo_Integration/Sampling_Using_the_Inversion_Method.html#Lerp" class="code">Lerp</a>(lod - ilod, <a href="#MIPMap::EWA" class="code">EWA</a>&lt;T&gt;(ilod, st, dst0, dst1),
            <a href="#MIPMap::EWA" class="code">EWA</a>&lt;T&gt;(ilod + 1, st, dst0, dst1));</div><p>


</p>
<p>The <a href="#MIPMap::EWA"><tt>MIPMap::EWA()</tt></a> method actually applies the filter at a particular
level.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapMethodDefinitions-4"></span><div class="fragmentname">&lt;&lt;MIPMap Method Definitions&gt;&gt;+=&nbsp;<a href="#fragment-MIPMapMethodDefinitions-3"><span class="fa fa-caret-up"></span></a></div>
<div class="fragmentcode">template &lt;typename T&gt;
T <span class="anchor" id="MIPMap::EWA"></span><a href="#MIPMap" class="code">MIPMap</a>::EWA(int level, <a href="../Geometry_and_Transformations/Points.html#Point2f" class="code">Point2f</a> st, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst0, <a href="../Geometry_and_Transformations/Vectors.html#Vector2f" class="code">Vector2f</a> dst1) const {
    if (level &gt;= <a href="#MIPMap::Levels" class="code">Levels</a>())
        return <a href="#MIPMap::Texel" class="code">Texel</a>&lt;T&gt;(<a href="#MIPMap::Levels" class="code">Levels</a>() - 1, {0, 0});
    &lt;&lt;<span class="fragmentname"><a href="#fragment-ConvertEWAcoordinatestoappropriatescaleforlevel-0">Convert EWA coordinates to appropriate scale for level</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1510" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1510"><i></i></a><div id="fragbit-1510" class="collapse show"><div class="fragmentcode">       <a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> levelRes = <a href="#MIPMap::LevelResolution" class="code">LevelResolution</a>(level);
       st[0] = st[0] * levelRes[0] - 0.5f;
       st[1] = st[1] * levelRes[1] - 0.5f;
       dst0[0] *= levelRes[0];
       dst0[1] *= levelRes[1];
       dst1[0] *= levelRes[0];
       dst1[1] *= levelRes[1];</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-FindellipsecoefficientsthatboundEWAfilterregion-0">Find ellipse coefficients that bound EWA filter region</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1511" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1511"><i></i></a><div id="fragbit-1511" class="collapse show"><div class="fragmentcode">       Float A = <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst0[1]) + <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst1[1]) + 1;
       Float B = -2 * (dst0[0] * dst0[1] + dst1[0] * dst1[1]);
       Float C = <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst0[0]) + <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst1[0]) + 1;
       Float invF = 1 / (A * C - <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(B) * 0.25f);
       A *= invF;
       B *= invF;
       C *= invF;</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Computetheellipsesstboundingboxintexturespace-0">Compute the ellipse&rsquo;s <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> bounding box in texture space</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1512" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1512"><i></i></a><div id="fragbit-1512" class="collapse show"><div class="fragmentcode">       Float det = -<a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(B) + 4 * A * C;
       Float invDet = 1 / det;
       Float uSqrt = <a href="../Utilities/Mathematical_Infrastructure.html#SafeSqrt" class="code">SafeSqrt</a>(det * C), vSqrt = <a href="../Utilities/Mathematical_Infrastructure.html#SafeSqrt" class="code">SafeSqrt</a>(A * det);
       int s0 = pstd::ceil(st[0] - 2 * invDet * uSqrt);
       int s1 = pstd::floor(st[0] + 2 * invDet * uSqrt);
       int t0 = pstd::ceil(st[1] - 2 * invDet * vSqrt);
       int t1 = pstd::floor(st[1] + 2 * invDet * vSqrt);</div></div>
    &lt;&lt;<span class="fragmentname"><a href="#fragment-Scanoverellipseboundandevaluatequadraticequationtofilterimage-0">Scan over ellipse bound and evaluate quadratic equation to filter image</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1513" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1513"><i></i></a><div id="fragbit-1513" class="collapse show"><div class="fragmentcode">       T sum{};
       Float sumWts = 0;
       for (int it = t0; it &lt;= t1; ++it) {
           Float tt = it - st[1];
           for (int is = s0; is &lt;= s1; ++is) {
               Float ss = is - st[0];
               &lt;&lt;<span class="fragmentname"><a href="#fragment-Computesquaredradiusandfiltertexelifitisinsidetheellipse-0">Compute squared radius and filter texel if it is inside the ellipse</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1514" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1514"><i></i></a><div id="fragbit-1514" class="collapse show"><div class="fragmentcode">                  Float r2 = A * <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(ss) + B * ss * tt + C * <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(tt);
                  if (r2 &lt; 1) {
                      int index = std::min&lt;int&gt;(r2 * MIPFilterLUTSize, MIPFilterLUTSize - 1);
                      Float weight = MIPFilterLUT[index];
                      sum += weight * Texel&lt;T&gt;(level, {is, it});
                      sumWts += weight;
                  }</div></div>
           }
       }
       return sum / sumWts;</div></div>
}</div><p>


</p>
<p>This method first converts from texture coordinates in <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.653ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2003.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-bracket 0 comma 1 right-bracket</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-5B" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="278" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="779" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1724" y="0"></use>
</g>
</svg> to coordinates
and differentials in terms of the resolution of the chosen MIP map level.  It
also subtracts <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.972ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 1279.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">0.5</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-35" d="M449 201c0 -127 -102 -223 -218 -223c-112 0 -181 97 -181 183c0 46 35 53 49 53c33 0 50 -25 50 -49s-17 -49 -50 -49c-11 0 -14 1 -17 2c17 -59 74 -112 147 -112c46 0 83 26 107 65c24 42 24 102 24 137c0 50 -2 89 -18 126c-8 18 -33 64 -85 64 c-81 0 -118 -54 -129 -70c-4 -6 -6 -9 -13 -9c-14 0 -14 8 -14 26v296c0 16 0 24 10 24c0 0 4 0 12 -3c47 -21 93 -28 133 -28c67 0 116 20 136 29c5 3 8 3 8 3c7 0 10 -5 10 -11c0 -13 -70 -104 -193 -104c-32 0 -65 7 -85 13v-195c36 35 79 51 127 51 c108 0 190 -100 190 -219Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-30"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-35" x="779" y="0"></use>
</g>
</svg> from the continuous position coordinate to align the
sample point with the discrete texel coordinates, as was done in
<a href="#MIPMap::Bilerp"><tt>MIPMap::Bilerp()</tt></a>.
 
</p>
<span class="anchor" id="fragment-ConvertEWAcoordinatestoappropriatescaleforlevel-0"></span><div class="fragmentname">&lt;&lt;Convert EWA coordinates to appropriate scale for level&gt;&gt;=&nbsp;</div>
<div class="fragmentcode"><a href="../Geometry_and_Transformations/Points.html#Point2i" class="code">Point2i</a> levelRes = <a href="#MIPMap::LevelResolution" class="code">LevelResolution</a>(level);
st[0] = st[0] * levelRes[0] - 0.5f;
st[1] = st[1] * levelRes[1] - 0.5f;
dst0[0] *= levelRes[0];
dst0[1] *= levelRes[1];
dst1[0] *= levelRes[0];
dst1[1] *= levelRes[1];</div><p>


</p>
<p>It next computes the coefficients of the implicit equation for
the ellipse centered at the origin that is defined by the vectors <tt>(ds0,dt0)</tt> and <tt>(ds1,dt1)</tt>.
Placing the ellipse at the origin rather than at <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> simplifies
the implicit equation and the computation of its coefficients and can be
easily corrected for when the equation is evaluated later.  The general form of
the implicit equation for all points <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> inside such an ellipse is
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.362ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 13503 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e left-parenthesis s comma t right-parenthesis equals upper A s squared plus upper B s t plus upper C t squared less-than upper F comma</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D434" d="M721 20c0 -20 -12 -20 -18 -20c-25 0 -88 3 -113 3c-41 0 -84 -3 -125 -3c0 0 -14 0 -14 11c0 20 10 20 24 20c20 0 72 3 72 33c0 10 -14 146 -16 167h-251c-68 -116 -69 -116 -76 -128c-8 -14 -14 -25 -14 -37c0 -25 24 -33 47 -35c7 0 16 -1 16 -12 c0 -19 -13 -19 -19 -19c-32 0 -67 3 -100 3c-28 0 -59 -3 -86 -3c-8 0 -13 5 -13 11c0 19 9 19 21 20c44 3 83 17 123 84l348 584c6 10 10 17 26 17c17 0 17 -4 19 -24l61 -625c3 -29 3 -36 65 -36c13 0 23 0 23 -11zM528 262l-32 330l-197 -330h229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D435" d="M756 545c0 -95 -105 -169 -209 -188c97 -11 155 -69 155 -141c0 -98 -118 -216 -276 -216h-357c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 10 20 29 20h336 c120 0 186 -64 186 -138zM665 549c0 44 -21 103 -109 103h-129c-43 0 -45 -3 -54 -38l-62 -248h146c122 0 208 95 208 183zM609 227c0 43 -19 117 -115 117h-189l-69 -279c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h136c118 0 207 97 207 196Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D436" d="M760 695l-63 -255c-5 -18 -5 -20 -18 -20c-4 0 -15 0 -15 10s3 11 3 51c0 116 -59 193 -161 193c-89 0 -183 -50 -244 -121c-100 -117 -121 -279 -121 -336c0 -156 106 -208 196 -208c52 0 115 17 184 73c69 58 92 129 101 158c2 8 7 10 13 10c0 0 12 0 12 -10 c0 -3 -17 -94 -110 -176c-53 -46 -129 -86 -216 -86c-153 0 -271 109 -271 274c0 232 225 453 448 453c111 0 157 -75 166 -89l70 77c11 11 12 12 15 12c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3C" d="M689 -9c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D439" d="M748 653l-20 -173c-2 -19 -3 -25 -14 -25c-9 0 -12 7 -12 12c0 3 0 5 2 18c3 27 3 31 3 54c0 77 -23 110 -146 110h-132c-44 0 -45 -4 -54 -39l-64 -254h91c85 0 108 18 129 96c4 16 5 21 15 21s12 -11 12 -11c0 -3 0 -5 -3 -16l-55 -217c-5 -18 -5 -21 -15 -21 c-6 0 -12 4 -12 12c0 0 1 6 3 11c7 30 7 42 7 49c0 29 -8 45 -83 45h-97l-62 -249c-4 -15 -4 -23 -4 -23c0 -13 3 -17 32 -20c25 -2 30 -2 52 -2c23 0 25 0 28 -1c0 0 6 -3 6 -11c0 -19 -12 -19 -21 -19l-149 3l-132 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47 l132 529c5 18 5 20 5 24c0 18 -28 18 -65 18c-19 0 -28 0 -28 11c0 20 10 20 30 20h490c25 0 30 0 27 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="466" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="856" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1325" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1770" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2799" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="3855" y="0"></use>
<g transform="translate(4606,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="663" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="5751" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D435" x="6752" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="7512" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="7981" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="8565" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D436" x="9566" y="0"></use>
<g transform="translate(10326,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="511" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3C" x="11419" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="12475" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="13224" y="0"></use>
</g>
</svg>
</div>
<p>

although it is more computationally efficient to divide through by
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.738ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 748.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper F</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D439" d="M748 653l-20 -173c-2 -19 -3 -25 -14 -25c-9 0 -12 7 -12 12c0 3 0 5 2 18c3 27 3 31 3 54c0 77 -23 110 -146 110h-132c-44 0 -45 -4 -54 -39l-64 -254h91c85 0 108 18 129 96c4 16 5 21 15 21s12 -11 12 -11c0 -3 0 -5 -3 -16l-55 -217c-5 -18 -5 -21 -15 -21 c-6 0 -12 4 -12 12c0 0 1 6 3 11c7 30 7 42 7 49c0 29 -8 45 -83 45h-97l-62 -249c-4 -15 -4 -23 -4 -23c0 -13 3 -17 32 -20c25 -2 30 -2 52 -2c23 0 25 0 28 -1c0 0 6 -3 6 -11c0 -19 -12 -19 -21 -19l-149 3l-132 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47 l132 529c5 18 5 20 5 24c0 18 -28 18 -65 18c-19 0 -28 0 -28 11c0 20 10 20 30 20h490c25 0 30 0 27 -27Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="0" y="0"></use>
</g>
</svg> and express this&nbsp;as
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="56.052ex" height="5.343ex" style="vertical-align: -1.838ex;" viewBox="0 -1508.9 24133.2 2300.3" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e left-parenthesis s comma t right-parenthesis equals StartFraction upper A Over upper F EndFraction s squared plus StartFraction upper B Over upper F EndFraction s t plus StartFraction upper C Over upper F EndFraction t squared equals upper A prime s squared plus upper B prime s t plus upper C prime t squared less-than 1 period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D434" d="M721 20c0 -20 -12 -20 -18 -20c-25 0 -88 3 -113 3c-41 0 -84 -3 -125 -3c0 0 -14 0 -14 11c0 20 10 20 24 20c20 0 72 3 72 33c0 10 -14 146 -16 167h-251c-68 -116 -69 -116 -76 -128c-8 -14 -14 -25 -14 -37c0 -25 24 -33 47 -35c7 0 16 -1 16 -12 c0 -19 -13 -19 -19 -19c-32 0 -67 3 -100 3c-28 0 -59 -3 -86 -3c-8 0 -13 5 -13 11c0 19 9 19 21 20c44 3 83 17 123 84l348 584c6 10 10 17 26 17c17 0 17 -4 19 -24l61 -625c3 -29 3 -36 65 -36c13 0 23 0 23 -11zM528 262l-32 330l-197 -330h229Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D439" d="M748 653l-20 -173c-2 -19 -3 -25 -14 -25c-9 0 -12 7 -12 12c0 3 0 5 2 18c3 27 3 31 3 54c0 77 -23 110 -146 110h-132c-44 0 -45 -4 -54 -39l-64 -254h91c85 0 108 18 129 96c4 16 5 21 15 21s12 -11 12 -11c0 -3 0 -5 -3 -16l-55 -217c-5 -18 -5 -21 -15 -21 c-6 0 -12 4 -12 12c0 0 1 6 3 11c7 30 7 42 7 49c0 29 -8 45 -83 45h-97l-62 -249c-4 -15 -4 -23 -4 -23c0 -13 3 -17 32 -20c25 -2 30 -2 52 -2c23 0 25 0 28 -1c0 0 6 -3 6 -11c0 -19 -12 -19 -21 -19l-149 3l-132 -3c-3 0 -15 0 -15 12c0 19 11 19 28 19c79 0 81 8 91 47 l132 529c5 18 5 20 5 24c0 18 -28 18 -65 18c-19 0 -28 0 -28 11c0 20 10 20 30 20h490c25 0 30 0 27 -27Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D435" d="M756 545c0 -95 -105 -169 -209 -188c97 -11 155 -69 155 -141c0 -98 -118 -216 -276 -216h-357c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 10 20 29 20h336 c120 0 186 -64 186 -138zM665 549c0 44 -21 103 -109 103h-129c-43 0 -45 -3 -54 -38l-62 -248h146c122 0 208 95 208 183zM609 227c0 43 -19 117 -115 117h-189l-69 -279c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h136c118 0 207 97 207 196Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D436" d="M760 695l-63 -255c-5 -18 -5 -20 -18 -20c-4 0 -15 0 -15 10s3 11 3 51c0 116 -59 193 -161 193c-89 0 -183 -50 -244 -121c-100 -117 -121 -279 -121 -336c0 -156 106 -208 196 -208c52 0 115 17 184 73c69 58 92 129 101 158c2 8 7 10 13 10c0 0 12 0 12 -10 c0 -3 -17 -94 -110 -176c-53 -46 -129 -86 -216 -86c-153 0 -271 109 -271 274c0 232 225 453 448 453c111 0 157 -75 166 -89l70 77c11 11 12 12 15 12c9 0 11 -7 11 -10Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3C" d="M689 -9c24 -11 7 -47 -18 -36l-581 275c-17 8 -17 32 0 40l581 275c25 11 42 -25 18 -36l-548 -259Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="466" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="856" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1325" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1770" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2799" y="0"></use>
<g transform="translate(3577,0)">
<g transform="translate(397,0)">
<rect stroke="none" width="870" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="60" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="61" y="-701"></use>
</g>
</g>
<g transform="translate(4966,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="663" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="6111" y="0"></use>
<g transform="translate(6890,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="879" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D435" x="60" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="65" y="-701"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="8232" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="8701" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="9285" y="0"></use>
<g transform="translate(10063,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="880" height="60" x="0" y="220"></rect>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D436" x="60" y="676"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D439" x="66" y="-701"></use>
</g>
</g>
<g transform="translate(11406,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="511" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="12499" y="0"></use>
<g transform="translate(13555,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D434" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1061" y="583"></use>
</g>
<g transform="translate(14694,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="663" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="15840" y="0"></use>
<g transform="translate(16840,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D435" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1074" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="17988" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="18458" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="19041" y="0"></use>
<g transform="translate(20042,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D436" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="1094" y="583"></use>
</g>
<g transform="translate(21204,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="511" y="583"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-3C" x="22297" y="0"></use>
<g transform="translate(23354,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-31"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="500" y="0"></use>
</g>
</g>
</svg>
</div>
<p>

We will not derive the equations that give the values of the coefficients,
although the interested reader can easily verify their
correctness.<button style="button" data-toggle="tooltip" data-placement="right" data-html="true" class="btn footnote-button" title="Heckbert&rsquo;s thesis has the original
derivation (Heckbert 1989b, p.&nbsp;80):  A and C have an extra term of 1
added to them so the ellipse is a minimum of one texel
separation wide.  This ensures that the ellipse will not fall between
the texels when magnifying at the most detailed level.">
      <sup>&dagger;</sup>
    </button>
		

</p>
<p></p>
<span class="anchor" id="fragment-FindellipsecoefficientsthatboundEWAfilterregion-0"></span><div class="fragmentname">&lt;&lt;Find ellipse coefficients that bound EWA filter region&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float A = <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst0[1]) + <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst1[1]) + 1;
Float B = -2 * (dst0[0] * dst0[1] + dst1[0] * dst1[1]);
Float C = <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst0[0]) + <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(dst1[0]) + 1;
Float invF = 1 / (A * C - <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(B) * 0.25f);
A *= invF;
B *= invF;
C *= invF;</div><p>


</p>
<p>The next step is to find the axis-aligned bounding box in discrete integer
texel coordinates of the texels that are potentially inside the ellipse.  The
EWA algorithm loops over all of these candidate texels, filtering the
contributions of those that are in fact inside the ellipse.  The bounding box
is found by determining the minimum and maximum values that the ellipse takes in
the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.676ex" style="vertical-align: -0.338ex;" viewBox="0 -576.1 469.5 721.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="2.009ex" style="vertical-align: -0.338ex;" viewBox="0 -719.6 361.5 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
</g>
</svg> directions.  These extrema can be calculated by finding the
partial derivatives <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.061ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2609.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential e slash partial-differential s</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1053" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1553" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="2140" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.81ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2501.5 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">partial-differential e slash partial-differential t</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-2202" d="M515 457c36 -143 15 -479 -223 -479c-140 0 -212 116 -228 178c-8 31 -24 124 38 207c59 78 120 94 181 94c78 0 133 -56 158 -118c2 81 -5 132 -14 171c-33 129 -116 181 -189 181c-29 0 -98 -6 -124 -80c16 0 47 0 56 -35c6 -23 -8 -53 -41 -53c-30 0 -43 21 -46 35 c-7 28 6 158 151 158c123 0 241 -100 281 -259zM432 303c-5 20 -35 132 -144 132c-62 0 -103 -32 -128 -89c-26 -60 -16 -200 -10 -227c3 -10 29 -113 139 -113c154 0 161 225 143 297Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="586" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2F" x="1053" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2202" x="1553" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="2140" y="0"></use>
</g>
</svg>, finding their solutions for <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.351ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2304.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="747" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1803" y="0"></use>
</g>
</svg> and <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.101ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2196.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">t equals 0</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="639" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-30" x="1695" y="0"></use>
</g>
</svg>, and adding the offset to the
ellipse center.  For brevity, we will not include the derivation for these
expressions here.

</p>
<p></p>
<span class="anchor" id="fragment-Computetheellipsesstboundingboxintexturespace-0"></span><div class="fragmentname">&lt;&lt;Compute the ellipse&rsquo;s <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> bounding box in texture space&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float det = -<a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(B) + 4 * A * C;
Float invDet = 1 / det;
Float uSqrt = <a href="../Utilities/Mathematical_Infrastructure.html#SafeSqrt" class="code">SafeSqrt</a>(det * C), vSqrt = <a href="../Utilities/Mathematical_Infrastructure.html#SafeSqrt" class="code">SafeSqrt</a>(A * det);
int s0 = pstd::ceil(st[0] - 2 * invDet * uSqrt);
int s1 = pstd::floor(st[0] + 2 * invDet * uSqrt);
int t0 = pstd::ceil(st[1] - 2 * invDet * vSqrt);
int t1 = pstd::floor(st[1] + 2 * invDet * vSqrt);</div><p>


</p>
<p></p>
<span class="anchor" id="fig:ewa-ellipse-eval"></span><div class="card outerfigure"><div class="card-body figure"><p>



</p>
<div class="figure-row">
  <a href="pha10f19.svg" title=""><img src="pha10f19.svg" width=280 height=225 style="max-width: 100%;"></a>
</div>
<p>


</p>
<figcaption class="caption">Figure 10.19: Finding the <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.103ex" height="2.509ex" style="vertical-align: -0.338ex;" viewBox="0 -934.9 905.4 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">r squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="638" y="513"></use>
</g>
</svg> Ellipse Value for
the EWA Filter Table Lookup.</figcaption>
</div></div><p>


</p>
<p>Now that the bounding box is known, the EWA algorithm loops over the texels,
transforming each one to the coordinate system where the texture lookup
point <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.773ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2055.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="389" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="859" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1304" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="1665" y="0"></use>
</g>
</svg> is at the origin with a translation.  It then evaluates the ellipse
equation to see if the texel is inside the ellipse 
(Figure&nbsp;<a href="#fig:ewa-ellipse-eval">10.19</a>) and computes the filter weight for the texel if so.
The final
filtered value returned is a weighted sum over texels <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.213ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 3536 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">upper T left-parenthesis s prime comma t prime right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="704" y="0"></use>
<g transform="translate(1094,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1951" y="0"></use>
<g transform="translate(2396,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3146" y="0"></use>
</g>
</svg> inside the
ellipse, where <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.283ex" height="2.509ex" style="vertical-align: -0.671ex;" viewBox="0 -791.3 552.5 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">f</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
</g>
</svg> is the Gaussian filter function:
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.007ex" height="6.509ex" style="vertical-align: -2.671ex;" viewBox="0 -1652.5 12058.5 2802.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">StartFraction sigma-summation f left-parenthesis s prime minus s comma t prime minus t right-parenthesis upper T left-parenthesis s prime comma t Superscript prime Baseline right-parenthesis Over sigma-summation f left-parenthesis s prime minus s comma t prime minus t right-parenthesis EndFraction period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNOPERATORS-2211" d="M999 -1l-86 -249h-829c-18 0 -27 0 -27 11c0 4 1 6 9 16l355 439l-365 502c0 31 1 32 28 32h829l86 -234h-25c-70 187 -300 194 -414 194h-396l325 -446c6 -9 7 -10 7 -14s-2 -7 -9 -16l-347 -429h425c147 0 216 24 232 29c85 29 152 90 177 165h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
<g transform="translate(120,0)">
<rect stroke="none" width="11539" height="60" x="0" y="220"></rect>
<g transform="translate(60,770)">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1223" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1775" y="0"></use>
<g transform="translate(2165,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="4245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4715" y="0"></use>
<g transform="translate(5160,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="6132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="7133" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7494" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="7884" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="8588" y="0"></use>
<g transform="translate(8978,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="9835" y="0"></use>
<g transform="translate(10280,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="513"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="11030" y="0"></use>
</g>
<g transform="translate(1827,-771)">
 <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1223" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1775" y="0"></use>
<g transform="translate(2165,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="663" y="408"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="3245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="4245" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="4715" y="0"></use>
<g transform="translate(5160,0)">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="408"></use>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="6132" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="7133" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="7494" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11779" y="0"></use>
</g>
</svg>
</div>
<p>


</p>
<p></p>
<span class="anchor" id="fragment-Scanoverellipseboundandevaluatequadraticequationtofilterimage-0"></span><div class="fragmentname">&lt;&lt;Scan over ellipse bound and evaluate quadratic equation to filter image&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">T sum{};
Float sumWts = 0;
for (int it = t0; it &lt;= t1; ++it) {
    Float tt = it - st[1];
    for (int is = s0; is &lt;= s1; ++is) {
        Float ss = is - st[0];
        &lt;&lt;<span class="fragmentname"><a href="#fragment-Computesquaredradiusandfiltertexelifitisinsidetheellipse-0">Compute squared radius and filter texel if it is inside the ellipse</a></span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1515" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1515"><i></i></a><div id="fragbit-1515" class="collapse show"><div class="fragmentcode">           Float r2 = A * <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(ss) + B * ss * tt + C * <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(tt);
           if (r2 &lt; 1) {
               int index = std::min&lt;int&gt;(r2 * MIPFilterLUTSize, MIPFilterLUTSize - 1);
               Float weight = MIPFilterLUT[index];
               sum += weight * Texel&lt;T&gt;(level, {is, it});
               sumWts += weight;
           }</div></div>
    }
}
return sum / sumWts;</div><p>


</p>
<p>A nice feature of the implicit equation <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.857ex" height="2.843ex" style="vertical-align: -0.838ex;" viewBox="0 -863.1 2521.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">e left-parenthesis s comma t right-parenthesis</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D452" d="M430 107c0 -12 -84 -118 -227 -118c-98 0 -157 79 -157 181c0 175 151 272 262 272c69 0 107 -41 107 -85c0 -14 -5 -73 -75 -103c-50 -21 -124 -23 -153 -23h-53c-15 -61 -16 -92 -16 -104c0 -32 9 -116 87 -116c12 0 121 0 200 99c6 8 8 10 13 10c6 0 12 -7 12 -13z M382 357c0 34 -27 63 -74 63c-26 0 -129 -15 -168 -167h41c41 0 201 0 201 104Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D460" d="M420 356c0 -39 -24 -56 -46 -56s-31 15 -31 29c0 22 20 44 48 45c-15 39 -65 46 -90 46c-88 0 -112 -61 -112 -90c0 -45 40 -52 76 -60c44 -9 73 -14 100 -42c12 -12 31 -37 31 -73c0 -45 -39 -166 -201 -166c-86 0 -143 40 -143 97c0 45 30 66 56 66c21 0 37 -12 37 -35 c0 -28 -25 -58 -63 -53c23 -53 100 -53 114 -53c120 0 143 84 143 110c0 55 -52 66 -104 76c-29 6 -103 21 -103 99c0 44 37 146 169 146c76 0 119 -41 119 -86Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D452" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-28" x="466" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D460" x="856" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1325" y="0"></use>
 <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1770" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-29" x="2132" y="0"></use>
</g>
</svg> is that its value at a
particular texel is the squared ratio of the distance from the center of
the ellipse to the texel to the distance from the center of the ellipse to
the ellipse boundary along the line through that texel
(Figure&nbsp;<a href="#fig:ewa-ellipse-eval">10.19</a>).  This value can be used to index into a
precomputed lookup table of Gaussian filter function values.

</p>
<p></p>
<span class="anchor" id="fragment-Computesquaredradiusandfiltertexelifitisinsidetheellipse-0"></span><div class="fragmentname">&lt;&lt;Compute squared radius and filter texel if it is inside the ellipse&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">Float r2 = A * <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(ss) + B * ss * tt + C * <a href="../Utilities/Mathematical_Infrastructure.html#Sqr" class="code">Sqr</a>(tt);
if (r2 &lt; 1) {
    int index = std::min&lt;int&gt;(r2 * MIPFilterLUTSize, MIPFilterLUTSize - 1);
    Float weight = MIPFilterLUT[index];
    sum += weight * Texel&lt;T&gt;(level, {is, it});
    sumWts += weight;
}</div><p>


</p>
<p>The lookup table is precomputed and available as a constant array.
Similar to the <a href="../Sampling_and_Reconstruction/Image_Reconstruction.html#GaussianFilter"><tt>GaussianFilter</tt></a> used for image reconstruction,
the filter function is offset so that it goes to zero at the end of its extent rather
than having an abrupt step.  It is
</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

<div class="row">
<div class="col-md-1 col-lg-2 leftcolumn">

</div>
<div class="col-md-10 col-lg-8">
<div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.251ex" height="3.176ex" style="vertical-align: -0.505ex;" viewBox="0 -1150.1 5274.5 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript minus alpha r squared Baseline minus normal e Superscript negative alpha Baseline period</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FC" d="M602 383c0 0 -21 -117 -115 -235c-10 -12 -10 -14 -10 -35c0 -24 0 -102 31 -102c0 0 38 0 56 49c3 7 6 10 13 10c6 0 12 -3 12 -10c0 -16 -31 -71 -84 -71c-45 0 -78 31 -91 84c-76 -61 -148 -84 -211 -84c-102 0 -162 76 -162 169c0 141 132 284 269 284 c74 0 167 -49 167 -206v-62c47 59 80 135 98 198c5 18 5 21 15 21c11 0 12 -10 12 -10zM410 99c-2 17 -2 75 -2 112c0 78 0 209 -99 209c-35 0 -89 -19 -136 -92c-32 -51 -58 -159 -58 -208c0 -64 30 -109 90 -109c40 0 117 11 205 88Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,412)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="778" y="0"></use>
<g transform="translate(1003,0)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="556" y="446"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2447" y="0"></use>
<g transform="translate(3448,0)">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,412)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="778" y="0"></use>
</g>
</g>
 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="4996" y="0"></use>
</g>
</svg>
</div>
<p>

<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.749ex" height="2.176ex" style="vertical-align: -0.338ex;" viewBox="0 -791.3 2475.1 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">alpha equals 2</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FC" d="M602 383c0 0 -21 -117 -115 -235c-10 -12 -10 -14 -10 -35c0 -24 0 -102 31 -102c0 0 38 0 56 49c3 7 6 10 13 10c6 0 12 -3 12 -10c0 -16 -31 -71 -84 -71c-45 0 -78 31 -91 84c-76 -61 -148 -84 -211 -84c-102 0 -162 76 -162 169c0 141 132 284 269 284 c74 0 167 -49 167 -206v-62c47 59 80 135 98 198c5 18 5 21 15 21c11 0 12 -10 12 -10zM410 99c-2 17 -2 75 -2 112c0 78 0 209 -99 209c-35 0 -89 -19 -136 -92c-32 -51 -58 -159 -58 -208c0 -64 30 -109 90 -109c40 0 117 11 205 88Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="0" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="918" y="0"></use>
 <use xlink:href="#E1-LATINMODERNMAIN-32" x="1974" y="0"></use>
</g>
</svg> was used for the table in <tt>pbrt</tt>.  Because the table is indexed
with squared distances from the filter center <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.103ex" height="2.509ex" style="vertical-align: -0.338ex;" viewBox="0 -934.9 905.4 1080.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">r squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="638" y="513"></use>
</g>
</svg>, each entry stores a
value <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.337ex" height="2.343ex" style="vertical-align: -0.338ex;" viewBox="0 -863.1 1867.1 1008.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript minus alpha r</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FC" d="M602 383c0 0 -21 -117 -115 -235c-10 -12 -10 -14 -10 -35c0 -24 0 -102 31 -102c0 0 38 0 56 49c3 7 6 10 13 10c6 0 12 -3 12 -10c0 -16 -31 -71 -84 -71c-45 0 -78 31 -91 84c-76 -61 -148 -84 -211 -84c-102 0 -162 76 -162 169c0 141 132 284 269 284 c74 0 167 -49 167 -206v-62c47 59 80 135 98 198c5 18 5 21 15 21c11 0 12 -10 12 -10zM410 99c-2 17 -2 75 -2 112c0 78 0 209 -99 209c-35 0 -89 -19 -136 -92c-32 -51 -58 -159 -58 -208c0 -64 30 -109 90 -109c40 0 117 11 205 88Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,362)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="778" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="1419" y="0"></use>
</g>
</g>
</svg>, rather than <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.168ex" height="2.843ex" style="vertical-align: -0.338ex;" viewBox="0 -1078.4 2225.2 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">normal e Superscript minus alpha r squared</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D6FC" d="M602 383c0 0 -21 -117 -115 -235c-10 -12 -10 -14 -10 -35c0 -24 0 -102 31 -102c0 0 38 0 56 49c3 7 6 10 13 10c6 0 12 -3 12 -10c0 -16 -31 -71 -84 -71c-45 0 -78 31 -91 84c-76 -61 -148 -84 -211 -84c-102 0 -162 76 -162 169c0 141 132 284 269 284 c74 0 167 -49 167 -206v-62c47 59 80 135 98 198c5 18 5 21 15 21c11 0 12 -10 12 -10zM410 99c-2 17 -2 75 -2 112c0 78 0 209 -99 209c-35 0 -89 -19 -136 -92c-32 -51 -58 -159 -58 -208c0 -64 30 -109 90 -109c40 0 117 11 205 88Z"></path>
<path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
<path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
<g transform="translate(444,362)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D6FC" x="778" y="0"></use>
<g transform="translate(1003,0)">
 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="0" y="0"></use>
 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="556" y="446"></use>
</g>
</g>
</g>
</svg>.

</p>
<p></p>
<span class="anchor" id="fragment-MIPMapEWALookupTableDefinition-0"></span><div class="fragmentname">&lt;&lt;MIPMap EWA Lookup Table Definition&gt;&gt;=&nbsp;</div>
<div class="fragmentcode">static constexpr int <span class="anchor" id="MIPFilterLUTSize"></span>MIPFilterLUTSize = 128;
static PBRT_CONST Float MIPFilterLUT[MIPFilterLUTSize] = {
    &lt;&lt;<span class="fragmentname">MIPMap EWA Lookup Table Values</span>&gt;&gt;&nbsp;<a data-toggle="collapse" href="#fragbit-1516" role="button" class="fa codecarat" aria-expanded="true" aria-controls="fragbit-1516"><i></i></a><div id="fragbit-1516" class="collapse show"><div class="fragmentcode">       0.864664733f,  0.849040031f,   0.83365953f,   0.818519294f,
           0.80361563f,   0.788944781f,   0.774503231f,  0.760287285f,
           0.746293485f,  0.732518315f,   0.718958378f,  0.705610275f,
           0.692470789f,  0.679536581f,   0.666804492f,  0.654271305f,
           0.641933978f,  0.629789352f,   0.617834508f,  0.606066525f,
           0.594482362f,  0.583079159f,   0.571854174f,  0.560804546f,
           0.549927592f,  0.539220572f,   0.528680861f,  0.518305838f,
           0.50809288f,   0.498039544f,   0.488143265f,  0.478401601f,
           0.468812168f,  0.45937258f,    0.450080454f,  0.440933526f,
           0.431929469f,  0.423066139f,   0.414341331f,  0.405752778f,
           0.397298455f,  0.388976216f,   0.380784035f,  0.372719884f,
           0.364781618f,  0.356967449f,   0.34927541f,   0.341703475f,
           0.334249914f,  0.32691282f,    0.319690347f,  0.312580705f,
           0.305582166f,  0.298692942f,   0.291911423f,  0.285235822f,
           0.278664529f,  0.272195935f,   0.265828371f,  0.259560347f,
           0.253390193f,  0.247316495f,   0.241337672f,  0.235452279f,
           0.229658857f,  0.223955944f,   0.21834214f,   0.212816045f,
           0.207376286f,  0.202021524f,   0.196750447f,  0.191561714f,
           0.186454013f,  0.181426153f,   0.176476851f,  0.171604887f,
           0.166809067f,  0.162088141f,   0.157441005f,  0.152866468f,
           0.148363426f,  0.143930718f,   0.139567271f,  0.135272011f,
           0.131043866f,  0.126881793f,   0.122784719f,  0.11875169f,
           0.114781633f,  0.11087364f,    0.107026696f,  0.103239879f,
           0.0995122194f, 0.0958427936f,  0.0922307223f, 0.0886750817f,
           0.0851749927f, 0.0817295909f,  0.0783380121f, 0.0749994367f,
           0.0717130303f, 0.0684779733f,  0.0652934611f, 0.0621587038f,
           0.0590728968f, 0.0560353249f,  0.0530452281f, 0.0501018465f,
           0.0472044498f, 0.0443523228f,  0.0415447652f, 0.0387810767f,
           0.0360605568f, 0.0333825648f,  0.0307464004f, 0.0281514227f,
           0.0255970061f, 0.0230824798f,  0.0206072628f, 0.0181707144f,
           0.0157722086f, 0.013411209f,   0.0110870898f, 0.0087992847f,
           0.0065472275f, 0.00433036685f, 0.0021481365f, 0.f</div></div>
};</div><p>


</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>

</div> <!-- col-md-10 col-lg-8 -->
<div class="col-md-1 col-lg-2">

</div> <!-- col-md-1 col-lg-2 -->
</div>  <!-- row -->

</div>  <!-- container-fluid -->
</div>  <!-- maincontainer -->

<nav class="navbar navbar-expand-md bg-light navbar-light">
<div class="container-fluid">
  <span class="navbar-text"><i>Physically Based Rendering: From Theory To Implementation</i>,<br>
<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">&copy; 2004-2023</a> Matt Pharr, Wenzel Jakob, and Greg Humphreys.
<a href="https://github.com/mmp/pbr-book-website/"><span class="fab fa-github"></span></a><br>
Purchase a printed copy: <a href="https://www.amazon.com/Physically-Based-Rendering-fourth-Implementation/dp/0262048027?keywords=physically+based+rendering+4th+edition&qid=1671730412&sprefix=physically+based%!C(MISSING)aps%!C(MISSING)145&sr=8-1&linkCode=ll1&tag=pharr-20&linkId=81a816d90f0c7e872617f1f930a51fd6&language=en_US&ref_=as_li_ss_tl"><span class="fab fa-amazon"></span></a>
<a href="https://mitpress.mit.edu/9780262048026/physically-based-rendering/"><img src="/mitpress.png" width=10 height=16></a>
</span>
</div>
  <div class="container">
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">Next: <a href="../Textures_and_Materials/Material_Interface_and_Implementations.html">Textures and Materials / Material Interface and Implementations</a></li>
    </ul>
  </div>

</nav>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script>
  $(function () {
    $('[data-toggle="popover"]').popover()
    $('[data-toggle="tooltip"]').tooltip()
   })
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script>
// https://stackoverflow.com/a/17535094
// The function actually applying the offset
function offsetAnchor() {
  if (location.hash.length !== 0) {
    window.scrollTo(window.scrollX, window.scrollY - window.innerHeight / 8);
  }
}

// Captures click events of all <a> elements with href starting with #
$(document).on('click', 'a[href^="#"]', function(event) {
  // Click events are captured before hashchanges. Timeout
  // causes offsetAnchor to be called after the page jump.
  window.setTimeout(function() {
    offsetAnchor();
  }, 500);
});

// Set the offset when entering page with hash present in the url
window.setTimeout(offsetAnchor, 1500);
</script>

</body>
</html>
